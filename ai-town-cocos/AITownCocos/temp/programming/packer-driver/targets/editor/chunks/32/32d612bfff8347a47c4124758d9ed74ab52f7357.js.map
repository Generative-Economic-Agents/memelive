{"version":3,"sources":["file:///Users/feiwang/workSpace/AITown/cutepet/assets/src/core/state/StateMachine.ts"],"names":["StateMachine","ObjDictionary","constructor","owner","_stateDic","_currentState","_lastState","_globalState","_owner","isExist","stateKey","containsKey","getStateByKey","get","setOwner","registerState","key","state","console","log","add","setGlobalState","obj","onEnter","removeState","remove","changeState","newState","onLeave","getStateKey","reEnterState","onReEnter","update","onUpdate","getCurrentState","InvalidState","clear"],"mappings":"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","sourcesContent":["import ObjDictionary from \"../dataStructue/ObjDictionary\";\nimport State from \"./State\";\n\nexport default class StateMachine\n{\n\tpublic static readonly InvalidState:string = \"Invalid\";\n\t\n\tprotected _stateDic:ObjDictionary;\n\tprotected _currentState:State = null;\n\tprotected _lastState:State = null;\n\tprotected _globalState:State = null;\n\tprotected _owner:Object;\n\t\n\tpublic constructor(owner:Object)\n\t{\t\n\t\tthis._stateDic = new ObjDictionary();\n\t\tthis._owner = owner;\n\t}\n\t\n\t\n\tpublic isExist(stateKey:string):boolean\n\t{\n\t\treturn this._stateDic.containsKey(stateKey);\n\t}\n\t\n\tpublic getStateByKey(stateKey:string):State\n\t{\n\t\treturn this._stateDic.get(stateKey);\n\t}\n\t\n\t\n\tpublic setOwner(owner:Object):void\n\t{\n\t\tthis._owner = owner;\n\t}\n\n\t/**\n\t * 注册状态 \n\t * @param key\n\t * @param state\n\t * \n\t */\t\t\n\tpublic registerState(key:string, state:State):void\n\t{\n\t\tif(this._owner != state.owner)\n\t\t{\n\t\t\tconsole.log(\"statemachine 与 state 所有者不一致\");\n\t\t\treturn;\n\t\t}\n\t\tthis._stateDic.add(key, state);\n\t}\n\t\n\t\n\tpublic setGlobalState(state:State, obj:Object = null):void\n\t{\n\t\tthis._globalState = state;\n\t\tthis._globalState.onEnter(obj);\n\t}\n\t\n\t\n\t/**\n\t * 移除状态 \n\t * @param key\n\t * \n\t */\t\t\n\tpublic removeState(key:string):void\n\t{\n\t\tthis._stateDic.remove(key);\n\t}\n\t\n\t/**\n\t * 改变状态 \n\t * @param key\n\t * @param obj\n\t * \n\t */\t\t\n\tpublic changeState(key:string, obj:Object = null):void\n\t{\n\t\tlet newState:State = this._stateDic.get(key);\n\t\tif (newState == null)\n\t\t{\n\t\t\tconsole.log(\"unregister state type: \" + key);\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tif (this._currentState != null)\n\t\t{\n\t\t\tthis._currentState.onLeave(newState.getStateKey());\n\t\t}\n\t\t\n\t\tthis._lastState = this._currentState;\n\t\tthis._currentState = newState;\n\t\tthis._currentState.onEnter(obj);\n\t}\n\t\n\tpublic reEnterState(obj:Object = null):void\n\t{\n\t\tif(this._currentState)\n\t\t\tthis._currentState.onReEnter(obj);\n\t}\n\t\t\n\t\n\t/**\n\t * 更新 \n\t * \n\t */\t\t\n\tpublic update():void\n\t{\n\t\tif (this._globalState != null)\n\t\t\tthis._globalState.onUpdate();\n\t\tif (this._currentState != null)\n\t\t\tthis._currentState.onUpdate();\n\t}\n\t\n\t/**\n\t * 当前状态类型  \n\t * @return \n\t * \n\t */\t\t\n\tpublic getCurrentState():string\n\t{\n\t\tif (this._currentState != null)\n\t\t{\n\t\t\treturn this._currentState.getStateKey();\n\t\t}\n\t\treturn StateMachine.InvalidState;\n\t}\n\t\n\t/**\n\t * 清除 \n\t * \n\t */\t\t\n\tpublic clear():void\n\t{\n\t\tif (this._currentState != null)\n\t\t\tthis._currentState.onLeave(StateMachine.InvalidState);\n\t\tthis._stateDic.clear();\n\t\tthis._currentState = null;\n\t\tthis._lastState = null;\n\t}\n\t\n\t\n}"]}