{"version":3,"sources":["file:///Users/feiwang/cutepet/assets/src/module/main/shop/PetsItem.ts"],"names":["_decorator","Component","Label","Node","Sprite","WebUtils","modelMgr","observer","socket","GlobalConfig","showMsg2","network","EventType","ccclass","property","PetsItem","_da","_servda","_clickNum","start","node","on","updateData","SOCKET_CHANGE_CATS","updateSerData","update","deltaTime","onDestroy","off","configModel","getStrById","da","CurCatId","instance","getCurCatId","Number","id","Sprite_select","active","mainModel","getServerCatsData","Label_name","string","name","mbti","getCatDataById","toLowerCase","getResouceImg","itempic","clickHandler","evt","json","ChangeCatsRequest","data","catId","sendWebSocketBinary","setCurCatId","getCatTestHandler","SelectCatRequst"],"mappings":"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","sourcesContent":["import { _decorator, Component, Label, Node, Sprite } from 'cc';\nimport WebUtils from '../../../utils/WebUtils';\nimport { modelMgr, observer, socket } from '../../../game/App';\nimport { GlobalConfig } from '../../../game/config/GlobalConfig';\nimport { showMsg2 } from '../../../core/message/MessageManager';\nimport { network } from '../../../model/RequestData';\nimport { EventType } from '../../../EventType';\nimport { catServerD } from '../../../game/config/DataStruct';\nconst { ccclass, property } = _decorator;\n\n@ccclass('PetsItem')\nexport class PetsItem extends Component {\n\n    @property(Node)\n    public itempic: Node = null;\n\n\n    @property(Label)\n    public Label_name: Label = null;\n    @property(Sprite)\n    public sprite_name: Label = null;\n    @property(Sprite)\n    public Sprite_select: Label = null;\n    public _da;\n    start() {\n        this.node.on(\"update_data\", this.updateData, this);\n        observer.on(EventType.SOCKET_CHANGE_CATS, this.updateSerData, this);\n    }\n\n    update(deltaTime: number) {\n\n    }\n    protected onDestroy(): void {\n        this.node.off(\"update_data\", this.updateData, this);\n        observer.off(EventType.SOCKET_CHANGE_CATS, this.updateSerData, this);\n    }\n    private _servda: catServerD;\n    private updateSerData() {\n        showMsg2(modelMgr.configModel.getStrById(10007));\n\n        this.updateData(this._da);\n    }\n    /**\n    * 视图更新\n    * @param da \n    */\n    public updateData(da) {\n        this._da = da;\n        if (this._da) {\n            let CurCatId = GlobalConfig.instance.getCurCatId();\n            if (CurCatId == Number(this._da.id)) {\n                this.Sprite_select.node.active = true;\n            } else {\n                this.Sprite_select.node.active = false;\n            }\n            this._servda = modelMgr.mainModel.getServerCatsData(this._da.id);\n            this.Label_name.string = this._da.name;\n            this.node.active = true;\n\n            if (!this._servda) {\n                // console.warn(\"没有图片:\", this._da);\n                //显示未获得图片\n            } else {\n                let mbti = modelMgr.configModel.getCatDataById(this._da.id).mbti;\n                mbti = mbti.toLowerCase();\n\n                WebUtils.getResouceImg(`tujian/${mbti}_tj`, this.itempic);\n            }\n        }\n    }\n\n    /**\n     * 切换猫咪\n     * @param evt \n     * @param da \n     * @returns \n     */\n    public clickHandler(evt, da) {\n        if (this._da) {\n            let CurCatId = GlobalConfig.instance.getCurCatId();\n            if (CurCatId == Number(this._da.id)) {\n                // showMsg2(\"当前猫咪已选择\");\n                showMsg2(modelMgr.configModel.getStrById(10006));\n\n                return;\n            } else if (this._servda) {\n                let json = new network.ChangeCatsRequest();\n                json.data.catId = this._da.id;\n                socket.sendWebSocketBinary(json);\n                GlobalConfig.instance.setCurCatId(this._da.id);\n                // this.updateData(this._da);\n            } else {\n                showMsg2(modelMgr.configModel.getStrById(10008));//还未获得此猫咪\n            }\n        }\n    }\n\n    private _clickNum: number = 0;\n    /**\n     * 获取猫咪-debug\n     */\n    public getCatTestHandler() {\n        this._clickNum++;\n        if (this._da && this._clickNum % 9 == 0) {\n            let json = new network.SelectCatRequst();\n            json.data.catId = this._da.id;\n            socket.sendWebSocketBinary(json);\n            GlobalConfig.instance.setCurCatId(this._da.id);\n            // this.updateData(this._da);\n        }\n    }\n\n}\n\n\n"]}