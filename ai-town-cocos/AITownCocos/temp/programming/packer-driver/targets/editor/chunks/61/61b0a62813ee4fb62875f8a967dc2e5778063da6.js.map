{"version":3,"sources":["file:///Users/feiwang/workSpace/AITown/cutepet/assets/Index.ts"],"names":["_decorator","Component","Node","director","view","ProgressBar","EditBox","tizhuanMgr","showMsg2","App","appInit","mduManger","modelMgr","observer","socket","mGameConfig","WebUtils","GlobalConfig","network","EventType","Log","ccclass","property","TAG","Index","type","constructor","start","loadingview","active","loginview","s","hideloading","DeviceW","getVisibleSize","width","DeviceH","height","DesginW","DesginH","getlogin","json","LoginRequest","requestId","command","data","avatar","clientOs","loginType","instance","userId","nickName","playername","edit_name","string","name","password","timeZone","sendWebSocketBinary","onDestroy","off","SOCKET_ONOPEN","SOCKET_ONMESSAGE","hasLogin","da","code","LoginData","preloadScene","completedCount","totalCount","item","scheduleOnce","log","checkEntrance","gotoHome","configModel","getStrById","hasJsonsLoad","console","goLogin","hasInitGame","debounceThings","debounce","app","init","loadResDir","on"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, director, Label, view, resources, ProgressBar, EditBox } from \"cc\";\nconst { ccclass, property } = _decorator;\nimport { tizhuanMgr } from \"./src/manager/TiaozhuanManager\";\nimport { showMsg2 } from \"./src/core/message/MessageManager\";\nimport App, { appInit, mduManger, modelMgr, observer, socket } from \"./src/game/App\";\nimport StateMachine from \"./src/core/state/StateMachine\";\nimport mGameConfig from \"./src/utils/MGameConfig\";\nimport WebUtils from \"./src/utils/WebUtils\";\nimport StringUtils from \"./src/utils/StringUtils\";\nimport BoswerUtils from \"./src/utils/BoswerUtils\";\nimport { GlobalConfig } from \"./src/game/config/GlobalConfig\";\nimport Base64Utils from \"./src/utils/Base64Utils\";\nimport AxiosManager from \"./src/manager/AxiosManager\";\nimport { post_createdlist } from \"./src/game/config/AxiosRequestConfig\";\nimport { network } from \"./src/model/RequestData\";\nimport { EventType } from \"./src/EventType\";\nimport Log from '../assets/src/utils/LogUtils'\nimport { AudioManager } from \"./src/manager/AudioManager\";\nexport let Axios;\nexport let NeteaseGame;\nexport let yyygame;\n/**\n * 1.登录验证/登录逻辑\n * 2.登录页/loading页\n * 3.活动未开启/开启/结束状态处理\n * 4.游戏首接口home 接口\n * 5.微信qq 分享文案\n */\nconst TAG = 'Index'\n@ccclass(\"Index\")\nexport default class Index extends Component {\n  // [1]\n  // dummy = '';\n\n  // [2]\n  // @property\n  // serializableDummy = 0;\n\n  @property(Node)\n  public loginview: Node;\n  @property(Node)\n  public loadingview: Node;\n  @property({ type: ProgressBar })\n  prg: ProgressBar | null = null;\n  @property(EditBox)\n  public edit_name: EditBox = null;\n  constructor() {\n    super();\n  }\n  async start() {\n    this.loadingview.active = false;\n    this.loginview.active = true;\n    // director.preloadScene('mainView');\n    let s = this;\n    // Log.log(TAG, '<axios>', window[\"Axios\"], window[\"NeteaseGame\"], window[\"yyygame\"])\n    // Axios = window[\"Axios\"];\n    // NeteaseGame = window[\"NeteaseGame\"];\n    // yyygame = window[\"yyygame\"];\n    tizhuanMgr.hideloading();\n\n    mGameConfig.DeviceW = view.getVisibleSize().width;\n    mGameConfig.DeviceH = view.getVisibleSize().height;\n    mGameConfig.DesginW = view.getVisibleSize().width;\n    mGameConfig.DesginH = view.getVisibleSize().height;\n    // if (GlobalConfig.instance.hasInitGame == false) {\n    //   let app = new App();\n    //   app.init();\n    //   appInit(app);\n    //   Log.log(TAG, 'main init start ...')\n    //   mduManger.start();\n    //   modelMgr.configModel.loadResDir();\n    // }\n    // observer.on(EventType.SOCKET_ONOPEN, this.getlogin, this);\n    // observer.on(EventType.SOCKET_ONMESSAGE, this.hasLogin, this);\n\n    // this.gethome();\n  }\n\n\n\n  public async getlogin() {\n    let json = new network.LoginRequest();\n    json.requestId = 0;\n    json.type = 1;\n    json.command = 10000;\n    json.data.avatar = \"\";\n    json.data.clientOs = \"\";\n    json.data.loginType = 1;\n    GlobalConfig.instance.userId = GlobalConfig.instance.nickName = GlobalConfig.instance.playername = this.edit_name.string\n    json.data.name = GlobalConfig.instance.playername;\n    json.data.nickName = GlobalConfig.instance.nickName;\n    json.data.userId = GlobalConfig.instance.userId;\n    json.data.password = \"123\";\n    json.data.timeZone = 0;\n    socket.sendWebSocketBinary(json);\n    //AxiosManager.init();\n    // this.getgrantcode();\n  }\n  public onDestroy() {\n    observer.off(EventType.SOCKET_ONOPEN, this.getlogin, this);\n    observer.off(EventType.SOCKET_ONMESSAGE, this.hasLogin, this);\n  }\n\n\n  public hasLogin(da: any) {\n    let data: network.InetwarkResponseData = da.data;\n    if (data && data.command == 10000 && data.code == 0) {\n      GlobalConfig.instance.hasLogin = true;\n      GlobalConfig.instance.LoginData = data as network.LoginResponse;\n      //显示loading页\n      this.loginview.active = false;\n      this.loadingview.active = true;\n      //预加载场景并获得加载进度\n      director.preloadScene('mainView', (completedCount, totalCount, item) => {\n        //可以把进度数据打出来\n        //this.prg?.progress && (this.prg.progress = completedCount / totalCount);\n\n      }, () => {\n        this.scheduleOnce(() => {\n          Log.log(TAG, 'Enter Game HomePage')\n          \n          tizhuanMgr.checkEntrance();\n        }, 0);\n      });\n      // resources.preloadScene(),预加载场景失败--boundle 的设置\n\n\n    }\n  }\n\n  // /**\n  //  * 获取登录信息\n  //  */\n  // public getgrantcode() {\n  //   let obj = {\n  //     // appId: 'a301020000000000778e659fd53a3075',//跳球\n  //     appId: 'a3010200000000004488b559f877bde2',//种花\n  //   };\n  //   yyygame.init(obj).then(res => {\n  //     // res.code 为用户成功授权后得到的授权码，可用于后端获取 accessToken 及用户信息\n  //     console.warn(\" yyygame.init::\", res);\n  //     let grantCode = `grantCode=${res.code}&appAbbr=CloudFlower&device=${JSON.stringify(GlobalConfig.device)}`;\n  //     let data = new FormData();\n  //     data.append('grantCode', Base64Utils.encode(grantCode));\n  //     data.append('grant_type', \"cloud\");\n  //     data.append('client_id', \"cloud\");\n  //     data.append('client_secret', \"secret\");\n  //     data.append('scope', \"openid message.read message.write\");\n  //     AxiosManager.post('/oauth2/token', data, AxiosManager.CONENTTYPE.FORMDATA, function (message) {\n  //       this.gotoHome();\n  //     }.bind(this));\n  //   });\n  // }\n\n\n\n  public gotoHome() {\n    if (this.edit_name.string) {\n      GlobalConfig.instance.nickName = GlobalConfig.instance.playername = GlobalConfig.instance.userId = this.edit_name.string;\n    }\n    return;\n\n    if (GlobalConfig.instance.hasLogin == false) {\n      showMsg2(modelMgr.configModel.getStrById(10002));\n\n      // return;\n    }\n    if (GlobalConfig.instance.hasJsonsLoad == false) {\n      showMsg2(modelMgr.configModel.getStrById(10001));\n\n      return;\n    }\n    console.log(\"进入游戏首页\");\n\n    tizhuanMgr.checkEntrance();\n  }\n  /**\n   * 按钮登录点击，\n   * @returns \n   */\n  public async goLogin() {\n    //AudioManager.instance.playSound(\"new_NormanBtn\");\n    if (!this.edit_name.string) {\n      showMsg2(\"Please enter your email account.\");\n      return;\n    }\n    if (GlobalConfig.instance.hasInitGame == false) {\n      const debounceThings = WebUtils.debounce(()=>{\n        let app = new App();\n        app.init();\n        appInit(app);\n        Log.log(TAG, 'main init start ...')\n        mduManger.start();\n        modelMgr.configModel.loadResDir();\n        observer.on(EventType.SOCKET_ONOPEN, this.getlogin, this);\n        observer.on(EventType.SOCKET_ONMESSAGE, this.hasLogin, this);\n      }, 2)\n      debounceThings()\n    }\n  }\n\n\n}\n"]}