{"version":3,"sources":["file:///Users/feiwang/cutepet/assets/src/game/components/listViewCtrl5.ts"],"names":["_decorator","Component","Node","ScrollView","Vec3","instantiate","ListItemComponent","ccclass","property","menu","_temp_vec3","ListViewCtrl5","_items","_itemTemplateUITrans","_itemdata","onLoad","initData","itemdata","reset","initialize","scheduleOnce","i","length","getComponent","setData","scrollView","scrollToBottom","node","on","onScrollEnded","content","removeAllChildren","item","itemTemplate","setPosition","addChild","indexlabelComp","index_label","string","push","update","dt","addItem","newItem","removeItem","onScrolling","scrollOffset","getScrollOffset","maxScrollOffset","getMaxScrollOffset","console","log","y","event","emit","getItemAtBottom","position"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, ScrollView, Label, Button, Vec3, UITransform, instantiate, error, Vec2, System, Color } from \"cc\";\nimport { ListItemComponent } from \"./ListItemComponent\";\nimport { observer } from \"../App\";\nconst { ccclass, property, menu } = _decorator;\n\nconst _temp_vec3 = new Vec3();\n/**\n * scrollview 操作版\n * 遮罩显示list cell\n * cell length 不限制 \n * 适用cell 高度自适应显示\n */\n@ccclass(\"ListViewCtrl5\")\n@menu('UI/ListViewCtrl5')\nexport class ListViewCtrl5 extends Component {\n    @property(Node)\n    public itemTemplate: Node = null!;\n\n\n    @property(Node)\n    public content: Node = null!;\n    @property(ScrollView)\n    public scrollView: ScrollView = null!;\n    private _items: Node[] = [];\n    private _itemTemplateUITrans!: UITransform;\n\n    onLoad() {\n    }\n\n    //=================外部调用设置=======================\n    private _itemdata: any[] = null;\n    /**\n     * 设置spwan,itemdata;\n     * \n     */\n    public initData(itemdata) {\n        this.reset();\n        this._itemdata = itemdata;\n        this.initialize();\n\n        this.scheduleOnce(() => {\n            for (let i = 0; i < this._itemdata.length; i++) {\n                this._items[i].getComponent(ListItemComponent).setData(this._itemdata[i]);\n            }\n            this.scheduleOnce(()=>{\n                this.scrollView.scrollToBottom(1);\n            },0.1);\n        }, 0.1)\n        this.scrollView.node.on('scroll-ended', this.onScrollEnded, this);\n    }\n\n    public reset() {\n        this._itemdata = [];\n        this.content.removeAllChildren();\n        this._items = [];\n    }\n    //=================外部调用设置end=======================\n    // 初始化 item\n    initialize() {\n\n        for (let i = 0; i < this._itemdata.length; i++) { // spawn items, we only need to do this once\n            let item = instantiate(this.itemTemplate) as Node;\n            item.setPosition(0, 0, 0);\n            this.content.addChild(item);\n            // let itemUITrans = item.getComponent(UITransform);\n            const indexlabelComp = item.getComponent(ListItemComponent)!.index_label;\n            indexlabelComp.string = i + 1 + \"\";\n            this._items.push(item);\n        }\n    }\n\n\n\n    update(dt: number) {\n        if (!this._itemTemplateUITrans) {\n            return;//未初始化；\n        }\n    }\n\n    addItem() {\n        // 创建新元素\n        let newItem = instantiate(this.itemTemplate) as Node;\n        // 将新元素添加到内容节点\n        this.content.addChild(newItem);\n        // 更新 ScrollView 的 content 大小\n        //  this.content.getComponent(UITransform).height += newItem.getComponent(UITransform).height;\n    }\n\n    removeItem() {\n\n    }\n\n    onScrolling() {\n        let scrollOffset = this.scrollView.getScrollOffset(); // 获取滚动偏移量\n        let maxScrollOffset = this.scrollView.getMaxScrollOffset(); // 获取最大滚动偏移量\n        console.log(scrollOffset,maxScrollOffset);\n        if (maxScrollOffset.y - scrollOffset.y > 300 ) {//还差300滚动到顶部的时候，开始获取数据\n            // this.addItem();\n        }\n    }\n    onScrollEnded(event: Event) {\n        // 滚动结束事件被触发，可以在这里处理回弹结束的逻辑\n        console.log('Scrolling has ended');\n        // 你可以在这里添加更多的判断逻辑来确定是否是回弹事件\n        this.node.emit(\"scrollended\");\n    }\n\n    getItemAtBottom() {\n        let item = this._items[0];\n        for (let i = 1; i < this._items.length; ++i) {\n            if (item.position.y > this._items[i].position.y) {\n                item = this._items[i];\n            }\n        }\n        return item;\n    }\n\n}\n\n"]}