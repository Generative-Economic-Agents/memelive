{"version":3,"sources":["file:///Users/feiwang/cutepet/assets/src/game/scene/MapTile.ts"],"names":["MapTile","Layers","Node","resources","Sprite","UITransform","Vec2","Vec3","WebUtils","constructor","row","col","parent","_row","_col","_resUrl","_isLoaded","_parent","_disObj","_isLoading","id","layer","Enum","UI_2D","addComponent","getComponent","setAnchorPoint","loadTile","getResouceImg","onLoadCmp","bind","err","spriteFrame","setPosition","addChild","unloadTile","removeChild","release"],"mappings":";;;mJAMqBA,O;;;;;;;;;;;;;;;AANZC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,M,OAAAA,M;AAAgCC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,I,OAAAA,I;;AAC9EC,MAAAA,Q;;;;;;;;;AAEP;AACA;AACA;yBACqBR,O,GAAN,MAAMA,OAAN,CAAc;AASpBS,QAAAA,WAAW,CAACC,GAAD,EAAcC,GAAd,EAA2BC,MAA3B,EAAyC;AAAA,eARnDC,IAQmD;AAAA,eAPnDC,IAOmD;AAAA,eANnDC,OAMmD;AAAA,eALnDC,SAKmD,GAL9B,KAK8B;AAAA,eAJnDC,OAImD;AAAA,eAHnDC,OAGmD;AAAA,eAFnDC,UAEmD,GAF7B,KAE6B;AACzD,eAAKN,IAAL,GAAYH,GAAZ;AACA,eAAKI,IAAL,GAAYH,GAAZ;AACA,eAAKM,OAAL,GAAeL,MAAf;AACA,cAAIQ,EAAU,GAAG,KAAKP,IAAL,GAAY,GAAZ,GAAkB,KAAKC,IAAxC;AACA,eAAKC,OAAL,GAAc,iBAAiBK,EAA/B;AACA,eAAKF,OAAL,GAAc,IAAIhB,IAAJ,EAAd;AACA,eAAKgB,OAAL,CAAaG,KAAb,GAAqBpB,MAAM,CAACqB,IAAP,CAAYC,KAAjC;AAAuC,WAPkB,CAOjB;;AACxC,eAAKL,OAAL,CAAaM,YAAb,CAA0BpB,MAA1B;;AACA,eAAKc,OAAL,CAAaO,YAAb,CAA0BpB,WAA1B,EAAuCqB,cAAvC,CAAsD,IAAIpB,IAAJ,CAAS,CAAT,EAAW,CAAX,CAAtD;AACD;;AAEMqB,QAAAA,QAAQ,GAAS;AACtB,cAAI,KAAKX,SAAL,IAAkB,KAAKG,UAA3B,EAAuC;AACvC,eAAKA,UAAL,GAAkB,IAAlB,CAFsB,CAGtB;;AACA;AAAA;AAAA,oCAASS,aAAT,CAAuB,KAAKb,OAA5B,EAAoC,KAAKG,OAAzC,EAAiD,KAAKW,SAAL,CAAeC,IAAf,CAAoB,IAApB,CAAjD;AAED;;AAEOD,QAAAA,SAAS,CAACE,GAAD,EAAWC,WAAX,EAA2C;AAE1D,eAAKb,UAAL,GAAkB,KAAlB;AACA,eAAKH,SAAL,GAAiB,IAAjB;;AAGA,eAAKE,OAAL,CAAae,WAAb,CAAyB,IAAI1B,IAAJ,CAAS,KAAKO,IAAL,GAAY,GAArB,EAAyB,CAAC,KAAKD,IAAN,GAAa,GAAtC,EAA0C,CAA1C,CAAzB;;AACA,eAAKI,OAAL,CAAaiB,QAAb,CAAsB,KAAKhB,OAA3B,EAP0D,CAQ1D;AACA;;AACD;;AAEMiB,QAAAA,UAAU,GAAS;AACxB;AACA;AACA,eAAKjB,OAAL,CAAaO,YAAb,CAA0BrB,MAA1B,EAAkC4B,WAAlC,GAAgD,IAAhD,CAHwB,CAIxB;AACA;;AACA,eAAKhB,SAAL,GAAiB,KAAjB;;AACA,eAAKC,OAAL,CAAamB,WAAb,CAAyB,KAAKlB,OAA9B;;AACAf,UAAAA,SAAS,CAACkC,OAAV,CAAkB,KAAKtB,OAAL,GAAa,cAA/B,EARwB,CASxB;AACD;;AAnD0B,O","sourcesContent":["import { Layers, Node, resources, Sprite, SpriteFrame, Texture2D, UITransform, Vec2, Vec3 } from \"cc\";\nimport WebUtils from \"../../utils/WebUtils\";\nimport LayerEnum from \"./LayerEnum\";\n/**\n *\n */\nexport default class MapTile {\n  private _row: number;\n  private _col: number;\n  private _resUrl: string;\n  private _isLoaded: boolean = false;\n  private _parent: Node;\n  private _disObj: Node;\n  private _isLoading: boolean = false;\n\n  public constructor(row: number, col: number, parent: Node) {\n    this._row = row;\n    this._col = col;\n    this._parent = parent;\n    let id: string = this._row + \"_\" + this._col;\n    this._resUrl =\"res/map_001/\" + id ;\n    this._disObj= new Node();\n    this._disObj.layer = Layers.Enum.UI_2D;;//Layer 设置要准确 ui_2d;\n    this._disObj.addComponent(Sprite);\n    this._disObj.getComponent(UITransform).setAnchorPoint(new Vec2(0,1));\n  }\n\n  public loadTile(): void {\n    if (this._isLoaded || this._isLoading) return;\n    this._isLoading = true;\n    // 加载 texture\n    WebUtils.getResouceImg(this._resUrl,this._disObj,this.onLoadCmp.bind(this));\n\n  }\n\n  private onLoadCmp(err: any, spriteFrame: SpriteFrame): void {\n   \n    this._isLoading = false;\n    this._isLoaded = true;\n\n\n    this._disObj.setPosition(new Vec3(this._col * 300,-this._row * 300,0));\n    this._parent.addChild(this._disObj);\n    //test code ...\n    // sceneManager.addToLayer(this._disObj,LayerEnum.MapLayer,300,300);\n  }\n\n  public unloadTile(): void {\n    //return;\n    //清除资源缓存,容器保存\n    this._disObj.getComponent(Sprite).spriteFrame = null;\n    //释放资源\n    // if (this._isLoading) resources.release(this._resUrl);\n    this._isLoaded = false;\n    this._parent.removeChild(this._disObj);\n    resources.release(this._resUrl+\"/spriteFrame\");\n    // console.log(\"unloadTile: \" + this._resUrl);\n  }\n}\n"]}