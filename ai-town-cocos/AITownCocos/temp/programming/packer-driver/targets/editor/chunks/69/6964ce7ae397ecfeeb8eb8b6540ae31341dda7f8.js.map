{"version":3,"sources":["file:///Users/feiwang/cutepet/assets/src/module/dragonbones/dragonbonesCtrl.ts"],"names":["_decorator","Component","Node","dragonBones","ProgressBar","Label","ccclass","property","DragonbonesCtrl","type","_isAttack","_armature","_armatureDisplay","_role","_rolearm","start","getComponent","ArmatureDisplay","armature","node","on","EventType","TOUCH_START","event","startAttack","onLoad","prg_blood","progress","label_over","active","addEventListener","EventObject","COMPLETE","_animationEventHandler","node_role","FADE_IN_COMPLETE","FADE_OUT_COMPLETE","animationState","name","animation","fadeIn","NORMAL_ANIMATION_GROUP","console","log"],"mappings":"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","sourcesContent":["import {\n  _decorator,\n  Component,\n  Node,\n  dragonBones,\n  ProgressBar,\n  Label,\n} from \"cc\";\nconst { ccclass, property } = _decorator;\n\n@ccclass(\"DragonbonesCtrl\")\nexport class DragonbonesCtrl extends Component {\n  @property({ type: Node })\n  node_role: Node | null = null;\n  @property({ type: ProgressBar })\n  prg_blood: ProgressBar | null = null;\n  @property({ type: Label })\n    label_over: Label|null = null;\n  _isAttack: any;\n  _armature: any = null;\n  _armatureDisplay: dragonBones.ArmatureDisplay | null = null;\n  _role: dragonBones.ArmatureDisplay | null | undefined;\n  private _rolearm: any;\n  // [1]\n  // dummy = '';\n\n  // [2]\n  // @property\n  // serializableDummy = 0;\n\n  start() {\n    this._armatureDisplay = this.getComponent(dragonBones.ArmatureDisplay)!;\n    this._armature = this._armatureDisplay.armature();\n    this.node.on(\n      Node.EventType.TOUCH_START,\n      (event: any) => {\n        this.startAttack();\n      },\n      this\n    );\n    // [3]\n  }\n  onLoad() {\n    if (this.prg_blood) {\n      this.prg_blood.progress = 1;\n    }\n    if(this.label_over){\n        this.label_over.node.active = false;\n    }\n    this._armatureDisplay = this.getComponent(dragonBones.ArmatureDisplay)!;\n    this._armatureDisplay.addEventListener(\n      (dragonBones as any).EventObject.COMPLETE,\n      this._animationEventHandler,\n      this\n    );\n    this._role = this.node_role?.getComponent(dragonBones.ArmatureDisplay);\n    this._rolearm = this._role?.armature();\n    this._rolearm.addEventListener(\n      (dragonBones as any).EventObject.COMPLETE,\n      this._animationEventHandler,\n      this\n    );\n  }\n  _animationEventHandler(event: {\n    type: any;\n    animationState: { name: string };\n  }) {\n    if (event.type === (dragonBones as any).EventObject.FADE_IN_COMPLETE) {\n    } else if (\n      event.type === (dragonBones as any).EventObject.FADE_OUT_COMPLETE\n    ) {\n    } else if (event.type === (dragonBones as any).EventObject.COMPLETE) {\n      if (event.animationState.name === \"hurt\") {\n        this._isAttack = false;\n      }\n    }\n  }\n  startAttack() {\n    if (this.prg_blood) {\n      this.prg_blood.progress -= 0.1;\n    }\n    if (this.prg_blood && this.prg_blood.progress<=0) {\n        if(this.label_over){\n            this.label_over.node.active = true;\n        }\n      return;\n    }\n    this._armature.animation.fadeIn(\"hurt\", -1, -1, 0, NORMAL_ANIMATION_GROUP);\n\n    console.log(\"role::\", this._role, this._isAttack);\n    if (this._rolearm && !this._isAttack) {\n      this._isAttack = true;\n      console.log(\"play role===================\");\n      this._rolearm.animation.fadeIn(\"hurt\", -1, -1, 0, NORMAL_ANIMATION_GROUP);\n    }\n  }\n  // update (deltaTime: number) {\n  //     // [4]\n  // }\n}\n\nvar NORMAL_ANIMATION_GROUP = \"normal\";\n\n/**\n * [1] Class member could be defined like this.\n * [2] Use `property` decorator if your want the member to be serializable.\n * [3] Your initialization goes here.\n * [4] Your update function goes here.\n *\n * Learn more about scripting: https://docs.cocos.com/creator/3.0/manual/en/scripting/\n * Learn more about CCClass: https://docs.cocos.com/creator/3.0/manual/en/scripting/ccclass.html\n * Learn more about life-cycle callbacks: https://docs.cocos.com/creator/3.0/manual/en/scripting/life-cycle-callbacks.html\n */\n"]}