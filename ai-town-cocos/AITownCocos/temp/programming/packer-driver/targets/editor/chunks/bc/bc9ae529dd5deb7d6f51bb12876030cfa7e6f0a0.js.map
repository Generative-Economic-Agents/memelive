{"version":3,"sources":["file:///Users/feiwang/AITown/AITownCocos/assets/src/module/main/BottomTapsComponent.ts"],"names":["_decorator","Animation","Component","EditBox","Label","Material","Node","Sprite","UITransform","TabGroup","modelMgr","observer","GlobalConfig","EventType","showMsg2","showMsgWithMask","ActionType","AudioManager","ccclass","property","TAG","BottomTapsComponent","type","_editing","dotInterval","dotsCount","currentDotIndex","start","getComponent","node","on","upatetabHandler","editBoxNode","TEXT_CHANGED","onTextChanged","SOCKET_CHAT","chatresponse","txt_qipao","string","configModel","getStrById","SOCKET_ZHAOHU","zhaohuRepHandler","SOCKET_CHANGE_CATS","changeCatsHandler","event","isOnlyNewLines","text","tempLabel","textHeight","height","chtbg1","chtbg2","e","index","update","deltaTime","btnclickHandler","node_qipao","active","scheduleOnce","str","test","chatBubbleVisible","show","aniName","mask","play","chatBubbleHide","checkCatActionState","inputReturnHandler","inputokClickHandler","blur","instance","playSound","mainModel","chatIsediting","playAniComplete","actionData","TALK","duringTime","post","SEND_CAT_ACTION","resetQipao","tili","getserItemCountById","chatReq","getCurCatId","schedule","startTypingDots","stopTypingDots","unschedule","setNodeWidth","txt","getChildByName","bg","width","da","data","message","length","closeinputClickHandler","resetAllTabs","resetbottomtabsClick","node_content","off","TOUCH_END","hasToySpine","msg","onDestroy"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAiCC,MAAAA,S,OAAAA,S;AAAqBC,MAAAA,O,OAAAA,O;AAAkCC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,Q,OAAAA,Q;AAAUC,MAAAA,I,OAAAA,I;AAAgBC,MAAAA,M,OAAAA,M;AAAeC,MAAAA,W,OAAAA,W;;AACpJC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,Q,iBAAAA,Q;AAAUC,MAAAA,Q,iBAAAA,Q;;AACVC,MAAAA,Y,iBAAAA,Y;;AACAC,MAAAA,S,iBAAAA,S;;AAEAC,MAAAA,Q,iBAAAA,Q;;AAEAC,MAAAA,e,iBAAAA,e;;AACAC,MAAAA,U,iBAAAA,U;;AAEAC,MAAAA,Y,iBAAAA,Y;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBnB,U;AAExBoB,MAAAA,G,GAAM,qB;;qCAGCC,mB,WADZH,OAAO,CAAC,qBAAD,C,UAEHC,QAAQ,CAAC;AAAEG,QAAAA,IAAI,EAAE,CAAChB,IAAD;AAAR,OAAD,C,UAERa,QAAQ,CAAC;AAAEG,QAAAA,IAAI,EAAE,CAAChB,IAAD;AAAR,OAAD,C,UAERa,QAAQ,CAAC;AAAEG,QAAAA,IAAI,EAAElB;AAAR,OAAD,C,UAERe,QAAQ,CAAC;AAAEG,QAAAA,IAAI,EAAE,CAAChB,IAAD;AAAR,OAAD,C,UAERa,QAAQ,CAAC;AAAEG,QAAAA,IAAI,EAAE,CAACnB,OAAD;AAAR,OAAD,C,UAERgB,QAAQ,CAAC;AAAEG,QAAAA,IAAI,EAAE,CAACnB,OAAD;AAAR,OAAD,C,UAERgB,QAAQ,CAAC;AAAEG,QAAAA,IAAI,EAAE,CAAClB,KAAD;AAAR,OAAD,C,UAERe,QAAQ,CAAC;AAAEG,QAAAA,IAAI,EAAE,CAACf,MAAD;AAAR,OAAD,C,WAERY,QAAQ,CAAC;AAAEG,QAAAA,IAAI,EAAE,CAACf,MAAD;AAAR,OAAD,C,WAGRY,QAAQ,CAACd,QAAD,C,WAERc,QAAQ,CAACZ,MAAD,C,2BAvBb,MACac,mBADb,SACyCnB,SADzC,CACmD;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA,eAiIvCqB,QAjIuC,GAiInB,KAjImB;AAAA,eA6K/CC,WA7K+C,GA6KjC,GA7KiC;AA6K5B;AA7K4B,eA8K/CC,SA9K+C,GA8KnC,CA9KmC;AA8KhC;AA9KgC,eA+K/CC,eA/K+C,GA+K7B,CA/K6B;AAAA;;AAyB/CC,QAAAA,KAAK,GAAG;AACJ,eAAKC,YAAL;AAAA;AAAA,oCAA4BC,IAA5B,CAAiCC,EAAjC,CAAoC,oBAApC,EAA0D,KAAKC,eAA/D,EAAgF,IAAhF;AACA,eAAKC,WAAL,CAAiBH,IAAjB,CAAsBC,EAAtB,CAAyB3B,OAAO,CAACU,SAAR,CAAkBoB,YAA3C,EAAyD,KAAKC,aAA9D,EAA6E,IAA7E;AACA;AAAA;AAAA,oCAASJ,EAAT,CAAY;AAAA;AAAA,sCAAUK,WAAtB,EAAmC,KAAKC,YAAxC,EAAsD,IAAtD;AACA,eAAKC,SAAL,CAAeC,MAAf,GAAwB;AAAA;AAAA,oCAASC,WAAT,CAAqBC,UAArB,CAAgC,KAAhC,CAAxB;AACA;AAAA;AAAA,oCAASV,EAAT,CAAY;AAAA;AAAA,sCAAUW,aAAtB,EAAqC,KAAKC,gBAA1C,EAA4D,IAA5D;AACA;AAAA;AAAA,oCAASZ,EAAT,CAAY;AAAA;AAAA,sCAAUa,kBAAtB,EAA0C,KAAKC,iBAA/C,EAAkE,IAAlE;AAEH;;AACDV,QAAAA,aAAa,CAACW,KAAD,EAAQ;AACjB;AACA,cAAI,KAAKC,cAAL,CAAoB,KAAKd,WAAL,CAAiBM,MAArC,CAAJ,EAAkD;AAC9C,iBAAKN,WAAL,CAAiBM,MAAjB,GAA0B,EAA1B;AACH;;AACD,cAAIS,IAAI,GAAG,KAAKf,WAAL,CAAiBM,MAA5B;AACA,eAAKU,SAAL,CAAeV,MAAf,GAAwBS,IAAxB,CANiB,CAQjB;;AACA,cAAIE,UAAU,GAAG,KAAKD,SAAL,CAAenB,IAAf,CAAoBD,YAApB,CAAiCpB,WAAjC,EAA8C0C,MAA/D;;AACA,cAAID,UAAU,GAAG,EAAjB,EAAqB;AAAC;AAClBA,YAAAA,UAAU,GAAG,EAAb;AACH,WAZgB,CAajB;;;AACA,eAAKjB,WAAL,CAAiBH,IAAjB,CAAsBD,YAAtB,CAAmCpB,WAAnC,EAAgD0C,MAAhD,GAAyDD,UAAzD;AACA,eAAKE,MAAL,CAAYvB,YAAZ,CAAyBpB,WAAzB,EAAsC0C,MAAtC,GAA+CD,UAAU,GAAG,GAA5D;AACA,eAAKG,MAAL,CAAYxB,YAAZ,CAAyBpB,WAAzB,EAAsC0C,MAAtC,GAA+CD,UAAU,GAAG,EAA5D;AACH;;AAEOlB,QAAAA,eAAe,CAACsB,CAAD,EAAIC,KAAJ,EAAW,CAC9B;AACH;;AACDC,QAAAA,MAAM,CAACC,SAAD,EAAoB,CAEzB;;AAGMC,QAAAA,eAAe,CAACJ,CAAD,EAAIC,KAAJ,EAAW;AAC7B,kBAAQA,KAAR;AACI,iBAAK,SAAL;AACI,mBAAKI,UAAL,CAAgBC,MAAhB,GAAyB,IAAzB;AACA,mBAAKtB,SAAL,CAAeC,MAAf,GAAwB,6BAAxB;AACA;;AACJ,iBAAK,SAAL;AACI,mBAAKoB,UAAL,CAAgBC,MAAhB,GAAyB,IAAzB;AACA,mBAAKtB,SAAL,CAAeC,MAAf,GAAwB,6BAAxB;AACA;;AACJ,iBAAK,SAAL;AACI,mBAAKoB,UAAL,CAAgBC,MAAhB,GAAyB,IAAzB;AACA,mBAAKtB,SAAL,CAAeC,MAAf,GAAwB,6BAAxB;AACA;;AACJ,iBAAK,SAAL;AACI,mBAAKoB,UAAL,CAAgBC,MAAhB,GAAyB,IAAzB;AACA,mBAAKtB,SAAL,CAAeC,MAAf,GAAwB,8BAAxB;AACA;AAhBR;;AAkBA,eAAKsB,YAAL,CAAkB,MAAM;AACpB,iBAAKF,UAAL,CAAgBC,MAAhB,GAAyB,KAAzB;AACH,WAFD,EAEG,CAFH;AAGH;;AAEDb,QAAAA,cAAc,CAACe,GAAD,EAAM;AAChB;AACA;AACA;AACA;AACA,iBAAO,YAAYC,IAAZ,CAAiBD,GAAjB,CAAP;AACH;;AAEDE,QAAAA,iBAAiB,CAACC,IAAD,EAAe;AAC5B,gBAAMC,OAAO,GAAGD,IAAI,GAAG,YAAH,GAAkB,YAAtC;AACA,eAAKE,IAAL,CAAUtC,YAAV,CAAuB3B,SAAvB,EAAkCkE,IAAlC,CAAuCF,OAAvC,EAF4B,CAG5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEH;;AAIDG,QAAAA,cAAc,GAAE,CAEf;;AAEDC,QAAAA,mBAAmB,GAAE,CAEpB;AACD;AACJ;AACA;;;AACWC,QAAAA,kBAAkB,GAAG;AACxB,eAAKC,mBAAL;AACA,eAAKvC,WAAL,CAAiBwC,IAAjB;AACH;;AAEMD,QAAAA,mBAAmB,GAAG;AACzB;AAAA;AAAA,4CAAaE,QAAb,CAAsBC,SAAtB,CAAgC,eAAhC;;AACA,cAAG;AAAA;AAAA,oCAASC,SAAT,CAAmBC,aAAtB,EAAoC;AAChC;AAAA;AAAA,oDAAgB,iBAAhB;AACA;AACH;;AACD,cAAG,CAAC;AAAA;AAAA,oCAASD,SAAT,CAAmBE,eAAvB,EAAuC;AACnC;AAAA;AAAA,oDAAgB,qBAAhB;AACA;AACH;;AACD,gBAAMC,UAA0B,GAAG;AAC/BxD,YAAAA,IAAI,EAAE;AAAA;AAAA,0CAAWyD,IADc;AAE/BhC,YAAAA,IAAI,EAAE,EAFyB;AAErB;AACViC,YAAAA,UAAU,EAAE;AAHmB,WAAnC;AAKA;AAAA;AAAA,oCAASC,IAAT,CAAc;AAAA;AAAA,sCAAUC,eAAxB,EAAyCJ,UAAzC;AACA,eAAKK,UAAL;AACA,cAAIC,IAAI,GAAG;AAAA;AAAA,oCAAST,SAAT,CAAmBU,mBAAnB,CAAuC,QAAvC,CAAX;;AACA,cAAI,CAACD,IAAL,EAAW;AACP;AAAA;AAAA,sCAAS,uBAAT;AACA;AACH;;AACD,cAAI,KAAKtC,cAAL,CAAoB,KAAKd,WAAL,CAAiBM,MAArC,CAAJ,EAAkD;AAC9C,iBAAKN,WAAL,CAAiBM,MAAjB,GAA0B,EAA1B;AACH;;AACD,cAAI,CAAC,KAAKN,WAAL,CAAiBM,MAAtB,EAA8B;AAC1B;AAAA;AAAA,sCAAS;AAAA;AAAA,sCAASC,WAAT,CAAqBC,UAArB,CAAgC,KAAhC,CAAT;AACA;AACH;;AACD,cAAI,KAAKjB,QAAT,EAAmB;AACf;AAAA;AAAA,sCAAS;AAAA;AAAA,sCAASgB,WAAT,CAAqBC,UAArB,CAAgC,KAAhC,CAAT;AACA;AACH;;AACD;AAAA;AAAA,oCAASmC,SAAT,CAAmBW,OAAnB,CAA2B;AAAA;AAAA,4CAAab,QAAb,CAAsBc,WAAtB,EAA3B,EAAgE,KAAKvD,WAAL,CAAiBM,MAAjF;AACA,eAAKf,QAAL,GAAgB,IAAhB;AACA;AAAA;AAAA,oCAASoD,SAAT,CAAmBC,aAAnB,GAAmC,IAAnC;AACA,eAAKlB,UAAL,CAAgBC,MAAhB,GAAyB,IAAzB;AACA,eAAKI,iBAAL,CAAuB,IAAvB;AACA,eAAKyB,QAAL,CAAc,KAAKC,eAAnB,EAAoC,KAAKjE,WAAzC,EAtCyB,CAsC8B;;AACvD,eAAKQ,WAAL,CAAiBM,MAAjB,GAA0B,EAA1B;AACA,eAAKJ,aAAL,CAAmB,IAAnB,EAxCyB,CAyCzB;AACH;;AAGoB;AACrBuD,QAAAA,eAAe,GAAG;AACd,cAAI,KAAK/D,eAAL,GAAuB,KAAKD,SAAhC,EAA2C;AACvC,iBAAKY,SAAL,CAAeC,MAAf,IAAyB,GAAzB,CADuC,CACT;;AAC9B,iBAAKZ,eAAL,GAFuC,CAEf;AAC3B,WAHD,MAGO;AACH,iBAAKA,eAAL,GAAuB,CAAvB,CADG,CACuB;AAC1B;AACA;;AACA,iBAAKW,SAAL,CAAeC,MAAf,GAAwB;AAAA;AAAA,sCAASC,WAAT,CAAqBC,UAArB,CAAgC,KAAhC,CAAxB;AACH;AACJ;;AAED;AACAkD,QAAAA,cAAc,GAAG;AACb,eAAKnE,QAAL,GAAgB,KAAhB;AACA;AAAA;AAAA,oCAASoD,SAAT,CAAmBC,aAAnB,GAAmC,KAAnC;AACA,eAAKe,UAAL,CAAgB,KAAKF,eAArB,EAHa,CAGyB;AACzC;;AACD;AACJ;AACA;AACWG,QAAAA,YAAY,GAAG;AAClB,eAAKD,UAAL,CAAgB,KAAKR,UAArB;AACA,eAAKO,cAAL;AACA,cAAIG,GAAG,GAAG,KAAKnC,UAAL,CAAgBoC,cAAhB,CAA+B,aAA/B,CAAV;AACA,cAAIC,EAAE,GAAG,KAAKrC,UAAL,CAAgBoC,cAAhB,CAA+B,QAA/B,CAAT;AACA,cAAI5C,MAAM,GAAG2C,GAAG,CAACjE,YAAJ,CAAiBpB,WAAjB,EAA8B0C,MAA3C;;AACA,cAAIA,MAAM,GAAG,EAAb,EAAiB;AACbA,YAAAA,MAAM,GAAG,EAAT;AACH;;AACD6C,UAAAA,EAAE,CAACnE,YAAH,CAAgBpB,WAAhB,EAA6B0C,MAA7B,GAAsCA,MAAM,GAAG,EAA/C,CATkB,CAUlB;;AACA,eAAKQ,UAAL,CAAgB9B,YAAhB,CAA6BpB,WAA7B,EAA0C0C,MAA1C,GAAmDA,MAAM,GAAG,EAA5D;AACH,SAjN8C,CAkN/C;;;AACQN,QAAAA,iBAAiB,GAAG;AACxB,eAAKuC,UAAL;AACH;;AACMA,QAAAA,UAAU,GAAG;AAChB,cAAG,CAAC,KAAKjB,IAAL,CAAUtC,YAAV,CAAuBpB,WAAvB,EAAoCwF,KAAxC,EAA8C;AAC1C;AACH;;AACD,cAAID,EAAE,GAAG,KAAKrC,UAAL,CAAgBoC,cAAhB,CAA+B,QAA/B,CAAT,CAJgB,CAKhB;;AACA,eAAK/B,iBAAL,CAAuB,KAAvB,EANgB,CAOhB;;AACA,eAAK1B,SAAL,CAAeC,MAAf,GAAwB;AAAA;AAAA,oCAASC,WAAT,CAAqBC,UAArB,CAAgC,KAAhC,CAAxB;AACAuD,UAAAA,EAAE,CAACnE,YAAH,CAAgBpB,WAAhB,EAA6B0C,MAA7B,GAAsC,EAAtC;AACA,eAAKQ,UAAL,CAAgB9B,YAAhB,CAA6BpB,WAA7B,EAA0C0C,MAA1C,GAAmD,EAAnD;AACH;;AAEOd,QAAAA,YAAY,CAAC6D,EAAD,EAAK;AACrB,cAAIC,IAA0B,GAAGD,EAAE,CAACC,IAApC;;AACA,cAAG,CAACA,IAAI,CAACA,IAAL,CAAUC,OAAV,CAAkBC,MAAtB,EAA6B;AACzB;AACH;;AACD;AAAA;AAAA,4CAAa3B,QAAb,CAAsBC,SAAtB,CAAgC,aAAhC;AACA,cAAIM,UAAU,GAAGkB,IAAI,CAACA,IAAL,CAAUC,OAAV,CAAkBC,MAAlB,GAA2B,EAA3B,GAAgC,CAAjD,CANqB,CAM6B;;AAClD,eAAK1C,UAAL,CAAgBC,MAAhB,GAAyB,IAAzB;AACA,eAAKI,iBAAL,CAAuB,IAAvB;AACA,eAAK1B,SAAL,CAAeC,MAAf,GAAyB,GAAE4D,IAAI,CAACA,IAAL,CAAUC,OAAQ,EAA7C;AACA,eAAKnE,WAAL,CAAiBH,IAAjB,CAAsBD,YAAtB,CAAmCpB,WAAnC,EAAgD0C,MAAhD,GAAyD,EAAzD;AACA,eAAKF,SAAL,CAAeV,MAAf,GAAwB,EAAxB;AACA,eAAKN,WAAL,CAAiBM,MAAjB,GAA0B,EAA1B;AACA,eAAKa,MAAL,CAAYvB,YAAZ,CAAyBpB,WAAzB,EAAsC0C,MAAtC,GAA+C,GAA/C;AACA,eAAKE,MAAL,CAAYxB,YAAZ,CAAyBpB,WAAzB,EAAsC0C,MAAtC,GAA+C,EAA/C;AACA,eAAKU,YAAL,CAAkB,MAAM;AACpB,iBAAKgC,YAAL;AACA,iBAAKhC,YAAL,CAAkB,KAAKuB,UAAvB,EAAmCH,UAAnC;AACH,WAHD,EAGG,CAHH;AAIH;;AAEMqB,QAAAA,sBAAsB,GAAG;AAC5B,eAAKzE,YAAL;AAAA;AAAA,oCAA4B0E,YAA5B;AACH;;AACMC,QAAAA,oBAAoB,GAAG;AAC1B,eAAKC,YAAL,CAAkBC,GAAlB,CAAsBnG,IAAI,CAACO,SAAL,CAAe6F,SAArC,EAAgD,KAAKH,oBAArD,EAA2E,IAA3E;AACA,eAAK3E,YAAL;AAAA;AAAA,oCAA4B0E,YAA5B;AACH;AACD;AACJ;AACA;AACA;;;AACW5D,QAAAA,gBAAgB,CAACuD,EAAD,EAAK;AACxB,cAAG;AAAA;AAAA,oCAAStB,SAAT,CAAmBgC,WAAtB,EAAkC;AAC9B;AACH;;AACD,cAAIT,IAA4B,GAAGD,EAAE,CAACC,IAAtC;AACA,eAAKxC,UAAL,CAAgBC,MAAhB,GAAyB,IAAzB;AACA,eAAKI,iBAAL,CAAuB,IAAvB;AACA,eAAK1B,SAAL,CAAeC,MAAf,GAAyB,GAAE4D,IAAI,CAACA,IAAL,CAAUU,GAAI,EAAzC;AACA,eAAK5E,WAAL,CAAiBH,IAAjB,CAAsBD,YAAtB,CAAmCpB,WAAnC,EAAgD0C,MAAhD,GAAyD,EAAzD;AACA,eAAKF,SAAL,CAAeV,MAAf,GAAwB,EAAxB;AACA,eAAKN,WAAL,CAAiBM,MAAjB,GAA0B,EAA1B;AACA,eAAKa,MAAL,CAAYvB,YAAZ,CAAyBpB,WAAzB,EAAsC0C,MAAtC,GAA+C,GAA/C;AACA,eAAKE,MAAL,CAAYxB,YAAZ,CAAyBpB,WAAzB,EAAsC0C,MAAtC,GAA+C,EAA/C;AACA,eAAKU,YAAL,CAAkB,MAAM;AACpB,iBAAKgC,YAAL;AACA,iBAAKhC,YAAL,CAAkB,KAAKuB,UAAvB,EAAmC,EAAnC;AACH,WAHD,EAGG,CAHH;AAIH;;AAEM0B,QAAAA,SAAS,GAAG;AACnB;AACI;AAAA;AAAA,oCAASJ,GAAT,CAAa;AAAA;AAAA,sCAAUtE,WAAvB,EAAoC,KAAKC,YAAzC,EAAuD,IAAvD;AACH;;AAzR8C,O","sourcesContent":["import { _decorator, Animation, AnimationClip, Color, Component, director, EditBox, HorizontalTextAlignment, Label, Material, Node, RichText, Sprite, tween, UITransform, Vec3, VerticalTextAlignment } from 'cc';\nimport { TabGroup } from './TabGroup';\nimport { modelMgr, observer } from '../../game/App';\nimport { GlobalConfig } from '../../game/config/GlobalConfig';\nimport { EventType } from '../../EventType';\nimport { network } from '../../model/RequestData';\nimport { showMsg2 } from '../../core/message/MessageManager';\nimport { ToastMask } from '../../core/message/toastMask';\nimport { showMsgWithMask } from '../../core/message/MaskToastManager';\nimport { ActionType, TouchCatTips } from '../../model/StaticTextConfig';\nimport { CatActionInfo } from '../../game/config/DataStruct';\nimport { AudioManager } from '../../manager/AudioManager';\nconst { ccclass, property } = _decorator;\n\nconst TAG = 'BottomTapsComponent'\n\n@ccclass('BottomTapsComponent')\nexport class BottomTapsComponent extends Component {\n    @property({ type: [Node] })\n    public mask: Node;\n    @property({ type: [Node] })\n    public node_qipao: Node;\n    @property({ type: Label })\n    public txt_qipao: Label;\n    @property({ type: [Node] })\n    public node_content: Node;\n    @property({ type: [EditBox] })\n    public editBoxNode: EditBox;\n    @property({ type: [EditBox] })\n    public editBoxNode2: EditBox;\n    @property({ type: [Label] })\n    public tempLabel: Label;\n    @property({ type: [Sprite] })\n    public chtbg1: Sprite;\n    @property({ type: [Sprite] })\n    public chtbg2: Sprite;\n\n    @property(Material)\n    mat:Material;\n    @property(Sprite)\n    transitionNode:Sprite\n\n    start() {\n        this.getComponent(TabGroup).node.on(\"update_tab_content\", this.upatetabHandler, this);\n        this.editBoxNode.node.on(EditBox.EventType.TEXT_CHANGED, this.onTextChanged, this);\n        observer.on(EventType.SOCKET_CHAT, this.chatresponse, this);\n        this.txt_qipao.string = modelMgr.configModel.getStrById(10012);\n        observer.on(EventType.SOCKET_ZHAOHU, this.zhaohuRepHandler, this);\n        observer.on(EventType.SOCKET_CHANGE_CATS, this.changeCatsHandler, this);\n\n    }\n    onTextChanged(event) {\n        // 获取文本内容  \n        if (this.isOnlyNewLines(this.editBoxNode.string)) {\n            this.editBoxNode.string = \"\";\n        }\n        let text = this.editBoxNode.string;\n        this.tempLabel.string = text;\n\n        // 测量文本高度  \n        let textHeight = this.tempLabel.node.getComponent(UITransform).height;\n        if (textHeight < 38) {//一样文本的高度\n            textHeight = 38;\n        }\n        // 根据文本高度调整 EditBox 的高度（可能还需要考虑一些额外的边距）  \n        this.editBoxNode.node.getComponent(UITransform).height = textHeight;\n        this.chtbg1.getComponent(UITransform).height = textHeight + 353;\n        this.chtbg2.getComponent(UITransform).height = textHeight + 45;\n    }\n\n    private upatetabHandler(e, index) {\n        // this.node_content.on(Node.EventType.TOUCH_END, this.resetbottomtabsClick, this);\n    }\n    update(deltaTime: number) {\n\n    }\n\n\n    public btnclickHandler(e, index) {\n        switch (index) {\n            case \"jiaoyu1\":\n                this.node_qipao.active = true;\n                this.txt_qipao.string = \"<color=#00ff00>普通教育</color>\";\n                break;\n            case \"jiaoyu2\":\n                this.node_qipao.active = true;\n                this.txt_qipao.string = \"<color=#00ff00>家庭教育</color>\";\n                break;\n            case \"touwei1\":\n                this.node_qipao.active = true;\n                this.txt_qipao.string = \"<color=#00ff00>普通猫粮</color>\";\n                break;\n            case \"touwei2\":\n                this.node_qipao.active = true;\n                this.txt_qipao.string = \"<color=#00ff00>金色小鱼干</color>\";\n                break;\n        }\n        this.scheduleOnce(() => {\n            this.node_qipao.active = false;\n        }, 3);\n    }\n\n    isOnlyNewLines(str) {\n        // 这个正则表达式匹配任意数量的换行符\n        // ^ 表示字符串开始，$ 表示字符串结束\n        // [\\r\\n] 匹配任何一个换行符或回车符\n        // * 表示匹配前面的子表达式零次或多次\n        return /^[\\r\\n]*$/.test(str);\n    }\n\n    chatBubbleVisible(show: boolean){\n        const aniName = show ? 'bubbleShow' : 'bubbleHide'\n        this.mask.getComponent(Animation).play(aniName)\n        // this.node_qipao.getChildByName('Label_title').active = show\n        // let start = show ? {num:0} : {num:255};\n        // let end = show ? {num:255} : {num:0};\n        // const sp = this.transitionNode;\n        // const color = new Color(255,255,255);\n        // sp.color = color;\n        // const mat = this.mat;\n        // sp.material = mat;\n        // tween(start).delay(0.0016).to(0.3,end, {\n        //     onUpdate(target:any, ratio: number) {\n        //         color.r = target.num;\n        //         sp.color = color;\n        //     },\n        // }).start();\n\n    }\n\n\n\n    chatBubbleHide(){\n\n    }\n\n    checkCatActionState(){\n\n    }\n    /**\n     * 回车响应\n     */\n    public inputReturnHandler() {\n        this.inputokClickHandler();\n        this.editBoxNode.blur();\n    }\n    private _editing: boolean = false;\n    public inputokClickHandler() {\n        AudioManager.instance.playSound(\"new_NormanBtn\");\n        if(modelMgr.mainModel.chatIsediting){\n            showMsgWithMask(\"chat is editing\");\n            return\n        }\n        if(!modelMgr.mainModel.playAniComplete){\n            showMsgWithMask(\"Cat has Action now!\");\n            return\n        }\n        const actionData : CatActionInfo = {\n            type: ActionType.TALK,\n            text: '', //谈话的动作气泡词由websocket推送提供\n            duringTime: 5\n        }\n        observer.post(EventType.SEND_CAT_ACTION, actionData)\n        this.resetQipao();\n        let tili = modelMgr.mainModel.getserItemCountById(10101002);\n        if (!tili) {\n            showMsg2(\"Insufficient AP value\");\n            return;\n        }\n        if (this.isOnlyNewLines(this.editBoxNode.string)) {\n            this.editBoxNode.string = \"\";\n        }\n        if (!this.editBoxNode.string) {\n            showMsg2(modelMgr.configModel.getStrById(10010));\n            return;\n        }\n        if (this._editing) {\n            showMsg2(modelMgr.configModel.getStrById(10012));\n            return;\n        }\n        modelMgr.mainModel.chatReq(GlobalConfig.instance.getCurCatId(), this.editBoxNode.string);\n        this._editing = true;\n        modelMgr.mainModel.chatIsediting = true\n        this.node_qipao.active = true;\n        this.chatBubbleVisible(true)\n        this.schedule(this.startTypingDots, this.dotInterval); // 安排下一次输入点的回调  \n        this.editBoxNode.string = \"\";\n        this.onTextChanged(null);\n        // this.unschedule(this.resetQipao);\n    }\n    dotInterval = 0.5; // 每个点之间的时间间隔，单位是秒  \n    dotsCount = 3; // 要输入的点的数量  \n    currentDotIndex = 0; // 当前点的索引  \n    startTypingDots() {\n        if (this.currentDotIndex < this.dotsCount) {\n            this.txt_qipao.string += '.'; // 在文本框末尾添加点  \n            this.currentDotIndex++; // 递增点的索引  \n        } else {\n            this.currentDotIndex = 0; // 重置点的索引，如果需要的话  \n            // 可以在这里添加额外的逻辑，比如重置文本框内容或停止输入等  \n            // this.txt_qipao.string = \"正在生成中\"\n            this.txt_qipao.string = modelMgr.configModel.getStrById(10012);\n        }\n    };\n\n    // 如果需要停止输入点，可以调用这个函数  \n    stopTypingDots() {\n        this._editing = false;\n        modelMgr.mainModel.chatIsediting = false\n        this.unschedule(this.startTypingDots);// 取消所有安排的回调  \n    };\n    /***\n     * 气泡自适应\n     */\n    public setNodeWidth() {\n        this.unschedule(this.resetQipao);\n        this.stopTypingDots();\n        let txt = this.node_qipao.getChildByName(\"Label_title\");\n        let bg = this.node_qipao.getChildByName(\"Sprite\");\n        let height = txt.getComponent(UITransform).height;\n        if (height < 55) {\n            height = 70;\n        }\n        bg.getComponent(UITransform).height = height + 30;\n        //this.mask.getComponent(UITransform).height = height + 180;\n        this.node_qipao.getComponent(UITransform).height = height + 30;\n    }\n    //切换猫咪清除掉开场白\n    private changeCatsHandler() {\n        this.resetQipao();\n    }\n    public resetQipao() {\n        if(!this.mask.getComponent(UITransform).width){\n            return\n        }\n        let bg = this.node_qipao.getChildByName(\"Sprite\");\n        //this.node_qipao.active = false;\n        this.chatBubbleVisible(false)\n        // this.txt_qipao.string = \"正在生成中\";\n        this.txt_qipao.string = modelMgr.configModel.getStrById(10012);\n        bg.getComponent(UITransform).height = 98;\n        this.node_qipao.getComponent(UITransform).height = 98;\n    }\n\n    private chatresponse(da) {\n        let data: network.chatResponse = da.data;\n        if(!data.data.message.length){\n            return\n        }\n        AudioManager.instance.playSound(\"new_catChat\");\n        let duringTime = data.data.message.length ? 20 : 0//之前写死的7\n        this.node_qipao.active = true;\n        this.chatBubbleVisible(true)\n        this.txt_qipao.string = `${data.data.message}`;\n        this.editBoxNode.node.getComponent(UITransform).height = 38;\n        this.tempLabel.string = \"\";\n        this.editBoxNode.string = \"\";\n        this.chtbg1.getComponent(UITransform).height = 353;\n        this.chtbg2.getComponent(UITransform).height = 81;\n        this.scheduleOnce(() => {\n            this.setNodeWidth();\n            this.scheduleOnce(this.resetQipao, duringTime);\n        }, 0);\n    }\n\n    public closeinputClickHandler() {\n        this.getComponent(TabGroup).resetAllTabs();\n    }\n    public resetbottomtabsClick() {\n        this.node_content.off(Node.EventType.TOUCH_END, this.resetbottomtabsClick, this);\n        this.getComponent(TabGroup).resetAllTabs();\n    }\n    /**\n     * 打招呼响应\n     * @param da \n     */\n    public zhaohuRepHandler(da) {\n        if(modelMgr.mainModel.hasToySpine){\n            return\n        }\n        let data: network.zhaohuResponse = da.data;\n        this.node_qipao.active = true;\n        this.chatBubbleVisible(true)\n        this.txt_qipao.string = `${data.data.msg}`;\n        this.editBoxNode.node.getComponent(UITransform).height = 38;\n        this.tempLabel.string = \"\";\n        this.editBoxNode.string = \"\";\n        this.chtbg1.getComponent(UITransform).height = 353;\n        this.chtbg2.getComponent(UITransform).height = 81;\n        this.scheduleOnce(() => {\n            this.setNodeWidth();\n            this.scheduleOnce(this.resetQipao, 20);\n        }, 0);\n    }\n\n    public onDestroy() {\n    //    if(this.node_content) this.node_content.off(Node.EventType.MOUSE_DOWN, this.resetbottomtabsClick, this);\n        observer.off(EventType.SOCKET_CHAT, this.chatresponse, this);\n    }\n\n}\n\n\n"]}