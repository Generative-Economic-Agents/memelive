{"version":3,"sources":["file:///Users/feiwang/cutepet/node_modules/request/lib/auth.js"],"names":["_cjsLoader","_req","__cjsMetaURL","_req0","_req1","url","define","exports","require","module","__filename","__dirname","caseless","uuid","helpers","md5","toBase64","Auth","request","hasAuth","sentAuth","bearerToken","user","pass","prototype","basic","sendImmediately","self","undefined","emit","Error","header","authHeader","bearer","digest","method","path","challenge","re","match","exec","ha1Compute","algorithm","realm","nonce","cnonce","ha1","toLowerCase","qop","test","nc","replace","ha2","digestResponse","authValues","username","uri","response","opaque","k","push","join","onRequest","setHeader","onResponse","c","headers","get","authVerb","split","debug","_cjsExports","_Auth"],"mappings":"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","sourcesContent":["import _cjsLoader from 'cce:/internal/ml/cjs-loader.mjs';\nimport { __cjsMetaURL as _req} from 'caseless';\nimport { __cjsMetaURL as _req0} from 'uuid/v4';\nimport { __cjsMetaURL as _req1} from './helpers';\nlet _cjsExports;\nlet _Auth;\nconst __cjsMetaURL = import.meta.url;\n_cjsLoader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {\n// #region ORIGINAL CODE\n\n\n 'use strict'\n\n var caseless = require('caseless')\n var uuid = require('uuid/v4')\n var helpers = require('./helpers')\n\n var md5 = helpers.md5\n var toBase64 = helpers.toBase64\n\n function Auth (request) {\n   // define all public properties here\n   this.request = request\n   this.hasAuth = false\n   this.sentAuth = false\n   this.bearerToken = null\n   this.user = null\n   this.pass = null\n }\n\n Auth.prototype.basic = function (user, pass, sendImmediately) {\n   var self = this\n   if (typeof user !== 'string' || (pass !== undefined && typeof pass !== 'string')) {\n     self.request.emit('error', new Error('auth() received invalid user or password'))\n   }\n   self.user = user\n   self.pass = pass\n   self.hasAuth = true\n   var header = user + ':' + (pass || '')\n   if (sendImmediately || typeof sendImmediately === 'undefined') {\n     var authHeader = 'Basic ' + toBase64(header)\n     self.sentAuth = true\n     return authHeader\n   }\n }\n\n Auth.prototype.bearer = function (bearer, sendImmediately) {\n   var self = this\n   self.bearerToken = bearer\n   self.hasAuth = true\n   if (sendImmediately || typeof sendImmediately === 'undefined') {\n     if (typeof bearer === 'function') {\n       bearer = bearer()\n     }\n     var authHeader = 'Bearer ' + (bearer || '')\n     self.sentAuth = true\n     return authHeader\n   }\n }\n\n Auth.prototype.digest = function (method, path, authHeader) {\n   // TODO: More complete implementation of RFC 2617.\n   //   - handle challenge.domain\n   //   - support qop=\"auth-int\" only\n   //   - handle Authentication-Info (not necessarily?)\n   //   - check challenge.stale (not necessarily?)\n   //   - increase nc (not necessarily?)\n   // For reference:\n   // http://tools.ietf.org/html/rfc2617#section-3\n   // https://github.com/bagder/curl/blob/master/lib/http_digest.c\n\n   var self = this\n\n   var challenge = {}\n   var re = /([a-z0-9_-]+)=(?:\"([^\"]+)\"|([a-z0-9_-]+))/gi\n   while (true) {\n     var match = re.exec(authHeader)\n     if (!match) {\n       break\n     }\n     challenge[match[1]] = match[2] || match[3]\n   }\n\n   /**\n    * RFC 2617: handle both MD5 and MD5-sess algorithms.\n    *\n    * If the algorithm directive's value is \"MD5\" or unspecified, then HA1 is\n    *   HA1=MD5(username:realm:password)\n    * If the algorithm directive's value is \"MD5-sess\", then HA1 is\n    *   HA1=MD5(MD5(username:realm:password):nonce:cnonce)\n    */\n   var ha1Compute = function (algorithm, user, realm, pass, nonce, cnonce) {\n     var ha1 = md5(user + ':' + realm + ':' + pass)\n     if (algorithm && algorithm.toLowerCase() === 'md5-sess') {\n       return md5(ha1 + ':' + nonce + ':' + cnonce)\n     } else {\n       return ha1\n     }\n   }\n\n   var qop = /(^|,)\\s*auth\\s*($|,)/.test(challenge.qop) && 'auth'\n   var nc = qop && '00000001'\n   var cnonce = qop && uuid().replace(/-/g, '')\n   var ha1 = ha1Compute(challenge.algorithm, self.user, challenge.realm, self.pass, challenge.nonce, cnonce)\n   var ha2 = md5(method + ':' + path)\n   var digestResponse = qop\n     ? md5(ha1 + ':' + challenge.nonce + ':' + nc + ':' + cnonce + ':' + qop + ':' + ha2)\n     : md5(ha1 + ':' + challenge.nonce + ':' + ha2)\n   var authValues = {\n     username: self.user,\n     realm: challenge.realm,\n     nonce: challenge.nonce,\n     uri: path,\n     qop: qop,\n     response: digestResponse,\n     nc: nc,\n     cnonce: cnonce,\n     algorithm: challenge.algorithm,\n     opaque: challenge.opaque\n   }\n\n   authHeader = []\n   for (var k in authValues) {\n     if (authValues[k]) {\n       if (k === 'qop' || k === 'nc' || k === 'algorithm') {\n         authHeader.push(k + '=' + authValues[k])\n       } else {\n         authHeader.push(k + '=\"' + authValues[k] + '\"')\n       }\n     }\n   }\n   authHeader = 'Digest ' + authHeader.join(', ')\n   self.sentAuth = true\n   return authHeader\n }\n\n Auth.prototype.onRequest = function (user, pass, sendImmediately, bearer) {\n   var self = this\n   var request = self.request\n\n   var authHeader\n   if (bearer === undefined && user === undefined) {\n     self.request.emit('error', new Error('no auth mechanism defined'))\n   } else if (bearer !== undefined) {\n     authHeader = self.bearer(bearer, sendImmediately)\n   } else {\n     authHeader = self.basic(user, pass, sendImmediately)\n   }\n   if (authHeader) {\n     request.setHeader('authorization', authHeader)\n   }\n }\n\n Auth.prototype.onResponse = function (response) {\n   var self = this\n   var request = self.request\n\n   if (!self.hasAuth || self.sentAuth) { return null }\n\n   var c = caseless(response.headers)\n\n   var authHeader = c.get('www-authenticate')\n   var authVerb = authHeader && authHeader.split(' ')[0].toLowerCase()\n   request.debug('reauth', authVerb)\n\n   switch (authVerb) {\n     case 'basic':\n       return self.basic(self.user, self.pass, true)\n\n     case 'bearer':\n       return self.bearer(self.bearerToken, true)\n\n     case 'digest':\n       return self.digest(request.method, request.path, authHeader)\n   }\n }\n\n exports.Auth = Auth\n\n\n// #endregion ORIGINAL CODE\n\n_cjsExports = module.exports;\n_Auth = module.exports.Auth;\n\n}, () => ({\n  'caseless': _req,\n  'uuid/v4': _req0,\n  './helpers': _req1,\n}));\nexport { _cjsExports as default };\nexport { __cjsMetaURL }\n"]}