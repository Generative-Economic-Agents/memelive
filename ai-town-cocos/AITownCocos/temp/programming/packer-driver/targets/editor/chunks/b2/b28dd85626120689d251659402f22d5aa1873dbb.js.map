{"version":3,"sources":["file:///Users/feiwang/AITown/AITownCocos/assets/src/utils/WebUtils.ts"],"names":["WebUtils","assetManager","SpriteFrame","Texture2D","Sprite","Node","resources","Prefab","instantiate","error","Layers","UITransform","Vec2","Log","TAG","getRemoteImg","remoteUrl","sprite","callback","log","loadRemote","err","imageAsset","spriteFrame","texture","components","length","getComponent","image","resMap","getResouceImg","load","getResoucePrefab","prefab","newNode","addChild","preloadPrefab","protocal","url","indexOf","replace","loadRes","type","cb","res","message","createSprite","width","height","name","spr","layer","Enum","UI_2D","addComponent","setAnchorPoint","throttle","fn","limit","args","timeoutStream","window","setTimeout","apply","debounce","wait","clearTimeout","timeoutStack","generateHash","inputString","encoder","TextEncoder","data","encode","hashBuffer","crypto","subtle","digest","hashHex","then","buffer","hexCodes","view","DataView","i","byteLength","value","getUint32","stringValue","toString","slice","push","join","hex","substring"],"mappings":";;;0MAwBqBA,Q;;;;;;;;;;;;;;;AAvBnBC,MAAAA,Y,OAAAA,Y;AAEAC,MAAAA,W,OAAAA,W;AACAC,MAAAA,S,OAAAA,S;AACAC,MAAAA,M,OAAAA,M;AACAC,MAAAA,I,OAAAA,I;AACAC,MAAAA,S,OAAAA,S;AACAC,MAAAA,M,OAAAA,M;AACAC,MAAAA,W,OAAAA,W;AAEAC,MAAAA,K,OAAAA,K;AAEAC,MAAAA,M,OAAAA,M;AACAC,MAAAA,W,OAAAA,W;AACAC,MAAAA,I,OAAAA,I;;AAKKC,MAAAA,G;;;;;;;;;AAEDC,MAAAA,G,GAAM,U;;yBAESd,Q,GAAN,MAAMA,QAAN,CAAe;AAM5B;AACF;AACA;AACA;AACA;AACA;AACA;AAC4B,eAAZe,YAAY,CACxBC,SADwB,EAExBC,MAAY,GAAG,IAFS,EAGxBC,QAAkB,GAAG,IAHG,EAIxB;AACA,cAAG,CAACF,SAAD,IAAc,OAAO,IAAP,IAAgB,QAAjC,EAA0C;AACxC;AAAA;AAAA,4BAAIG,GAAJ,CAAQL,GAAR,EAAa,+BAA6BE,SAA1C;AACA;AACD;;AACD,cAAG;AACDf,YAAAA,YAAY,CAACmB,UAAb,CAAoCJ,SAApC,EAAgD,CAACK,GAAD,EAAMC,UAAN,KAAqB;AACnE,oBAAMC,WAAW,GAAG,IAAIrB,WAAJ,EAApB;AACA,oBAAMsB,OAAO,GAAG,IAAIrB,SAAJ,EAAhB;;AACA,kBAAI,CAACkB,GAAD,IAAQJ,MAAZ,EAAoB;AAClB,oBAAI;AACF,sBAAI,CAACA,MAAM,CAACQ,UAAP,CAAkBC,MAAvB,EAA+B;AAC7B;AACD;;AACAT,kBAAAA,MAAM,CAACU,YAAP,CAAoBvB,MAApB,CAAD,CAAqCmB,WAArC,GAAmD,IAAnD;AACAC,kBAAAA,OAAO,CAACI,KAAR,GAAgBN,UAAhB;AACAC,kBAAAA,WAAW,CAACC,OAAZ,GAAsBA,OAAtB;;AACA,sBAAI,KAAKK,MAAL,CAAYb,SAAZ,CAAJ,EAA4B;AAC1BC,oBAAAA,MAAM,CAACU,YAAP,CAAoBvB,MAApB,EAA4BmB,WAA5B,GAA0C,KAAKM,MAAL,CAAYb,SAAZ,CAA1C;AACD,mBAFD,MAEO;AACL,yBAAKa,MAAL,CAAYb,SAAZ,IAAyBO,WAAzB;AACAN,oBAAAA,MAAM,CAACU,YAAP,CAAoBvB,MAApB,EAA4BmB,WAA5B,GAA0CA,WAA1C;AACD;AACF,iBAbD,CAaE,OAAOd,KAAP,EAAc;AACd;AAAA;AAAA,kCAAIU,GAAJ,CAAQL,GAAR,EAAYL,KAAZ;AACD;AACF;;AACD,kBAAIS,QAAJ,EAAc;AACZA,gBAAAA,QAAQ,CAACG,GAAD,EAAME,WAAN,CAAR;AACD;AACF,aAxBD;AAyBD,WA1BD,CA0BC,OAAMF,GAAN,EAAU;AACT;AAAA;AAAA,4BAAIF,GAAJ,CAAQL,GAAR,EAAY,4BAAZ,EAAyCO,GAAzC;AAED;AAEF;;AAE0B,eAAbS,aAAa,CACzBd,SADyB,EAEzBC,MAAY,GAAG,IAFU,EAGzBC,QAAkB,GAAG,IAHI,EAIzB;AACAZ,UAAAA,SAAS,CAACyB,IAAV,CACEf,SAAS,GAAG,cADd,EAEEd,WAFF,EAGE,UAAUmB,GAAV,EAAeE,WAAf,EAA4B;AAC1B,gBAAI,CAACF,GAAD,IAAQJ,MAAZ,EAAoB;AAClB;AACA;AACA,kBAAI;AACFA,gBAAAA,MAAM,CAACU,YAAP,CAAoBvB,MAApB,EAA4BmB,WAA5B,GAA0CA,WAA1C;AACD,eAFD,CAEE,OAAOd,KAAP,EAAc;AACd;AAAA;AAAA,gCAAIU,GAAJ,CAAQL,GAAR,EAAaL,KAAb;AACD;AAEF,aATD,MASO;AACL;AAAA;AAAA,8BAAIU,GAAJ,CAAQL,GAAR,EAAY,eAAZ,EAA4BE,SAA5B;AACD;;AACD,gBAAIE,QAAJ,EAAc;AACZA,cAAAA,QAAQ,CAACG,GAAD,EAAME,WAAN,CAAR;AACD;AACF,WAnBH;AAqBD;;AAE6B,eAAhBS,gBAAgB,CAC5BhB,SAD4B,EAE5BC,MAAY,GAAG,IAFa,EAG5BC,QAAkB,GAAG,IAHO,EAI5B;AACAZ,UAAAA,SAAS,CAACyB,IAAV,CAAef,SAAf,EAA0BT,MAA1B,EAAkC,UAAUc,GAAV,EAAeY,MAAf,EAAuB;AACvD,gBAAIC,OAAJ;;AACA,gBAAIjB,MAAJ,EAAY;AACV,kBAAI;AACFiB,gBAAAA,OAAO,GAAG1B,WAAW,CAACyB,MAAD,CAArB;AACAhB,gBAAAA,MAAM,CAACkB,QAAP,CAAgBD,OAAhB;AACD,eAHD,CAGE,OAAOzB,KAAP,EAAc,CAEf;AACF,aAPD,MAOO;AACL;AAAA;AAAA,8BAAIU,GAAJ,CAAQL,GAAR,EAAY,WAAZ;AACD;;AACD,gBAAII,QAAJ,EAAc;AACZA,cAAAA,QAAQ,CAACG,GAAD,EAAMa,OAAN,CAAR;AACD;AACF,WAfD;AAgBD;;AAE0B,eAAbE,aAAa,CACzBpB,SADyB,EAEzBE,QAAkB,GAAG,IAFI,EAGzB;AACAZ,UAAAA,SAAS,CAACyB,IAAV,CAAef,SAAf,EAA0BT,MAA1B,EAAkC,UAAUc,GAAV,EAAeY,MAAf,EAAuB;AACvD,gBAAIC,OAAJ;AACAA,YAAAA,OAAO,GAAG1B,WAAW,CAACyB,MAAD,CAArB;;AACA,gBAAIf,QAAJ,EAAc;AACZA,cAAAA,QAAQ,CAACG,GAAD,EAAMa,OAAN,CAAR;AACD;AACF,WAND;AAOD;;AACqB,eAARG,QAAQ,CAACC,GAAD,EAAM;AAC1B,cAAI,CAACA,GAAL,EAAU;;AACV,cAAIA,GAAG,CAACC,OAAJ,CAAY,SAAZ,MAA2B,CAAC,CAAhC,EAAmC;AACjC,mBAAQD,GAAD,CAAgBE,OAAhB,CAAwB,SAAxB,EAAkC,UAAlC,CAAP;AACD,WAFD,MAEO;AACL,gBAAIF,GAAG,CAACC,OAAJ,CAAY,UAAZ,MAA4B,CAAC,CAAjC,EAAoC;AAClC,qBAAQ,GAAED,GAAI,EAAd;AACD,aAFD,MAEO;AACL,qBAAQ,SAAQA,GAAI,EAApB,CADK,CACiB;AACvB;AACF;AACF;;AAEoB,eAAPG,OAAO,CAAkBH,GAAlB,EAA+BI,IAA/B,EAA0DC,EAA1D,EAAoE;AACvF,cAAGD,IAAH,EAAQ;AACJpC,YAAAA,SAAS,CAACyB,IAAV,CAAeO,GAAf,EAAoBI,IAApB,EAA0B,CAACrB,GAAD,EAAMuB,GAAN,KAAc;AACpC,kBAAIvB,GAAJ,EAAS;AACLZ,gBAAAA,KAAK,CAACY,GAAG,CAACwB,OAAJ,IAAexB,GAAhB,CAAL;;AACA,oBAAIsB,EAAJ,EAAQ;AACJA,kBAAAA,EAAE,CAACtB,GAAD,EAAMuB,GAAN,CAAF;AACH;;AAED;AACH;;AAED,kBAAID,EAAJ,EAAQ;AACJA,gBAAAA,EAAE,CAACtB,GAAD,EAAMuB,GAAN,CAAF;AACH;AACJ,aAbD;AAcH,WAfD,MAeO;AACHtC,YAAAA,SAAS,CAACyB,IAAV,CAAeO,GAAf,EAAoB,CAACjB,GAAD,EAAMuB,GAAN,KAAc;AAC9B,kBAAIvB,GAAJ,EAAS;AACLZ,gBAAAA,KAAK,CAACY,GAAG,CAACwB,OAAJ,IAAexB,GAAhB,CAAL;;AACA,oBAAIsB,EAAJ,EAAQ;AACJA,kBAAAA,EAAE,CAACtB,GAAD,EAAMuB,GAAN,CAAF;AACH;;AAED;AACH;;AAED,kBAAID,EAAJ,EAAQ;AACJA,gBAAAA,EAAE,CAACtB,GAAD,EAAMuB,GAAN,CAAF;AACH;AACJ,aAbD;AAcH;AACJ;;AACyB,eAAZE,YAAY,CAACC,KAAY,GAAG,EAAhB,EAAmBC,MAAa,GAAG,EAAnC,EAAsCC,IAAtC,EAAmD;AAC3E,cAAIC,GAAQ,GAAG,IAAI7C,IAAJ,EAAf;AACA6C,UAAAA,GAAG,CAACC,KAAJ,GAAYzC,MAAM,CAAC0C,IAAP,CAAYC,KAAxB,CAF2E,CAE7C;;AAC9BH,UAAAA,GAAG,CAACI,YAAJ,CAAiBlD,MAAjB;AACA8C,UAAAA,GAAG,CAACvB,YAAJ,CAAiBhB,WAAjB,EAA8B4C,cAA9B,CAA6C,IAAI3C,IAAJ,CAAS,CAAT,EAAW,CAAX,CAA7C;AACAsC,UAAAA,GAAG,CAACvB,YAAJ,CAAiBhB,WAAjB,EAA8BoC,KAA9B,GAAqCA,KAArC;AACAG,UAAAA,GAAG,CAACvB,YAAJ,CAAiBhB,WAAjB,EAA8BqC,MAA9B,GAAsCA,MAAtC;AACA,iBAAOE,GAAP;AACD,SA5K6B,CA8K9B;AAEA;;;AACsB,eAARM,QAAQ,CACpBC,EADoB,EAEpBC,KAFoB,EAGjB;AACH,iBAAO,UAAU,GAAGC,IAAb,EAA0B;AAC/B,gBAAI3D,QAAQ,CAAC4D,aAAT,KAA2B,IAA/B,EAAqC;AACnC5D,cAAAA,QAAQ,CAAC4D,aAAT,GAAyBC,MAAM,CAACC,UAAP,CAAkB,MAAM;AAC/CL,gBAAAA,EAAE,CAACM,KAAH,CAAS,IAAT,EAAeJ,IAAf;AACA3D,gBAAAA,QAAQ,CAAC4D,aAAT,GAAyB,IAAzB,CAF+C,CAEhB;AAChC,eAHwB,EAGtBF,KAHsB,CAAzB;AAID;AACF,WAPD;AAQD,SA7L6B,CA+L9B;;;AACsB,eAARM,QAAQ,CACpBP,EADoB,EAEpBQ,IAFoB,EAGjB;AACH,iBAAO,UAAU,GAAGN,IAAb,EAA0B;AAC/BO,YAAAA,YAAY,CAAClE,QAAQ,CAACmE,YAAV,CAAZ;AACAnE,YAAAA,QAAQ,CAACmE,YAAT,GAAwBN,MAAM,CAACC,UAAP,CAAkB,MAAM;AAC9CL,cAAAA,EAAE,CAACM,KAAH,CAAS,IAAT,EAAeJ,IAAf;AACD,aAFuB,EAErBM,IAFqB,CAAxB;AAGD,WALD;AAMD;;AAE+B,qBAAZG,YAAY,CAACC,WAAD,EAAsB3C,MAAtB,EAAuD;AACrF;AACA,gBAAM4C,OAAO,GAAG,IAAIC,WAAJ,EAAhB;AACA,gBAAMC,IAAI,GAAGF,OAAO,CAACG,MAAR,CAAeJ,WAAf,CAAb,CAHqF,CAKrF;;AACA,gBAAMK,UAAU,GAAGC,MAAM,CAACC,MAAP,CAAcC,MAAd,CAAqB,SAArB,EAAgCL,IAAhC,CAAnB,CANqF,CAQrF;;AACA,gBAAMM,OAAO,GAAGJ,UAAU,CAACK,IAAX,CAAgBC,MAAM,IAAI;AACtC,kBAAMC,QAAQ,GAAG,EAAjB;AACA,kBAAMC,IAAI,GAAG,IAAIC,QAAJ,CAAaH,MAAb,CAAb;;AACA,iBAAK,IAAII,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,IAAI,CAACG,UAAzB,EAAqCD,CAAC,IAAI,CAA1C,EAA6C;AACzC,oBAAME,KAAK,GAAGJ,IAAI,CAACK,SAAL,CAAeH,CAAf,CAAd,CADyC,CAEzC;;AACA,oBAAMI,WAAW,GAAG,CAAC,YAAYF,KAAK,CAACG,QAAN,CAAe,EAAf,CAAb,EAAiCC,KAAjC,CAAuC,CAAC,CAAxC,CAApB;AACAT,cAAAA,QAAQ,CAACU,IAAT,CAAcH,WAAd;AACH;;AACD,mBAAOP,QAAQ,CAACW,IAAT,CAAc,EAAd,CAAP;AACH,WAVe,CAAhB,CATqF,CAqBrF;;AACA,iBAAO,MAAMd,OAAO,CAACC,IAAR,CAAac,GAAG,IAAIA,GAAG,CAACC,SAAJ,CAAc,CAAd,EAAiBpE,MAAjB,CAApB,CAAb;AACD;;AAnO6B,O;;AAAT1B,MAAAA,Q,CAEL6B,M,GAAS,E;AAFJ7B,MAAAA,Q,CAGZmE,Y;AAHYnE,MAAAA,Q,CAIZ4D,a","sourcesContent":["import {\n  assetManager,\n  ImageAsset,\n  SpriteFrame,\n  Texture2D,\n  Sprite,\n  Node,\n  resources,\n  Prefab,\n  instantiate,\n  Asset,\n  error,\n  Constructor,\n  Layers,\n  UITransform,\n  Vec2,\n} from \"cc\";\n\nexport type AssetType<T = Asset> = Constructor<T>;\n\nimport Log from '../../../assets/src/utils/LogUtils'\n\nconst TAG = 'WebUtils'\n\nexport default class WebUtils {\n\n  public static resMap = {}\n  static timeoutStack: number;\n  static timeoutStream: number;\n\n  /**\n   * 获取远程图片\n   * @param remoteUrl \n   * @param sprite \n   * @param callback \n   * @returns \n   */\n  public static getRemoteImg(\n    remoteUrl,\n    sprite: Node = null,\n    callback: Function = null\n  ) {\n    if(!remoteUrl || typeof(\"dd\") != \"string\"){\n      Log.log(TAG, \"getRemoteImg::remoteUrl错误:\"+remoteUrl);\n      return;\n    }\n    try{\n      assetManager.loadRemote<ImageAsset>(remoteUrl,  (err, imageAsset) => {\n        const spriteFrame = new SpriteFrame();\n        const texture = new Texture2D();\n        if (!err && sprite) {\n          try {\n            if (!sprite.components.length) {\n              return;\n            }\n            (sprite.getComponent(Sprite) as any).spriteFrame = null;\n            texture.image = imageAsset;\n            spriteFrame.texture = texture;\n            if (this.resMap[remoteUrl]) {\n              sprite.getComponent(Sprite).spriteFrame = this.resMap[remoteUrl];\n            } else {\n              this.resMap[remoteUrl] = spriteFrame\n              sprite.getComponent(Sprite).spriteFrame = spriteFrame;\n            }\n          } catch (error) {\n            Log.log(TAG,error)\n          }\n        }\n        if (callback) {\n          callback(err, spriteFrame);\n        }\n      });\n    }catch(err){\n      Log.log(TAG,\"getRemoteImg::remoteUrl错误:\",err);\n      \n    }\n\n  }\n\n  public static getResouceImg(\n    remoteUrl,\n    sprite: Node = null,\n    callback: Function = null\n  ) {\n    resources.load(\n      remoteUrl + \"/spriteFrame\",\n      SpriteFrame,\n      function (err, spriteFrame) {\n        if (!err && sprite) {\n          // const spriteFrame = new SpriteFrame();\n          // spriteFrame.texture = texture;\n          try {\n            sprite.getComponent(Sprite).spriteFrame = spriteFrame;\n          } catch (error) {\n            Log.log(TAG, error)\n          }\n          \n        } else {\n          Log.log(TAG,\" or sprite 为空\",remoteUrl);\n        }\n        if (callback) {\n          callback(err, spriteFrame);\n        }\n      }\n    );\n  }\n\n  public static getResoucePrefab(\n    remoteUrl,\n    sprite: Node = null,\n    callback: Function = null\n  ) {\n    resources.load(remoteUrl, Prefab, function (err, prefab) {\n      let newNode;\n      if (sprite) {\n        try {\n          newNode = instantiate(prefab);\n          sprite.addChild(newNode);\n        } catch (error) {\n         \n        }\n      } else {\n        Log.log(TAG,\"sprite 为空\");\n      }\n      if (callback) {\n        callback(err, newNode);\n      }\n    });\n  }\n\n  public static preloadPrefab(\n    remoteUrl, \n    callback: Function = null\n  ) {\n    resources.load(remoteUrl, Prefab, function (err, prefab) {\n      let newNode;\n      newNode = instantiate(prefab);\n      if (callback) {\n        callback(err, newNode);\n      }\n    });\n  }\n  public static protocal(url) {\n    if (!url) return;\n    if (url.indexOf(\"http://\") !== -1) {\n      return (url as string).replace(\"http://\",\"https://\");\n    } else {\n      if (url.indexOf(\"https://\") !== -1) {\n        return `${url}`;\n      } else {\n        return `https:${url}`;//  \"//\"\n      }\n    }\n  }\n\n  public static loadRes<T extends Asset>(url: string, type: AssetType<T> | null, cb?: any) {\n    if(type){\n        resources.load(url, type, (err, res) => {\n            if (err) {\n                error(err.message || err);\n                if (cb) {\n                    cb(err, res);\n                }\n\n                return;\n            }\n\n            if (cb) {\n                cb(err, res);\n            }\n        });\n    } else {\n        resources.load(url, (err, res) => {\n            if (err) {\n                error(err.message || err);\n                if (cb) {\n                    cb(err, res as T);\n                }\n\n                return;\n            }\n\n            if (cb) {\n                cb(err, res as T);\n            }\n        });\n    }\n}\npublic static createSprite(width:number = 10,height:number = 10,name?:string){\n  let spr:Node = new Node();\n  spr.layer = Layers.Enum.UI_2D;//Layer 设置要准确 ui_2d;\n  spr.addComponent(Sprite);\n  spr.getComponent(UITransform).setAnchorPoint(new Vec2(0,1));\n  spr.getComponent(UITransform).width =width;\n  spr.getComponent(UITransform).height =height;\n  return spr;\n}\n\n// 使用number类型代替NodeJS.Timeout\n\n// 截流函数示例\npublic static throttle<T extends (...args: any[]) => any>(\n  fn: T,\n  limit: number\n): T {\n  return function (...args: any[]) {\n    if (WebUtils.timeoutStream === null) {\n      WebUtils.timeoutStream = window.setTimeout(() => {\n        fn.apply(this, args);\n        WebUtils.timeoutStream = null; // 确保在函数执行后重置timeout\n      }, limit);\n    }\n  } as T;\n}\n\n// 防抖函数示例\npublic static debounce<T extends (...args: any[]) => any>(\n  fn: T,\n  wait: number\n): T {\n  return function (...args: any[]) {\n    clearTimeout(WebUtils.timeoutStack as number);\n    WebUtils.timeoutStack = window.setTimeout(() => {\n      fn.apply(this, args);\n    }, wait);\n  } as T;\n}\n\npublic static async generateHash(inputString: string, length: number): Promise<string> {\n  // 将字符串转换为ArrayBuffer\n  const encoder = new TextEncoder();\n  const data = encoder.encode(inputString);\n  \n  // 使用SubtleCrypto接口生成哈希值\n  const hashBuffer = crypto.subtle.digest('SHA-256', data);\n  \n  // 将哈希值转换为十六进制字符串\n  const hashHex = hashBuffer.then(buffer => {\n      const hexCodes = [];\n      const view = new DataView(buffer);\n      for (let i = 0; i < view.byteLength; i += 4) {\n          const value = view.getUint32(i);\n          // 使用位运算和位移将字节转换为十六进制\n          const stringValue = ('0000000' + value.toString(16)).slice(-8);\n          hexCodes.push(stringValue);\n      }\n      return hexCodes.join('');\n  });\n  \n  // 返回固定长度的哈希值\n  return await hashHex.then(hex => hex.substring(0, length));\n}\n\n}\n\n\n\n\n"]}