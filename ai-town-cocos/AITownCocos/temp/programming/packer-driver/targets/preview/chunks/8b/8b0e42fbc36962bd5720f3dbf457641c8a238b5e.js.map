{"version":3,"sources":["file:///Users/feiwang/cutepet/assets/src/module/main/gedan/ChatlogListComponent.ts"],"names":["_decorator","Component","Node","modelMgr","observer","uiMgr","ListViewCtrl4","GlobalConfig","EventType","LoadingController","AudioManager","ccclass","property","ChatlogListComponent","curpage","_totalChat","_lastChat","start","ins","hideLoading","on","SOCKET_CHATLIST","updateChatlist","getAllData","mainModel","chatlistReq","instance","getCurCatId","onDestroy","off","update","deltaTime","da","data","arr","chats","reverse","unshift","totalPage","listctrl","getComponent","initData","shareClickHandler","playSound","post","closeSelf","removeParent"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAuBC,MAAAA,I,OAAAA,I;;AAEnCC,MAAAA,Q,iBAAAA,Q;AAAUC,MAAAA,Q,iBAAAA,Q;AAAUC,MAAAA,K,iBAAAA,K;;AACpBC,MAAAA,a,iBAAAA,a;;AACAC,MAAAA,Y,iBAAAA,Y;;AACAC,MAAAA,S,iBAAAA,S;;AAKAC,MAAAA,iB,iBAAAA,iB;;AACAC,MAAAA,Y,iBAAAA,Y;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBZ,U;;sCAGjBa,oB,WADZF,OAAO,CAAC,sBAAD,C,UAGHC,QAAQ,CAACV,IAAD,C,2BAHb,MACaW,oBADb,SAC0CZ,SAD1C,CACoD;AAAA;AAAA;AAAA,eACxCa,OADwC,GACtB,CADsB;;AAAA;;AAAA,eAwCxCC,UAxCwC,GAwCf,EAxCe;AAAA,eAyCxCC,SAzCwC,GAyCpB,CAAC,CAzCmB;AAAA;;AAIhDC,QAAAA,KAAK,GAAG;AACJ,eAAKH,OAAL,GAAe,CAAf;AACA,eAAKC,UAAL,GAAkB,EAAlB;AACA;AAAA;AAAA,sDAAkBG,GAAlB,CAAsBC,WAAtB;AAGA;AAAA;AAAA,oCAASC,EAAT,CAAY;AAAA;AAAA,sCAAUC,eAAtB,EAAuC,KAAKC,cAA5C,EAA4D,IAA5D,EANI,CAOJ;;AACA,eAAKC,UAAL;AACH;;AAIOA,QAAAA,UAAU,GAAG;AACjB;AAAA;AAAA,oCAASC,SAAT,CAAmBC,WAAnB,CAA+B;AAAA;AAAA,4CAAaC,QAAb,CAAsBC,WAAtB,EAA/B,EAAoE,KAAKb,OAAzE;AACH,SAnB+C,CAoBhD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;AACUc,QAAAA,SAAS,GAAS;AACxB;AAAA;AAAA,oCAASC,GAAT,CAAa;AAAA;AAAA,sCAAUR,eAAvB,EAAwC,KAAKC,cAA7C,EAA6D,IAA7D;AAEH;;AAEDQ,QAAAA,MAAM,CAACC,SAAD,EAAoB,CAEzB;;AAIOT,QAAAA,cAAc,CAACU,EAAD,EAAK;AACvB,cAAIC,IAA8B,GAAGD,EAAE,CAACC,IAAxC;AACA,cAAIC,GAAG,GAAGD,IAAI,CAACA,IAAL,CAAUE,KAAV,CAAgBC,OAAhB,EAAV,CAFuB,CAGvB;;AACA,eAAKrB,UAAL,CAAgBsB,OAAhB,CAAwB,GAAGH,GAA3B;;AACA,cAAI,KAAKpB,OAAL,GAAemB,IAAI,CAACA,IAAL,CAAUK,SAA7B,EAAwC;AACpC,iBAAKxB,OAAL;AACA,iBAAKS,UAAL;AACH,WAHD,MAGO,IAAI,KAAKT,OAAL,IAAgBmB,IAAI,CAACA,IAAL,CAAUK,SAA9B,EAAyC;AAC5C,iBAAKC,QAAL,CAAcC,YAAd;AAAA;AAAA,gDAA0CC,QAA1C,CAAmD,KAAK1B,UAAxD;AACH;AAEJ;;AACM2B,QAAAA,iBAAiB,GAAG;AACvB;AAAA;AAAA,4CAAahB,QAAb,CAAsBiB,SAAtB,CAAgC,eAAhC;AACA;AAAA;AAAA,oCAASC,IAAT,CAAc,WAAd,EAFuB,CAGvB;AAEH,SA5D+C,CA8DhD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEOC,QAAAA,SAAS,GAAG;AACf;AAAA;AAAA,4CAAanB,QAAb,CAAsBiB,SAAtB,CAAgC,eAAhC;AACA;AAAA;AAAA,8BAAMG,YAAN,CAAmB,sBAAnB;AACH;;AA1E+C,O;;;;;iBAGxB,I","sourcesContent":["import { _decorator, Component, Input, log, Node, sys, SystemEvent, systemEvent } from 'cc';\nimport { ListViewCtrl2 } from '../../../game/components/listViewCtrl2';\nimport { modelMgr, observer, uiMgr } from '../../../game/App';\nimport { ListViewCtrl4 } from '../../../game/components/listViewCtrl4';\nimport { GlobalConfig } from '../../../game/config/GlobalConfig';\nimport { EventType } from '../../../EventType';\nimport { network } from '../../../model/RequestData';\nimport { chatcell } from '../../../game/config/DataStruct';\nimport { showMsg2 } from '../../../core/message/MessageManager';\nimport BoswerUtils from '../../../utils/BoswerUtils';\nimport { LoadingController } from '../../../game/components/LoadingController';\nimport { AudioManager } from '../../../manager/AudioManager';\nconst { ccclass, property } = _decorator;\n\n@ccclass('ChatlogListComponent')\nexport class ChatlogListComponent extends Component {\n    private curpage: number = 1;\n    @property(Node)\n    public listctrl: Node = null;\n    start() {\n        this.curpage = 1;\n        this._totalChat = [];\n        LoadingController.ins.hideLoading();\n\n\n        observer.on(EventType.SOCKET_CHATLIST, this.updateChatlist, this);\n        // this.listctrl.on('scrollended', this.onMyEvent, this);\n        this.getAllData();\n    }\n\n    \n\n    private getAllData() {\n        modelMgr.mainModel.chatlistReq(GlobalConfig.instance.getCurCatId(), this.curpage);\n    }\n    // onMyEvent(data: any) {\n    //     if(this._lastChat>-1){//最后一页页码\n    //         return;\n    //     };\n    //     if(this._lastChat==10){//最大页\n    //         return;\n    //     }\n    //     this.curpage++;\n    //     modelMgr.mainModel.chatlistReq(GlobalConfig.instance.getCurCatId(), this.curpage);\n\n    // }\n    protected onDestroy(): void {\n        observer.off(EventType.SOCKET_CHATLIST, this.updateChatlist, this);\n\n    }\n\n    update(deltaTime: number) {\n\n    }\n\n    private _totalChat: chatcell[] = [];\n    private _lastChat: number = -1;\n    private updateChatlist(da) {\n        let data: network.chatListResponse = da.data;\n        let arr = data.data.chats.reverse();\n        // let arr = data.data.chats;//bottom_to_top\n        this._totalChat.unshift(...arr);\n        if (this.curpage < data.data.totalPage) {\n            this.curpage++;\n            this.getAllData();\n        } else if (this.curpage >= data.data.totalPage) {\n            this.listctrl.getComponent(ListViewCtrl4).initData(this._totalChat);\n        }\n\n    }\n    public shareClickHandler() {\n        AudioManager.instance.playSound(\"new_NormanBtn\");\n        observer.post(\"shotstart\");\n        // modelMgr.mainModel.shareReq();\n\n    }\n\n    // private copyUrl(da: any) {\n    //     let d: network.shareResponse = da.data;\n    //     let url = \"http://www.infinity.com/invite?from=4639553896547622914\";\n    //     if (d.data.url) {\n    //         url = d.data.url;\n    //     }\n    //     BoswerUtils.copystring(url);\n    // }\n\n    public closeSelf() {\n        AudioManager.instance.playSound(\"new_NormanBtn\");\n        uiMgr.removeParent(\"prefabs/pre_gequlist\");\n    }\n\n}\n\n\n"]}