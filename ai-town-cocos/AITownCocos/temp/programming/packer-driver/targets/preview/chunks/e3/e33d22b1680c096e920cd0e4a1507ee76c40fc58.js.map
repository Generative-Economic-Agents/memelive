{"version":3,"sources":["file:///Users/feiwang/cutepet/node_modules/request/lib/multipart.js"],"names":["_cjsLoader","_req","__cjsMetaURL","_req0","_req1","_req2","url","define","exports","require","module","__filename","__dirname","uuid","CombinedStream","isstream","Buffer","Multipart","request","boundary","chunked","body","prototype","isChunked","options","self","parts","data","forEach","emit","Error","undefined","getHeader","part","setHeaders","hasHeader","setHeader","header","indexOf","replace","build","add","toString","append","push","from","preambleCRLF","preamble","Object","keys","key","postambleCRLF","onRequest","_cjsExports","_Multipart"],"mappings":"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","sourcesContent":["import _cjsLoader from 'cce:/internal/ml/cjs-loader.mjs';\nimport { __cjsMetaURL as _req} from 'uuid/v4';\nimport { __cjsMetaURL as _req0} from 'combined-stream';\nimport { __cjsMetaURL as _req1} from 'isstream';\nimport { __cjsMetaURL as _req2} from 'safe-buffer';\nlet _cjsExports;\nlet _Multipart;\nconst __cjsMetaURL = import.meta.url;\n_cjsLoader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {\n// #region ORIGINAL CODE\n\n\n 'use strict'\n\n var uuid = require('uuid/v4')\n var CombinedStream = require('combined-stream')\n var isstream = require('isstream')\n var Buffer = require('safe-buffer').Buffer\n\n function Multipart (request) {\n   this.request = request\n   this.boundary = uuid()\n   this.chunked = false\n   this.body = null\n }\n\n Multipart.prototype.isChunked = function (options) {\n   var self = this\n   var chunked = false\n   var parts = options.data || options\n\n   if (!parts.forEach) {\n     self.request.emit('error', new Error('Argument error, options.multipart.'))\n   }\n\n   if (options.chunked !== undefined) {\n     chunked = options.chunked\n   }\n\n   if (self.request.getHeader('transfer-encoding') === 'chunked') {\n     chunked = true\n   }\n\n   if (!chunked) {\n     parts.forEach(function (part) {\n       if (typeof part.body === 'undefined') {\n         self.request.emit('error', new Error('Body attribute missing in multipart.'))\n       }\n       if (isstream(part.body)) {\n         chunked = true\n       }\n     })\n   }\n\n   return chunked\n }\n\n Multipart.prototype.setHeaders = function (chunked) {\n   var self = this\n\n   if (chunked && !self.request.hasHeader('transfer-encoding')) {\n     self.request.setHeader('transfer-encoding', 'chunked')\n   }\n\n   var header = self.request.getHeader('content-type')\n\n   if (!header || header.indexOf('multipart') === -1) {\n     self.request.setHeader('content-type', 'multipart/related; boundary=' + self.boundary)\n   } else {\n     if (header.indexOf('boundary') !== -1) {\n       self.boundary = header.replace(/.*boundary=([^\\s;]+).*/, '$1')\n     } else {\n       self.request.setHeader('content-type', header + '; boundary=' + self.boundary)\n     }\n   }\n }\n\n Multipart.prototype.build = function (parts, chunked) {\n   var self = this\n   var body = chunked ? new CombinedStream() : []\n\n   function add (part) {\n     if (typeof part === 'number') {\n       part = part.toString()\n     }\n     return chunked ? body.append(part) : body.push(Buffer.from(part))\n   }\n\n   if (self.request.preambleCRLF) {\n     add('\\r\\n')\n   }\n\n   parts.forEach(function (part) {\n     var preamble = '--' + self.boundary + '\\r\\n'\n     Object.keys(part).forEach(function (key) {\n       if (key === 'body') { return }\n       preamble += key + ': ' + part[key] + '\\r\\n'\n     })\n     preamble += '\\r\\n'\n     add(preamble)\n     add(part.body)\n     add('\\r\\n')\n   })\n   add('--' + self.boundary + '--')\n\n   if (self.request.postambleCRLF) {\n     add('\\r\\n')\n   }\n\n   return body\n }\n\n Multipart.prototype.onRequest = function (options) {\n   var self = this\n\n   var chunked = self.isChunked(options)\n   var parts = options.data || options\n\n   self.setHeaders(chunked)\n   self.chunked = chunked\n   self.body = self.build(parts, chunked)\n }\n\n exports.Multipart = Multipart\n\n\n// #endregion ORIGINAL CODE\n\n_cjsExports = module.exports;\n_Multipart = module.exports.Multipart;\n\n}, () => ({\n  'uuid/v4': _req,\n  'combined-stream': _req0,\n  'isstream': _req1,\n  'safe-buffer': _req2,\n}));\nexport { _cjsExports as default };\nexport { __cjsMetaURL }\n"]}