{"version":3,"sources":["file:///Users/feiwang/cutepet/node_modules/asn1/lib/ber/reader.js"],"names":["_cjsLoader","_req","__cjsMetaURL","_req0","_req1","_req2","url","define","exports","require","module","__filename","__dirname","assert","Buffer","ASN1","errors","newInvalidAsn1Error","Reader","data","isBuffer","TypeError","_buf","_size","length","_len","_offset","Object","defineProperty","prototype","enumerable","get","slice","readByte","peek","b","readLength","offset","undefined","lenB","i","readSequence","tag","seq","toString","o","readInt","_readTag","Integer","readBoolean","Boolean","readEnumeration","Enumeration","readString","retbuf","OctetString","alloc","str","readOID","OID","values","value","byte","push","shift","unshift","join","ok","fb","_cjsExports"],"mappings":"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","sourcesContent":["import _cjsLoader from 'cce:/internal/ml/cjs-loader.mjs';\nimport { __cjsMetaURL as _req} from 'assert';\nimport { __cjsMetaURL as _req0} from 'safer-buffer';\nimport { __cjsMetaURL as _req1} from './types';\nimport { __cjsMetaURL as _req2} from './errors';\nlet _cjsExports;\nconst __cjsMetaURL = import.meta.url;\n_cjsLoader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {\n// #region ORIGINAL CODE\n\n\n // Copyright 2011 Mark Cavage <mcavage@gmail.com> All rights reserved.\n\n var assert = require('assert');\n var Buffer = require('safer-buffer').Buffer;\n\n var ASN1 = require('./types');\n var errors = require('./errors');\n\n\n // --- Globals\n\n var newInvalidAsn1Error = errors.newInvalidAsn1Error;\n\n\n\n // --- API\n\n function Reader(data) {\n   if (!data || !Buffer.isBuffer(data))\n     throw new TypeError('data must be a node Buffer');\n\n   this._buf = data;\n   this._size = data.length;\n\n   // These hold the \"current\" state\n   this._len = 0;\n   this._offset = 0;\n }\n\n Object.defineProperty(Reader.prototype, 'length', {\n   enumerable: true,\n   get: function () { return (this._len); }\n });\n\n Object.defineProperty(Reader.prototype, 'offset', {\n   enumerable: true,\n   get: function () { return (this._offset); }\n });\n\n Object.defineProperty(Reader.prototype, 'remain', {\n   get: function () { return (this._size - this._offset); }\n });\n\n Object.defineProperty(Reader.prototype, 'buffer', {\n   get: function () { return (this._buf.slice(this._offset)); }\n });\n\n\n /**\n  * Reads a single byte and advances offset; you can pass in `true` to make this\n  * a \"peek\" operation (i.e., get the byte, but don't advance the offset).\n  *\n  * @param {Boolean} peek true means don't move offset.\n  * @return {Number} the next byte, null if not enough data.\n  */\n Reader.prototype.readByte = function (peek) {\n   if (this._size - this._offset < 1)\n     return null;\n\n   var b = this._buf[this._offset] & 0xff;\n\n   if (!peek)\n     this._offset += 1;\n\n   return b;\n };\n\n\n Reader.prototype.peek = function () {\n   return this.readByte(true);\n };\n\n\n /**\n  * Reads a (potentially) variable length off the BER buffer.  This call is\n  * not really meant to be called directly, as callers have to manipulate\n  * the internal buffer afterwards.\n  *\n  * As a result of this call, you can call `Reader.length`, until the\n  * next thing called that does a readLength.\n  *\n  * @return {Number} the amount of offset to advance the buffer.\n  * @throws {InvalidAsn1Error} on bad ASN.1\n  */\n Reader.prototype.readLength = function (offset) {\n   if (offset === undefined)\n     offset = this._offset;\n\n   if (offset >= this._size)\n     return null;\n\n   var lenB = this._buf[offset++] & 0xff;\n   if (lenB === null)\n     return null;\n\n   if ((lenB & 0x80) === 0x80) {\n     lenB &= 0x7f;\n\n     if (lenB === 0)\n       throw newInvalidAsn1Error('Indefinite length not supported');\n\n     if (lenB > 4)\n       throw newInvalidAsn1Error('encoding too long');\n\n     if (this._size - offset < lenB)\n       return null;\n\n     this._len = 0;\n     for (var i = 0; i < lenB; i++)\n       this._len = (this._len << 8) + (this._buf[offset++] & 0xff);\n\n   } else {\n     // Wasn't a variable length\n     this._len = lenB;\n   }\n\n   return offset;\n };\n\n\n /**\n  * Parses the next sequence in this BER buffer.\n  *\n  * To get the length of the sequence, call `Reader.length`.\n  *\n  * @return {Number} the sequence's tag.\n  */\n Reader.prototype.readSequence = function (tag) {\n   var seq = this.peek();\n   if (seq === null)\n     return null;\n   if (tag !== undefined && tag !== seq)\n     throw newInvalidAsn1Error('Expected 0x' + tag.toString(16) +\n                               ': got 0x' + seq.toString(16));\n\n   var o = this.readLength(this._offset + 1); // stored in `length`\n   if (o === null)\n     return null;\n\n   this._offset = o;\n   return seq;\n };\n\n\n Reader.prototype.readInt = function () {\n   return this._readTag(ASN1.Integer);\n };\n\n\n Reader.prototype.readBoolean = function () {\n   return (this._readTag(ASN1.Boolean) === 0 ? false : true);\n };\n\n\n Reader.prototype.readEnumeration = function () {\n   return this._readTag(ASN1.Enumeration);\n };\n\n\n Reader.prototype.readString = function (tag, retbuf) {\n   if (!tag)\n     tag = ASN1.OctetString;\n\n   var b = this.peek();\n   if (b === null)\n     return null;\n\n   if (b !== tag)\n     throw newInvalidAsn1Error('Expected 0x' + tag.toString(16) +\n                               ': got 0x' + b.toString(16));\n\n   var o = this.readLength(this._offset + 1); // stored in `length`\n\n   if (o === null)\n     return null;\n\n   if (this.length > this._size - o)\n     return null;\n\n   this._offset = o;\n\n   if (this.length === 0)\n     return retbuf ? Buffer.alloc(0) : '';\n\n   var str = this._buf.slice(this._offset, this._offset + this.length);\n   this._offset += this.length;\n\n   return retbuf ? str : str.toString('utf8');\n };\n\n Reader.prototype.readOID = function (tag) {\n   if (!tag)\n     tag = ASN1.OID;\n\n   var b = this.readString(tag, true);\n   if (b === null)\n     return null;\n\n   var values = [];\n   var value = 0;\n\n   for (var i = 0; i < b.length; i++) {\n     var byte = b[i] & 0xff;\n\n     value <<= 7;\n     value += byte & 0x7f;\n     if ((byte & 0x80) === 0) {\n       values.push(value);\n       value = 0;\n     }\n   }\n\n   value = values.shift();\n   values.unshift(value % 40);\n   values.unshift((value / 40) >> 0);\n\n   return values.join('.');\n };\n\n\n Reader.prototype._readTag = function (tag) {\n   assert.ok(tag !== undefined);\n\n   var b = this.peek();\n\n   if (b === null)\n     return null;\n\n   if (b !== tag)\n     throw newInvalidAsn1Error('Expected 0x' + tag.toString(16) +\n                               ': got 0x' + b.toString(16));\n\n   var o = this.readLength(this._offset + 1); // stored in `length`\n   if (o === null)\n     return null;\n\n   if (this.length > 4)\n     throw newInvalidAsn1Error('Integer too long: ' + this.length);\n\n   if (this.length > this._size - o)\n     return null;\n   this._offset = o;\n\n   var fb = this._buf[this._offset];\n   var value = 0;\n\n   for (var i = 0; i < this.length; i++) {\n     value <<= 8;\n     value |= (this._buf[this._offset++] & 0xff);\n   }\n\n   if ((fb & 0x80) === 0x80 && i !== 4)\n     value -= (1 << (i * 8));\n\n   return value >> 0;\n };\n\n\n\n // --- Exported API\n\n module.exports = Reader;\n\n\n// #endregion ORIGINAL CODE\n\n_cjsExports = module.exports;\n\n\n}, () => ({\n  'assert': _req,\n  'safer-buffer': _req0,\n  './types': _req1,\n  './errors': _req2,\n}));\nexport { _cjsExports as default };\nexport { __cjsMetaURL }\n"]}