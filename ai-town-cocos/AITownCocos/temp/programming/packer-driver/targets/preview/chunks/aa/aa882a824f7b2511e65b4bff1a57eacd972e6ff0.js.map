{"version":3,"sources":["file:///Users/feiwang/workSpace/AITown/cutepet/assets/src/module/main/jishi/JishiGoumaiTK.ts"],"names":["_decorator","Component","Node","Label","showMsg2","modelMgr","uiMgr","LoadingController","SpinBoxComponent","DataEvents","ComponentsUtils","WebUtils","ccclass","property","JishiGoumaiTK","danjia","_totalnum","start","ins","hideLoading","jishiModel","on","UPDATE_JISHI_SHOP","updateData","sinbox","updateMoneyHandler","oprType","btnGoumai","active","btnchushou","DATA","buyPrice","getComponent","max","quota","salePrice","amount","Label_name","string","name","Label_jieshao","profile","zongjia","chiyou","initXiangou","getRemoteImg","icon","itempic","restrict","spr_xiangou","quanta","setGray","onDestroy","off","da","data","num","Number","isNaN","choushou","flash","closeself","goumai","update","deltaTime","removeParent"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Label } from 'cc';\nimport { showMsg2 } from '../../../core/message/MessageManager';\nimport { modelMgr, uiMgr } from '../../../game/App';\nimport { LoadingController } from '../../../game/components/LoadingController';\nimport { SpinBoxComponent } from '../../../game/components/SpinBoxComponent';\nimport AxiosManager from '../../../manager/AxiosManager';\nimport { DataEvents } from '../../../model/DataEvents';\nimport ComponentsUtils from '../../../utils/ComponentsUtils';\nimport WebUtils from '../../../utils/WebUtils';\nconst { ccclass, property } = _decorator;\n\n/**\n * 购买/出售道具弹框\n */\n@ccclass('JishiGoumaiTK')\nexport class JishiGoumaiTK extends Component {\n    @property(Node)\n    public sinbox:Node = null;\n    @property(Label)\n    public zongjia:Label = null;\n\n    @property(Node)\n    public btnGoumai: Node = null;\n    @property(Node)\n    public btnchushou: Node = null;\n    @property(Label)\n    public Label_name: Label = null;\n    @property(Label)\n    public Label_jieshao: Label = null;\n\n    @property(Node)\n    public spr_xiangou: Node = null\n    @property(Label)\n    public chiyou: Label = null;\n    @property(Node)\n    public itempic: Node = null;\n\n\n    static DATA: any;\n    public danjia:number = 0;\n\n    public static oprType: string = \"\";\n\n    start() {\n        LoadingController.ins.hideLoading();\n        modelMgr.jishiModel.on(DataEvents.UPDATE_JISHI_SHOP, this.updateData, this);\n\n        this.sinbox.on(\"update_money\",this.updateMoneyHandler,this);\n        if (JishiGoumaiTK.oprType == \"goumai\") {\n            this.btnGoumai.active = true;\n            this.btnchushou.active = false;\n            this.danjia =  JishiGoumaiTK.DATA.buyPrice;\n            this.sinbox.getComponent(SpinBoxComponent).max = JishiGoumaiTK.DATA.quota;\n        } else  if (JishiGoumaiTK.oprType == \"chushou\"){\n            this.btnGoumai.active = false;\n            this.btnchushou.active = true;\n            this.danjia =  JishiGoumaiTK.DATA.salePrice;\n            this.sinbox.getComponent(SpinBoxComponent).max = JishiGoumaiTK.DATA.amount;\n        }\n        \n        this.Label_name.string = JishiGoumaiTK.DATA.name;\n        this.Label_jieshao.string = JishiGoumaiTK.DATA.profile ;\n        this.zongjia.string = this.danjia+\"\";\n\n        this.chiyou.string = \"\" + JishiGoumaiTK.DATA.amount + \"\";\n        this.Label_name.string = JishiGoumaiTK.DATA.name;\n\n        this.Label_jieshao.string = JishiGoumaiTK.DATA.profile + \"\";\n        this.zongjia.string = this.danjia + \"\";\n\n        this.initXiangou();\n\n        WebUtils.getRemoteImg(JishiGoumaiTK.DATA.icon  + \"?imageView&thumbnail=162x191\", this.itempic);\n\n    }\n    public initXiangou() {\n        switch (JishiGoumaiTK.DATA.restrict) {\n            case 0:\n                this.spr_xiangou.active = false;\n                break;\n            case 1:\n                this.spr_xiangou.active = true;\n                break;\n            case 2:\n                this.spr_xiangou.active = true;\n                break;\n            case 3:\n                this.spr_xiangou.active = true;\n                break;\n            case 4:\n                this.spr_xiangou.active = false;\n                break;\n            default:\n                this.spr_xiangou.active = false;\n                break;\n        }\n        if (this.spr_xiangou.active) {\n            this.spr_xiangou.getComponent(Label).string = \"本日剩余次数: (\" + JishiGoumaiTK.DATA.quanta + \"/\" + JishiGoumaiTK.DATA.quota + \")\";\n\n        }else{\n            this.spr_xiangou.getComponent(Label).string =\"\";\n\n        }\n        if (this.spr_xiangou.active&&JishiGoumaiTK.DATA.quanta >= JishiGoumaiTK.DATA.quota) {\n            ComponentsUtils.setGray(this.btnGoumai, true);\n        }\n    }\n    onDestroy() {\n        modelMgr.jishiModel.off(DataEvents.UPDATE_JISHI_SHOP, this.updateData, this);\n\n    }\n    public updateData(da) {\n        JishiGoumaiTK.DATA = da.data;\n        this.initXiangou();\n        this.chiyou.string = \"\" + JishiGoumaiTK.DATA.amount + \"\";\n\n    }\n    /**\n     * \n     * @param evt \n     * @param num \n     */\n    public updateMoneyHandler(num:any){\n        if(!Number.isNaN(Number(num))){\n            this._totalnum = num;\n            this.zongjia.string = Number(num)* this.danjia +\"\";\n        }\n    }\n    public choushou() {\n        let data = {\n            \"plantName\": JishiGoumaiTK.DATA.name,\n            \"amount\": this._totalnum,\n            \"flash\":JishiGoumaiTK.DATA.flash\n        }\n        showMsg2(\"出售成功\");\n        this.closeself();\n    }\n    private _totalnum:number = 1;\n\n    public goumai() {\n        showMsg2(\"购买成功\");\n       \n    }\n\n    update(deltaTime: number) {\n        \n    }\n         /**\n     * 关闭自己\n     */\n          public closeself(){\n            uiMgr.removeParent(\"prefabs/jishi/pre_jishiGm\");\n        }\n\n}\n\n"]}