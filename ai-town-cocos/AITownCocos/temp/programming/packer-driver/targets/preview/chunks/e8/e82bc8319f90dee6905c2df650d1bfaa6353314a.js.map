{"version":3,"sources":["file:///Users/feiwang/cutepet/assets/src/module/main/catSpineControl.ts"],"names":["_decorator","Component","Node","randomRangeInt","sp","UITransform","modelMgr","showMsgWithMask","SpineName","BottomTapsComponent","GlobalConfig","AudioManager","ccclass","property","LeftPos","RightPos","CatState","startPosUp","catRoot","pos","x","y","scale","bubble","progress","endPosUp","LeftUpToDown","startPosDown","endPosDown","RightDownToUp","TAG","SpineNameType","catSpineControl","type","Skeleton","shiftTime","currentAddTime","catWalkEndPosition","catState","IDLE","preCatState","hasToy","start","playActionSpine","setSpineCompleteCb","instance","catRootNode","aniName","loop","catSpine","setAnimation","touchCat","mainModel","getserItemCountById","playAniComplete","playSound","STOP","chatBubble","getComponent","mask","width","resetQipao","ACTION","toySpineItemArr","forEach","toy","setCompleteListener","data","node","active","WALK","animation","name","actStr","progressBar","getChildByName","bubbleMask","actIdleTypeStr","idle","action","startWalk","playToySpineAniByID","index","catInRange","Math","abs","position","update","deltaTime","catMoveUpToDown","catMoveDownToUp","equalCatPosition","endPosition","getPosition","getScale","catMoveStep","setNodePosData","end","setPosition","catPos","bubblePos","progressPos","setScale","angle","angleReverse"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, randomRangeInt, Skeleton, sp, UITransform } from 'cc';\nimport { modelMgr, observer } from '../../game/App';\nimport { showMsgWithMask } from '../../core/message/MaskToastManager';\nimport { SpineName } from '../../model/StaticTextConfig';\nimport { EventType } from '../../EventType';\nimport { BottomTapsComponent } from './BottomTapsComponent';\nimport { GlobalConfig } from '../../game/config/GlobalConfig';\nimport { AudioManager } from '../../manager/AudioManager';\nconst { ccclass, property } = _decorator;\n\nexport const LeftPos = -850\nexport const RightPos = 360\n\nexport enum CatState {\n    IDLE = 'IDLE',\n    WALK = 'WALK',\n    STOP = 'STOP'\n}\n\nconst startPosUp = {\n    catRoot: {\n        pos: {x: -34.821,y: -9},\n        scale: {x: 0.7, y: 0.7}\n    },\n    bubble: {\n        pos: {x: 125,y: 7.152857},\n        scale: {x: 1.428571, y: 1.428571}\n    },\n    progress: {\n        pos: {x: 235.135714,y: 153.344286},\n        scale: {x: 1.714286, y: 1.714286}\n    }\n}\n\nconst endPosUp = {\n    catRoot: {\n        pos: {x: -810.667,y: -9},\n        scale: {x: 0.7, y: 0.7}\n    },\n    bubble: {\n        pos: {x: 125,y: 7.152857},\n        scale: {x: 1.428571, y: 1.428571}\n    },\n    progress: {\n        pos: {x: 235.135714,y: 153.344286},\n        scale: {x: 1.714286, y: 1.714286}\n    }\n}\n\nconst LeftUpToDown = {\n    catRoot: {\n        pos: {x: -371.667,y: -191},\n        scale: {x: -0.7, y: 0.7}\n    },\n    bubble: {\n        pos: {x: -416.501,y: 7.152857},\n        scale: {x: -1.428571, y: 1.428571}\n    },\n    progress: {\n        pos: {x: 235.135714,y: 153.344286},\n        scale: {x: -1.714286, y: 1.714286}\n    }\n}\n\nconst startPosDown = {\n    catRoot: {\n        pos: {x: 25.668, y: -191},\n        scale: {x: -0.7, y: 0.7}\n    },\n    bubble: {\n        pos: {x: -416.501,y: 7.152857},\n        scale: {x: -1.428571, y: 1.428571}\n    },\n    progress: {\n        pos: {x: 235.135714,y: 153.344286},\n        scale: {x: -1.714286, y: 1.714286}\n    }\n}\n\nconst endPosDown = {\n    catRoot: {\n        pos: {x: 823.245, y: -191},\n        scale: {x: -0.7, y: 0.7}\n    },\n    bubble: {\n        pos: {x:-416.501,y: 7.152857},\n        scale: {x: -1.428571, y: 1.428571}\n    },\n    progress: {\n        pos: {x: 235.135714,y: 153.344286},\n        scale: {x: -1.714286, y: 1.714286}\n    }\n}\n\nconst RightDownToUp = {\n    catRoot: {\n        pos: {x: 371.667,y: -9},\n        scale: {x: 0.7, y: 0.7}\n    },\n    bubble: {\n        pos: {x: 125,y: 7.152857},\n        scale: {x: 1.428571, y: 1.428571}\n    },\n    progress: {\n        pos: {x: 235.135714,y: 153.344286},\n        scale: {x: 1.714286, y: 1.714286}\n    }\n}\n\n\nconst TAG = 'catSpineControl'\nexport enum SpineNameType  {\n    ACTION = 'action',\n    IDLE = 'idle',\n    WALK = 'walk'\n}\n\n@ccclass(\"catSpineControl\")\nexport class catSpineControl extends Component {\n  @property({ type: [sp.Skeleton] })\n  public toySpineItemArr: sp.Skeleton[] = [];\n  @property(sp.Skeleton)\n  public catSpine: sp.Skeleton = null;\n\n  @property(Node)\n  public chatBubble: Node = null;\n\n  @property(Node)\n  public catRoot: Node = null;\n\n  @property(Node)\n  public bubbleMask: Node = null;\n\n  @property(Node)\n  public progressBar: Node = null;\n\n  @property(Node)\n  public angle: Node = null;\n\n  @property(Node)\n  public angleReverse: Node = null;\n\n  shiftTime = 10;\n  currentAddTime = 0;\n\n  catWalkEndPosition = startPosDown.catRoot\n  catState = CatState.IDLE;\n  preCatState = null;\n  hasToy: boolean;\n  start() {\n    this.playActionSpine(SpineNameType.IDLE, true);\n    this.setSpineCompleteCb();\n    GlobalConfig.instance.catRootNode = this.catRoot\n\n  }\n\n  playActionSpine(aniName: string, loop: boolean) {\n    this.catSpine.setAnimation(0, aniName, loop);\n  }\n\n  touchCat() {\n    if (modelMgr.mainModel.getserItemCountById(10101002) <= 0) {\n      showMsgWithMask(\"Insufficient Ap!\");\n      return;\n    }\n    if (!modelMgr.mainModel.playAniComplete) {\n      return;\n    }\n    AudioManager.instance.playSound(\"new_catAction\");\n    this.preCatState = this.catState\n    this.catState = CatState.STOP\n    this.chatBubble\n      .getComponent(BottomTapsComponent)\n      .mask.getComponent(UITransform).width &&\n      this.chatBubble.getComponent(BottomTapsComponent).resetQipao();\n    modelMgr.mainModel.touchCat();\n    this.playActionSpine(SpineNameType.ACTION, false);\n    modelMgr.mainModel.playAniComplete = false;\n  }\n\n  setSpineCompleteCb() {\n    this.toySpineItemArr.forEach((toy) => {\n      toy.setCompleteListener((data: sp.spine.TrackEntry) => {\n        modelMgr.mainModel.playAniComplete = true;\n        toy.node.active = false;\n\n        if (this.preCatState === CatState.WALK) {\n          this.catState = CatState.WALK;\n          this.catSpine.setAnimation(0, SpineNameType.WALK, true);\n        } else {\n          this.catState = CatState.IDLE;\n          this.catSpine.setAnimation(0, SpineNameType.IDLE, true);\n        }\n        this.hasToy = false\n      });\n    });\n\n    this.catSpine.setCompleteListener((data: sp.spine.TrackEntry) => {\n      //   if(data.animation.name === SpineNameType.ACTION){\n      //       modelMgr.mainModel.playAniComplete = true\n      //       this.catSpine.setAnimation(0, SpineNameType.IDLE, true)\n      //   }\n\n      //   if(data.animation.name === SpineNameType.WALK && this.catState === CatState.WALK){\n      //     this.catSpine.setAnimation(0, SpineNameType.ACTION, false);\n      //     this.catSpine.setAnimation(1, SpineNameType.ACTION, true);\n      //   }\n\n      if (this.catState === CatState.STOP && !this.hasToy) {\n        if (this.preCatState === CatState.WALK) {\n          this.catState = CatState.WALK;\n          this.catSpine.setAnimation(0, SpineNameType.WALK, true);\n        } else {\n          this.catState = CatState.IDLE;\n          this.catSpine.setAnimation(0, SpineNameType.IDLE, true);\n        }\n      }\n\n      if (this.catState === CatState.IDLE) {\n        this.catSpine.setAnimation(0, SpineNameType.IDLE, true);\n      }\n      if (data.animation.name === SpineNameType.WALK) {\n        this.currentAddTime = 0;\n      }\n      modelMgr.mainModel.playAniComplete = true;\n      if (this.currentAddTime >= 10 && this.catState !== CatState.WALK) {\n        const actStr =\n          (this.progressBar.getChildByName(\"progress_button\").active === true || this.bubbleMask.getComponent(UITransform).width)\n            ? CatState.IDLE\n            : randomRangeInt(0, 2)\n            ? CatState.IDLE\n            : CatState.WALK;\n        if (actStr === CatState.IDLE) {\n          const actIdleTypeStr = randomRangeInt(0, 2)\n            ? SpineName.idle\n            : SpineName.action;\n          if (actIdleTypeStr === SpineName.idle) {\n            this.catSpine.setAnimation(0, actIdleTypeStr, true);\n          } else {\n            AudioManager.instance.playSound(\"new_catAction\");\n            this.catSpine.setAnimation(0, actIdleTypeStr, false);\n          }\n          this.preCatState = this.catState;\n          this.catState = CatState.IDLE;\n        } else {\n          this.catSpine.setAnimation(0, SpineNameType.WALK, true);\n          this.preCatState = this.catState;\n          this.catState = CatState.WALK;\n        }\n        this.currentAddTime = 0;\n      }\n    });\n  }\n\n  startWalk() {}\n\n  playToySpineAniByID(index: number) {\n    this.preCatState = this.catState\n    this.catState = CatState.STOP\n    this.hasToy = true\n    modelMgr.mainModel.playAniComplete = false;\n    this.catSpine.setAnimation(0, SpineNameType.IDLE, true);\n    this.toySpineItemArr[index].setAnimation(0, \"action\", false);\n  }\n\n  catInRange(){\n    if(Math.abs(this.catRoot.position.x) > 0 && Math.abs(this.catRoot.position.x) < 450){\n        return true\n    }else{\n        return false\n    }\n  }\n\n  update(deltaTime: number) {\n\n    if(this.progressBar.getChildByName(\"progress_button\").active === true || this.bubbleMask.getComponent(UITransform).width){\n      this.currentAddTime = 0\n    }\n\n    this.currentAddTime += deltaTime;\n\n    if (this.catState === CatState.WALK && this.catWalkEndPosition === startPosDown.catRoot) {\n      this.catMoveUpToDown();\n    }\n    if (this.catState === CatState.WALK && this.catWalkEndPosition === startPosUp.catRoot) {\n        this.catMoveDownToUp();\n    }\n  }\n\n  equalCatPosition(endPosition: {\n    pos: { x: number; y: number };\n    scale: { x: number; y: number };\n  }){\n    if(Math.abs(this.catRoot.getPosition().x) <= Math.abs(endPosition.pos.x) && this.catRoot.getPosition().y === endPosition.pos.y){\n        this.preCatState = this.catState\n        this.catState = CatState.IDLE\n        this.catWalkEndPosition = (this.catWalkEndPosition === startPosDown.catRoot) ? startPosUp.catRoot : startPosDown.catRoot\n        this.catSpine.setAnimation(0, SpineNameType.ACTION, false);\n        AudioManager.instance.playSound(\"new_catAction\");\n        //return true\n    }else{\n        //return false\n    }\n  }\n\n    catMoveDownToUp(){\n    //移动\n    //如果被其他动作打断，打断完继续移动\n    //移动结束播放action\n    if (this.catRoot.getScale().x < 0) {\n        this.catMoveStep(startPosDown.catRoot, endPosDown.catRoot)\n      if (this.catRoot.getPosition().x >= endPosDown.catRoot.pos.x) {\n        this.setNodePosData(\n          RightDownToUp.catRoot,\n          RightDownToUp.bubble,\n          RightDownToUp.progress\n        );\n      }\n    }\n    if (this.catRoot.getScale().x > 0) {\n      this.catMoveStep(RightDownToUp.catRoot, startPosUp.catRoot)\n    }\n    this.equalCatPosition(this.catWalkEndPosition)\n  }\n\n  catMoveUpToDown() {\n    //移动\n    //如果被其他动作打断，打断完继续移动\n    //移动结束播放action\n    if (this.catRoot.getScale().x > 0) {\n        this.catMoveStep(startPosUp.catRoot, endPosUp.catRoot)\n      if (this.catRoot.getPosition().x <= endPosUp.catRoot.pos.x) {\n        this.setNodePosData(\n          LeftUpToDown.catRoot,\n          LeftUpToDown.bubble,\n          LeftUpToDown.progress\n        );\n      }\n    }\n    if (this.catRoot.getScale().x < 0) {\n      this.catMoveStep(LeftUpToDown.catRoot, startPosDown.catRoot)\n    }\n    this.equalCatPosition(this.catWalkEndPosition)\n  }\n\n  catMoveStep(\n    start: {\n      pos: { x: number; y: number };\n      scale: { x: number; y: number };\n    },\n    end: {\n      pos: { x:number; y: number };\n      scale: { x: number; y: number};\n    }\n  ) {\n    this.catRoot.setPosition(\n      this.catRoot.getPosition().x -\n        (start.pos.x - end.pos.x) / 300,\n      this.catRoot.getPosition().y\n    );\n  }\n\n  setNodePosData(\n    catPos: {\n      pos: { x: number; y: number };\n      scale: { x: number; y: number };\n    },\n    bubblePos: {\n      pos: { x: number; y: number };\n      scale: { x: number; y: number };\n    },\n    progressPos: {\n      pos: { x: number; y: number };\n      scale: { x: number; y: number };\n    }\n  ) {\n    this.catRoot.setScale(catPos.scale.x, catPos.scale.y);\n    this.catRoot.setPosition(catPos.pos.x, catPos.pos.y);\n\n    this.bubbleMask.setScale(bubblePos.scale.x, bubblePos.scale.y);\n    this.bubbleMask.setPosition(bubblePos.pos.x, bubblePos.pos.y);\n\n    this.progressBar.setScale(progressPos.scale.x, progressPos.scale.y);\n    this.progressBar.setPosition(progressPos.pos.x, progressPos.pos.y);\n    if(catPos.scale.x > 0){\n        this.angle.active = true\n        this.angleReverse.active = false\n    }else{\n        this.angle.active = false\n        this.angleReverse.active = true\n    }\n  }\n}\n\n"]}