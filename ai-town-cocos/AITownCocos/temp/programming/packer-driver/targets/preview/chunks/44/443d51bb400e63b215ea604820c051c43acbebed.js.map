{"version":3,"sources":["file:///Users/feiwang/workSpace/AITown/cutepet/assets/src/manager/TrackManager.ts"],"names":["TrackManager","modelMgr","AxiosManager","BaseUrl","navigator","window","isAndroid","test","userAgent","isIos","isApp","BCAPPID","device","brand","channel","deviceId","deviceType","appVer","os","osVer","model","clientIp","track_base_info","UrlSource","getdeviceType","num","init","trackParams","getParameter","platform","playerId","mainModel","userinfo","uid","playerName","app","e","console","warn","track","eventId","clickName","clickType","sourceChannel","subChannel","params","data","eventValue","instance","post","catch","err","log","clickTrack","encode","str","btoa","encodeURIComponent","replace","toSolidBytes","match","p1","String","fromCharCode","Number","param","re","RegExp","a","exec","document","location","search","trackMgr"],"mappings":"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","sourcesContent":["import { modelMgr } from \"../game/App\";\nimport { GlobalConfig } from \"../game/config/GlobalConfig\";\nimport AxiosManager from \"./AxiosManager\";\n\nexport default class TrackManager {\n    /**\n     * 1.接入文档文档请参见，https://docs.popo.netease.com/ofedit/096b65ea9fd44cc4a46c23b5a311f3a7； \n        2.相关参数：\n        token所需app：garden\n        测试服game_key：54utzeoo  查询game_name：GARDEN_TEST\n        正式服game_key：oer34yks  查询game_name：GARDEN \n     * \n     * \n     */\n\n    private BaseUrl = true ? 'https://wtgame-api-live.baochuangame.com:10443/' : 'https://apitest2.baochuangames.com/';\n    private navigator = window.navigator;\n    private isAndroid = /(Android)/i.test(navigator.userAgent);\n    private isIos = /(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent);\n    private isApp = /(NeteaseMusic)/i.test(navigator.userAgent);\n    private BCAPPID: string = \"CloudFlower\";\n    private device = {\n        brand: 'gamesdk',\n        channel: 'gamesdk',\n        deviceId: 0,\n        deviceType: -1,//-2:机器人 -1:未知 0:iOS 1:安卓 2:PC\n        appVer: 0,\n        os: 0,\n        osVer: 0,\n        model: 0,\n        clientIp: 0,\n    };\n    private track_base_info: any = {\n    };\n\n    private getdeviceType() {\n        let num: number = -1;\n        if (this.isIos) {\n            num = 0;\n        } else if (this.isAndroid) {\n            num = 1;\n        }\n        return num;\n    }\n    /**\n     * 登录成功,并获取userinfo后 init\n     */\n    public init(trackParams = {}) {\n        if (AxiosManager.BaseUrl == \"https://flower.qa.web.netease.com\") {\n            this.BaseUrl = 'https://apitest2.baochuangames.com/';\n        } else {\n            this.BaseUrl = 'https://wtgame-api-live.baochuangame.com:10443/';\n        } \n\n        this.device.deviceType = this.getdeviceType();\n        this.UrlSource = this.getParameter('source') || this.getParameter('source_channel');\n        this.track_base_info = {\n            platform: this.device.deviceType,\n            playerId: modelMgr.mainModel.userinfo.uid,\n            playerName: \"\",\n            app: this.BCAPPID,\n        };\n\n\n        try {\n            \n        } catch (e) {\n            console.warn('log exception:', e);\n        }\n        this.track({ //example ...\n            eventId: 100024, // 事件点击\n            clickName: '页面曝光',\n            clickType: '主页',\n            sourceChannel: this.UrlSource,\n            subChannel: 0,\n        });\n    }\n    track(params) {\n        const data = {\n            ...this.track_base_info,\n            eventValue: {\n                ...params,\n                playerId: this.track_base_info.playerId,\n                playerName: this.track_base_info.playerName,\n            },\n        };\n        try {\n            AxiosManager.instance.post(this.BaseUrl + 'oauth2/anchor/bi/report', data).catch((err) => {\n                console.log(\"track err::\", err);\n            });\n        } catch (err) {\n            console.log(err);\n        }\n    };\n    clickTrack(clickName, clickType, sourceChannel) {\n        const params = {\n            eventId: 100024,\n            clickName,\n            clickType,\n            sourceChannel: this.UrlSource,\n            subChannel: 0,\n        };\n        return this.track(params);\n    }\n    public UrlSource = \"\";\n    private encode(str) {\n        // first we use encodeURIComponent to get percent-encoded UTF-8,\n        // then we convert the percent encodings into raw bytes which\n        // can be fed into btoa.\n        return btoa(\n            encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, function toSolidBytes(match, p1) {\n                return String.fromCharCode(Number('0x' + p1));\n            })\n        );\n    }\n    private getParameter(param) {\n        let re = new RegExp(param + '=([^&]*)', 'i');\n        let a = re.exec(document.location.search);\n        if (a == null) return null;\n        return a[1];\n    }\n\n}\nexport const trackMgr: TrackManager = new TrackManager();"]}