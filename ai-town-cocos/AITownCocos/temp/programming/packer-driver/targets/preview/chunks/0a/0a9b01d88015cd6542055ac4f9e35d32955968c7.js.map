{"version":3,"sources":["file:///Users/feiwang/workSpace/AITown/cutepet/assets/src/game/scene/Camera2D.ts"],"names":["Camera2D","Rect","Vec2","mGameConfig","cameraView","_cameraView","focusTarget","_focusTarget","constructor","scene","_worldMap","_ease","_pos","DeviceW","DeviceH","focus","target","x","position","y","update","gridW","gridH","vec","parent","getPosition","setPosition"],"mappings":"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","sourcesContent":["import { Node, Rect, Sprite, Vec2, Vec3 } from \"cc\";\nimport mGameConfig from \"../../utils/MGameConfig\";\n\nexport default class Camera2D\n{\n\t\n\tprivate _cameraView:Rect;\n\tpublic get cameraView():Rect\n\t{\n\t\treturn this._cameraView;\n\t}\n\t\n\tprivate _worldMap:Node;\n\t\n\tprivate _ease:number = 0.0025;\n\t\n\tprivate _focusTarget: Node = null;\n\tpublic get focusTarget(): Node {\n\t\treturn this._focusTarget;\n\t}\n\t\n\tpublic constructor(scene:Node)\n\t{\n\t\tthis._cameraView = new Rect(0, 0, mGameConfig.DeviceW, mGameConfig.DeviceH);\n\t\tthis._worldMap = scene;\n\t\t// this._worldMap.scrollRect = this._cameraView;\n\t\t//_worldMap.viewport = _cameraView;\n\t\t//_worldMap.optimizeScrollRect = true;\n\t}\n\t\n// \tpublic lookAt():void\n// \t{\n\t\t\n// \t}\n\t\n// \tpublic onResize():void\n// \t{\n// \t\tif(this._cameraView)\n// \t\t{\n// \t\t\tthis._cameraView.width = mGameConfig.DesginW;\n// \t\t\tthis._cameraView.height = mGameConfig.DesginH;\n// \t\t}\n// \t}\n\t\n\t/**\n\t * 镜头跟随\n\t */ \n\tpublic focus(target:Node):void\n\t{\n\t\tthis._focusTarget = target;//target 这里的target隐藏的target,用来计算和存储移动到坐标;\n\t\tthis._cameraView.x = (this._focusTarget.position.x-(mGameConfig.DeviceW>>1));\n\t\tthis._cameraView.y = (this._focusTarget.position.y+(mGameConfig.DeviceH>>1));\n\t\t\n\t}\n\t\n\tprivate _pos:Vec2 = new Vec2();\n\tpublic update():void\n\t{\n\t\tif(this._focusTarget&&this._focusTarget.position)//计算加载tile区域的左上角point\n\t\t{\n\t\t\tthis._pos.x = (this._focusTarget.position.x-(mGameConfig.DeviceW>>1));\n\t\t\tthis._pos.y = (this._focusTarget.position.y+(mGameConfig.DeviceH>>1));\n            let gridW = 7500;\n            let gridH = 8400;\n\t\t\tif(this._pos.x + mGameConfig.DeviceW <= gridW && this._pos.x >= 0)//图片加载更新间隔可以长一些\n\t\t\t{\n\t\t\t\t// this._cameraView.x = this._pos.x;//一步到位;\n\t\t\t\tthis._cameraView.x += (this._pos.x - this._cameraView.x) * 33 * this._ease;\n\t\t\t}\n\t\t\tif((this._pos.y - mGameConfig.DeviceH)*-1 <= gridH && this._pos.y <= 0)\n\t\t\t{\n\t\t\t\t// this._cameraView.y = this._pos.y;\n\t\t\t\tthis._cameraView.y += (this._pos.y - this._cameraView.y) * 33 * this._ease;\n            }\n\t\t\t//设置图层位置\n      \t\tlet x = -this._focusTarget.position.x + mGameConfig.DeviceW/2;\n      \t\tlet y = -this._focusTarget.position.y -mGameConfig.DeviceH/2;\n\t\t\tlet vec :Vec3= this._focusTarget.parent.getPosition();\n\t\t\tvec.x += (x - vec.x)*33*this._ease;\n\t\t\tvec.y += (y - vec.y)*33*this._ease;\n\t\t\tthis._focusTarget.parent.setPosition(vec);\n\t\t}\n\t}\n\t\n}"]}