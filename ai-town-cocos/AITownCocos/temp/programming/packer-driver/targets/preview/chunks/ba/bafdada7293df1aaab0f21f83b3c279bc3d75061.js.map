{"version":3,"sources":["file:///Users/feiwang/cutepet/node_modules/aws-sdk/lib/discover_endpoint.js"],"names":["_cjsLoader","_req","__cjsMetaURL","_req0","url","define","exports","require","module","__filename","__dirname","AWS","util","endpointDiscoveryEnabledEnvs","getCacheKey","request","service","api","operations","identifiers","config","region","serviceId","credentials","accessKeyId","marshallCustomIdentifiersHelper","result","params","shape","undefined","type","required","length","arrayEach","name","memberShape","members","endpointDiscoveryId","locationName","isLocationName","String","marshallCustomIdentifiers","optionalDiscoverEndpoint","operationModel","operation","inputShape","input","cacheKey","Object","keys","update","endpoints","endpointCache","get","Address","httpRequest","updateEndpoint","endpointRequest","makeRequest","endpointOperation","Operation","Identifiers","addApiVersionHeader","removeListener","EventListeners","Core","VALIDATE_PARAMETERS","RETRY_CHECK","put","CachePeriodInMinutes","send","err","data","Endpoints","requestQueue","requiredDiscoverEndpoint","done","cacheKeyStr","EndpointCache","getKeyString","push","callback","response","error","retryable","remove","pendingRequests","requestContext","apiVersion","headers","invalidateCachedEndpoints","httpResponse","code","statusCode","hasCustomEndpoint","client","_originalConfig","endpoint","endpointDiscoveryEnabled","Error","message","svcConfig","serviceIdentifier","Boolean","isFalsy","value","indexOf","resolveEndpointDiscoveryConfig","isBrowser","i","env","prototype","hasOwnProperty","call","process","configFile","iniLoader","loadFrom","isConfig","filename","sharedConfigFileEnv","e","sharedFileConfig","AWS_PROFILE","defaultProfile","endpoint_discovery_enabled","discoverEndpoint","isPresigned","isEndpointDiscoveryRequired","endpointDiscoveryRequired","isEnabled","hasRequiredEndpointDiscovery","appendToUserAgent","addNamedListener","className","invalidateCachedEndpoint","_cjsExports","_discoverEndpoint","_requiredDiscoverEndpoint","_optionalDiscoverEndpoint","_marshallCustomIdentifiers","_getCacheKey","_invalidateCachedEndpoint"],"mappings":";;;;;;;;;AAAOA,MAAAA,U;;AACkBC,MAAAA,I,iBAAhBC,Y;;AACgBC,MAAAA,K,iBAAhBD,Y;;;8BAQHA,Y,GAAe,cAAYE,G;;AACjCJ,MAAAA,UAAU,CAACK,MAAX,CAAkBH,YAAlB,EAAgC,UAAUI,OAAV,EAAmBC,OAAnB,EAA4BC,MAA5B,EAAoCC,UAApC,EAAgDC,SAAhD,EAA2D;AAC3F;AAGC,YAAIC,GAAG,GAAGJ,OAAO,CAAC,QAAD,CAAjB;;AACA,YAAIK,IAAI,GAAGL,OAAO,CAAC,QAAD,CAAlB;;AACA,YAAIM,4BAA4B,GAAG,CAAC,+BAAD,EAAkC,gCAAlC,CAAnC;AAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACC,iBAASC,WAAT,CAAqBC,OAArB,EAA8B;AAC5B,cAAIC,OAAO,GAAGD,OAAO,CAACC,OAAtB;AACA,cAAIC,GAAG,GAAGD,OAAO,CAACC,GAAR,IAAe,EAAzB;AACA,cAAIC,UAAU,GAAGD,GAAG,CAACC,UAArB;AACA,cAAIC,WAAW,GAAG,EAAlB;;AACA,cAAIH,OAAO,CAACI,MAAR,CAAeC,MAAnB,EAA2B;AACzBF,YAAAA,WAAW,CAACE,MAAZ,GAAqBL,OAAO,CAACI,MAAR,CAAeC,MAApC;AACD;;AACD,cAAIJ,GAAG,CAACK,SAAR,EAAmB;AACjBH,YAAAA,WAAW,CAACG,SAAZ,GAAwBL,GAAG,CAACK,SAA5B;AACD;;AACD,cAAIN,OAAO,CAACI,MAAR,CAAeG,WAAf,CAA2BC,WAA/B,EAA4C;AAC1CL,YAAAA,WAAW,CAACK,WAAZ,GAA0BR,OAAO,CAACI,MAAR,CAAeG,WAAf,CAA2BC,WAArD;AACD;;AACD,iBAAOL,WAAP;AACD;AAED;AACD;AACA;AACA;AACA;;;AACC,iBAASM,+BAAT,CAAyCC,MAAzC,EAAiDC,MAAjD,EAAyDC,KAAzD,EAAgE;AAC9D,cAAI,CAACA,KAAD,IAAUD,MAAM,KAAKE,SAArB,IAAkCF,MAAM,KAAK,IAAjD,EAAuD;;AACvD,cAAIC,KAAK,CAACE,IAAN,KAAe,WAAf,IAA8BF,KAAK,CAACG,QAApC,IAAgDH,KAAK,CAACG,QAAN,CAAeC,MAAf,GAAwB,CAA5E,EAA+E;AAC7EpB,YAAAA,IAAI,CAACqB,SAAL,CAAeL,KAAK,CAACG,QAArB,EAA+B,UAASG,IAAT,EAAe;AAC5C,kBAAIC,WAAW,GAAGP,KAAK,CAACQ,OAAN,CAAcF,IAAd,CAAlB;;AACA,kBAAIC,WAAW,CAACE,mBAAZ,KAAoC,IAAxC,EAA8C;AAC5C,oBAAIC,YAAY,GAAGH,WAAW,CAACI,cAAZ,GAA6BJ,WAAW,CAACD,IAAzC,GAAgDA,IAAnE;AACAR,gBAAAA,MAAM,CAACY,YAAD,CAAN,GAAuBE,MAAM,CAACb,MAAM,CAACO,IAAD,CAAP,CAA7B;AACD,eAHD,MAGO;AACLT,gBAAAA,+BAA+B,CAACC,MAAD,EAASC,MAAM,CAACO,IAAD,CAAf,EAAuBC,WAAvB,CAA/B;AACD;AACF,aARD;AASD;AACF;AAED;AACD;AACA;AACA;AACA;AACA;AACA;;;AACC,iBAASM,yBAAT,CAAmC1B,OAAnC,EAA4Ca,KAA5C,EAAmD;AACjD,cAAIT,WAAW,GAAG,EAAlB;AACAM,UAAAA,+BAA+B,CAACN,WAAD,EAAcJ,OAAO,CAACY,MAAtB,EAA8BC,KAA9B,CAA/B;AACA,iBAAOT,WAAP;AACD;AAED;AACD;AACA;AACA;AACA;AACA;AACA;AACA;;;AACC,iBAASuB,wBAAT,CAAkC3B,OAAlC,EAA2C;AACzC,cAAIC,OAAO,GAAGD,OAAO,CAACC,OAAtB;AACA,cAAIC,GAAG,GAAGD,OAAO,CAACC,GAAlB;AACA,cAAI0B,cAAc,GAAG1B,GAAG,CAACC,UAAJ,GAAiBD,GAAG,CAACC,UAAJ,CAAeH,OAAO,CAAC6B,SAAvB,CAAjB,GAAqDf,SAA1E;AACA,cAAIgB,UAAU,GAAGF,cAAc,GAAGA,cAAc,CAACG,KAAlB,GAA0BjB,SAAzD;AAEA,cAAIV,WAAW,GAAGsB,yBAAyB,CAAC1B,OAAD,EAAU8B,UAAV,CAA3C;AACA,cAAIE,QAAQ,GAAGjC,WAAW,CAACC,OAAD,CAA1B;;AACA,cAAIiC,MAAM,CAACC,IAAP,CAAY9B,WAAZ,EAAyBa,MAAzB,GAAkC,CAAtC,EAAyC;AACvCe,YAAAA,QAAQ,GAAGnC,IAAI,CAACsC,MAAL,CAAYH,QAAZ,EAAsB5B,WAAtB,CAAX;AACA,gBAAIwB,cAAJ,EAAoBI,QAAQ,CAACH,SAAT,GAAqBD,cAAc,CAACT,IAApC;AACrB;;AACD,cAAIiB,SAAS,GAAGxC,GAAG,CAACyC,aAAJ,CAAkBC,GAAlB,CAAsBN,QAAtB,CAAhB;;AACA,cAAII,SAAS,IAAIA,SAAS,CAACnB,MAAV,KAAqB,CAAlC,IAAuCmB,SAAS,CAAC,CAAD,CAAT,CAAaG,OAAb,KAAyB,EAApE,EAAwE;AACtE;AACA;AACA;AACD,WAJD,MAIO,IAAIH,SAAS,IAAIA,SAAS,CAACnB,MAAV,GAAmB,CAApC,EAAuC;AAC5C;AACAjB,YAAAA,OAAO,CAACwC,WAAR,CAAoBC,cAApB,CAAmCL,SAAS,CAAC,CAAD,CAAT,CAAaG,OAAhD;AACD,WAHM,MAGA;AACL;AACA,gBAAIG,eAAe,GAAGzC,OAAO,CAAC0C,WAAR,CAAoBzC,GAAG,CAAC0C,iBAAxB,EAA2C;AAC/DC,cAAAA,SAAS,EAAEjB,cAAc,CAACT,IADqC;AAE/D2B,cAAAA,WAAW,EAAE1C;AAFkD,aAA3C,CAAtB;AAIA2C,YAAAA,mBAAmB,CAACL,eAAD,CAAnB;AACAA,YAAAA,eAAe,CAACM,cAAhB,CAA+B,UAA/B,EAA2CpD,GAAG,CAACqD,cAAJ,CAAmBC,IAAnB,CAAwBC,mBAAnE;AACAT,YAAAA,eAAe,CAACM,cAAhB,CAA+B,OAA/B,EAAwCpD,GAAG,CAACqD,cAAJ,CAAmBC,IAAnB,CAAwBE,WAAhE,EARK,CASL;AACA;;AACAxD,YAAAA,GAAG,CAACyC,aAAJ,CAAkBgB,GAAlB,CAAsBrB,QAAtB,EAAgC,CAAC;AAC/BO,cAAAA,OAAO,EAAE,EADsB;AAE/Be,cAAAA,oBAAoB,EAAE;AAFS,aAAD,CAAhC;AAIAZ,YAAAA,eAAe,CAACa,IAAhB,CAAqB,UAASC,GAAT,EAAcC,IAAd,EAAoB;AACvC,kBAAIA,IAAI,IAAIA,IAAI,CAACC,SAAjB,EAA4B;AAC1B9D,gBAAAA,GAAG,CAACyC,aAAJ,CAAkBgB,GAAlB,CAAsBrB,QAAtB,EAAgCyB,IAAI,CAACC,SAArC;AACD,eAFD,MAEO,IAAIF,GAAJ,EAAS;AACd5D,gBAAAA,GAAG,CAACyC,aAAJ,CAAkBgB,GAAlB,CAAsBrB,QAAtB,EAAgC,CAAC;AAC/BO,kBAAAA,OAAO,EAAE,EADsB;AAE/Be,kBAAAA,oBAAoB,EAAE,CAFS,CAEP;;AAFO,iBAAD,CAAhC;AAID;AACF,aATD;AAUD;AACF;;AAED,YAAIK,YAAY,GAAG,EAAnB;AAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACC,iBAASC,wBAAT,CAAkC5D,OAAlC,EAA2C6D,IAA3C,EAAiD;AAC/C,cAAI5D,OAAO,GAAGD,OAAO,CAACC,OAAtB;AACA,cAAIC,GAAG,GAAGD,OAAO,CAACC,GAAlB;AACA,cAAI0B,cAAc,GAAG1B,GAAG,CAACC,UAAJ,GAAiBD,GAAG,CAACC,UAAJ,CAAeH,OAAO,CAAC6B,SAAvB,CAAjB,GAAqDf,SAA1E;AACA,cAAIgB,UAAU,GAAGF,cAAc,GAAGA,cAAc,CAACG,KAAlB,GAA0BjB,SAAzD;AAEA,cAAIV,WAAW,GAAGsB,yBAAyB,CAAC1B,OAAD,EAAU8B,UAAV,CAA3C;AACA,cAAIE,QAAQ,GAAGjC,WAAW,CAACC,OAAD,CAA1B;;AACA,cAAIiC,MAAM,CAACC,IAAP,CAAY9B,WAAZ,EAAyBa,MAAzB,GAAkC,CAAtC,EAAyC;AACvCe,YAAAA,QAAQ,GAAGnC,IAAI,CAACsC,MAAL,CAAYH,QAAZ,EAAsB5B,WAAtB,CAAX;AACA,gBAAIwB,cAAJ,EAAoBI,QAAQ,CAACH,SAAT,GAAqBD,cAAc,CAACT,IAApC;AACrB;;AACD,cAAI2C,WAAW,GAAGlE,GAAG,CAACmE,aAAJ,CAAkBC,YAAlB,CAA+BhC,QAA/B,CAAlB;AACA,cAAII,SAAS,GAAGxC,GAAG,CAACyC,aAAJ,CAAkBC,GAAlB,CAAsBwB,WAAtB,CAAhB,CAb+C,CAaK;;AACpD,cAAI1B,SAAS,IAAIA,SAAS,CAACnB,MAAV,KAAqB,CAAlC,IAAuCmB,SAAS,CAAC,CAAD,CAAT,CAAaG,OAAb,KAAyB,EAApE,EAAwE;AACtE;AACA;AACA,gBAAI,CAACoB,YAAY,CAACG,WAAD,CAAjB,EAAgCH,YAAY,CAACG,WAAD,CAAZ,GAA4B,EAA5B;AAChCH,YAAAA,YAAY,CAACG,WAAD,CAAZ,CAA0BG,IAA1B,CAA+B;AAACjE,cAAAA,OAAO,EAAEA,OAAV;AAAmBkE,cAAAA,QAAQ,EAAEL;AAA7B,aAA/B;AACA;AACD,WAND,MAMO,IAAIzB,SAAS,IAAIA,SAAS,CAACnB,MAAV,GAAmB,CAApC,EAAuC;AAC5CjB,YAAAA,OAAO,CAACwC,WAAR,CAAoBC,cAApB,CAAmCL,SAAS,CAAC,CAAD,CAAT,CAAaG,OAAhD;AACAsB,YAAAA,IAAI;AACL,WAHM,MAGA;AACL,gBAAInB,eAAe,GAAGzC,OAAO,CAAC0C,WAAR,CAAoBzC,GAAG,CAAC0C,iBAAxB,EAA2C;AAC/DC,cAAAA,SAAS,EAAEjB,cAAc,CAACT,IADqC;AAE/D2B,cAAAA,WAAW,EAAE1C;AAFkD,aAA3C,CAAtB;AAIAsC,YAAAA,eAAe,CAACM,cAAhB,CAA+B,UAA/B,EAA2CpD,GAAG,CAACqD,cAAJ,CAAmBC,IAAnB,CAAwBC,mBAAnE;AACAJ,YAAAA,mBAAmB,CAACL,eAAD,CAAnB,CANK,CAQL;AACA;;AACA9C,YAAAA,GAAG,CAACyC,aAAJ,CAAkBgB,GAAlB,CAAsBS,WAAtB,EAAmC,CAAC;AAClCvB,cAAAA,OAAO,EAAE,EADyB;AAElCe,cAAAA,oBAAoB,EAAE,EAFY,CAET;;AAFS,aAAD,CAAnC;AAIAZ,YAAAA,eAAe,CAACa,IAAhB,CAAqB,UAASC,GAAT,EAAcC,IAAd,EAAoB;AACvC,kBAAID,GAAJ,EAAS;AACPxD,gBAAAA,OAAO,CAACmE,QAAR,CAAiBC,KAAjB,GAAyBvE,IAAI,CAACuE,KAAL,CAAWZ,GAAX,EAAgB;AAAEa,kBAAAA,SAAS,EAAE;AAAb,iBAAhB,CAAzB;AACAzE,gBAAAA,GAAG,CAACyC,aAAJ,CAAkBiC,MAAlB,CAAyBtC,QAAzB,EAFO,CAIP;;AACA,oBAAI2B,YAAY,CAACG,WAAD,CAAhB,EAA+B;AAC7B,sBAAIS,eAAe,GAAGZ,YAAY,CAACG,WAAD,CAAlC;AACAjE,kBAAAA,IAAI,CAACqB,SAAL,CAAeqD,eAAf,EAAgC,UAASC,cAAT,EAAyB;AACvDA,oBAAAA,cAAc,CAACxE,OAAf,CAAuBmE,QAAvB,CAAgCC,KAAhC,GAAwCvE,IAAI,CAACuE,KAAL,CAAWZ,GAAX,EAAgB;AAAEa,sBAAAA,SAAS,EAAE;AAAb,qBAAhB,CAAxC;AACAG,oBAAAA,cAAc,CAACN,QAAf;AACD,mBAHD;AAIA,yBAAOP,YAAY,CAACG,WAAD,CAAnB;AACD;AACF,eAbD,MAaO,IAAIL,IAAJ,EAAU;AACf7D,gBAAAA,GAAG,CAACyC,aAAJ,CAAkBgB,GAAlB,CAAsBS,WAAtB,EAAmCL,IAAI,CAACC,SAAxC;AACA1D,gBAAAA,OAAO,CAACwC,WAAR,CAAoBC,cAApB,CAAmCgB,IAAI,CAACC,SAAL,CAAe,CAAf,EAAkBnB,OAArD,EAFe,CAIf;;AACA,oBAAIoB,YAAY,CAACG,WAAD,CAAhB,EAA+B;AAC7B,sBAAIS,eAAe,GAAGZ,YAAY,CAACG,WAAD,CAAlC;AACAjE,kBAAAA,IAAI,CAACqB,SAAL,CAAeqD,eAAf,EAAgC,UAASC,cAAT,EAAyB;AACvDA,oBAAAA,cAAc,CAACxE,OAAf,CAAuBwC,WAAvB,CAAmCC,cAAnC,CAAkDgB,IAAI,CAACC,SAAL,CAAe,CAAf,EAAkBnB,OAApE;AACAiC,oBAAAA,cAAc,CAACN,QAAf;AACD,mBAHD;AAIA,yBAAOP,YAAY,CAACG,WAAD,CAAnB;AACD;AACF;;AACDD,cAAAA,IAAI;AACL,aA7BD;AA8BD;AACF;AAED;AACD;AACA;AACA;;;AACC,iBAASd,mBAAT,CAA6BL,eAA7B,EAA8C;AAC5C,cAAIxC,GAAG,GAAGwC,eAAe,CAACzC,OAAhB,CAAwBC,GAAlC;AACA,cAAIuE,UAAU,GAAGvE,GAAG,CAACuE,UAArB;;AACA,cAAIA,UAAU,IAAI,CAAC/B,eAAe,CAACF,WAAhB,CAA4BkC,OAA5B,CAAoC,mBAApC,CAAnB,EAA6E;AAC3EhC,YAAAA,eAAe,CAACF,WAAhB,CAA4BkC,OAA5B,CAAoC,mBAApC,IAA2DD,UAA3D;AACD;AACF;AAED;AACD;AACA;AACA;AACA;;;AACC,iBAASE,yBAAT,CAAmCR,QAAnC,EAA6C;AAC3C,cAAIC,KAAK,GAAGD,QAAQ,CAACC,KAArB;AACA,cAAIQ,YAAY,GAAGT,QAAQ,CAACS,YAA5B;;AACA,cAAIR,KAAK,KACNA,KAAK,CAACS,IAAN,KAAe,0BAAf,IAA6CD,YAAY,CAACE,UAAb,KAA4B,GADnE,CAAT,EAEE;AACA,gBAAI9E,OAAO,GAAGmE,QAAQ,CAACnE,OAAvB;AACA,gBAAIG,UAAU,GAAGH,OAAO,CAACC,OAAR,CAAgBC,GAAhB,CAAoBC,UAApB,IAAkC,EAAnD;AACA,gBAAI2B,UAAU,GAAG3B,UAAU,CAACH,OAAO,CAAC6B,SAAT,CAAV,GAAgC1B,UAAU,CAACH,OAAO,CAAC6B,SAAT,CAAV,CAA8BE,KAA9D,GAAsEjB,SAAvF;AACA,gBAAIV,WAAW,GAAGsB,yBAAyB,CAAC1B,OAAD,EAAU8B,UAAV,CAA3C;AACA,gBAAIE,QAAQ,GAAGjC,WAAW,CAACC,OAAD,CAA1B;;AACA,gBAAIiC,MAAM,CAACC,IAAP,CAAY9B,WAAZ,EAAyBa,MAAzB,GAAkC,CAAtC,EAAyC;AACvCe,cAAAA,QAAQ,GAAGnC,IAAI,CAACsC,MAAL,CAAYH,QAAZ,EAAsB5B,WAAtB,CAAX;AACA,kBAAID,UAAU,CAACH,OAAO,CAAC6B,SAAT,CAAd,EAAmCG,QAAQ,CAACH,SAAT,GAAqB1B,UAAU,CAACH,OAAO,CAAC6B,SAAT,CAAV,CAA8BV,IAAnD;AACpC;;AACDvB,YAAAA,GAAG,CAACyC,aAAJ,CAAkBiC,MAAlB,CAAyBtC,QAAzB;AACD;AACF;AAED;AACD;AACA;AACA;AACA;;;AACC,iBAAS+C,iBAAT,CAA2BC,MAA3B,EAAmC;AACjC;AACA,cAAIA,MAAM,CAACC,eAAP,IAA0BD,MAAM,CAACC,eAAP,CAAuBC,QAAjD,IAA6DF,MAAM,CAACC,eAAP,CAAuBE,wBAAvB,KAAoD,IAArH,EAA2H;AACzH,kBAAMtF,IAAI,CAACuE,KAAL,CAAW,IAAIgB,KAAJ,EAAX,EAAwB;AAC5BP,cAAAA,IAAI,EAAE,wBADsB;AAE5BQ,cAAAA,OAAO,EAAE;AAFmB,aAAxB,CAAN;AAID;;AAAA;AACD,cAAIC,SAAS,GAAG1F,GAAG,CAACS,MAAJ,CAAW2E,MAAM,CAACO,iBAAlB,KAAwC,EAAxD;AACA,iBAAOC,OAAO,CAAC5F,GAAG,CAACS,MAAJ,CAAW6E,QAAX,IAAuBI,SAAS,CAACJ,QAAjC,IAA8CF,MAAM,CAACC,eAAP,IAA0BD,MAAM,CAACC,eAAP,CAAuBC,QAAhG,CAAd;AACD;AAED;AACD;AACA;;;AACC,iBAASO,OAAT,CAAiBC,KAAjB,EAAwB;AACtB,iBAAO,CAAC,OAAD,EAAU,GAAV,EAAeC,OAAf,CAAuBD,KAAvB,KAAiC,CAAxC;AACD;AAED;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACC,iBAASE,8BAAT,CAAwC5F,OAAxC,EAAiD;AAC/C,cAAIC,OAAO,GAAGD,OAAO,CAACC,OAAR,IAAmB,EAAjC;;AACA,cAAIA,OAAO,CAACI,MAAR,CAAe8E,wBAAf,KAA4CrE,SAAhD,EAA2D;AACzD,mBAAOb,OAAO,CAACI,MAAR,CAAe8E,wBAAtB;AACD,WAJ8C,CAM/C;AACA;;;AACA,cAAItF,IAAI,CAACgG,SAAL,EAAJ,EAAsB,OAAO/E,SAAP,CARyB,CAU/C;;AACA,eAAK,IAAIgF,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGhG,4BAA4B,CAACmB,MAAjD,EAAyD6E,CAAC,EAA1D,EAA8D;AAC5D,gBAAIC,GAAG,GAAGjG,4BAA4B,CAACgG,CAAD,CAAtC;;AACA,gBAAI7D,MAAM,CAAC+D,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCC,OAAO,CAACJ,GAA7C,EAAkDA,GAAlD,CAAJ,EAA4D;AAC1D,kBAAII,OAAO,CAACJ,GAAR,CAAYA,GAAZ,MAAqB,EAArB,IAA2BI,OAAO,CAACJ,GAAR,CAAYA,GAAZ,MAAqBjF,SAApD,EAA+D;AAC7D,sBAAMjB,IAAI,CAACuE,KAAL,CAAW,IAAIgB,KAAJ,EAAX,EAAwB;AAC5BP,kBAAAA,IAAI,EAAE,wBADsB;AAE5BQ,kBAAAA,OAAO,EAAE,4BAA4BU,GAA5B,GAAkC;AAFf,iBAAxB,CAAN;AAID;;AACD,qBAAO,CAACN,OAAO,CAACU,OAAO,CAACJ,GAAR,CAAYA,GAAZ,CAAD,CAAf;AACD;AACF;;AAED,cAAIK,UAAU,GAAG,EAAjB;;AACA,cAAI;AACFA,YAAAA,UAAU,GAAGxG,GAAG,CAACC,IAAJ,CAASwG,SAAT,GAAqBzG,GAAG,CAACC,IAAJ,CAASwG,SAAT,CAAmBC,QAAnB,CAA4B;AAC5DC,cAAAA,QAAQ,EAAE,IADkD;AAE5DC,cAAAA,QAAQ,EAAEL,OAAO,CAACJ,GAAR,CAAYnG,GAAG,CAACC,IAAJ,CAAS4G,mBAArB;AAFkD,aAA5B,CAArB,GAGR,EAHL;AAID,WALD,CAKE,OAAOC,CAAP,EAAU,CAAE;;AACd,cAAIC,gBAAgB,GAAGP,UAAU,CAC/BD,OAAO,CAACJ,GAAR,CAAYa,WAAZ,IAA2BhH,GAAG,CAACC,IAAJ,CAASgH,cADL,CAAV,IAElB,EAFL;;AAGA,cAAI5E,MAAM,CAAC+D,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCS,gBAArC,EAAuD,4BAAvD,CAAJ,EAA0F;AACxF,gBAAIA,gBAAgB,CAACG,0BAAjB,KAAgDhG,SAApD,EAA+D;AAC7D,oBAAMjB,IAAI,CAACuE,KAAL,CAAW,IAAIgB,KAAJ,EAAX,EAAwB;AAC5BP,gBAAAA,IAAI,EAAE,wBADsB;AAE5BQ,gBAAAA,OAAO,EAAE;AAFmB,eAAxB,CAAN;AAID;;AACD,mBAAO,CAACI,OAAO,CAACkB,gBAAgB,CAACG,0BAAlB,CAAf;AACD;;AACD,iBAAOhG,SAAP;AACD;AAED;AACD;AACA;AACA;AACA;;;AACC,iBAASiG,gBAAT,CAA0B/G,OAA1B,EAAmC6D,IAAnC,EAAyC;AACvC,cAAI5D,OAAO,GAAGD,OAAO,CAACC,OAAR,IAAmB,EAAjC;AACA,cAAI8E,iBAAiB,CAAC9E,OAAD,CAAjB,IAA8BD,OAAO,CAACgH,WAAR,EAAlC,EAAyD,OAAOnD,IAAI,EAAX;AAEzD,cAAI1D,UAAU,GAAGF,OAAO,CAACC,GAAR,CAAYC,UAAZ,IAA0B,EAA3C;AACA,cAAIyB,cAAc,GAAGzB,UAAU,CAACH,OAAO,CAAC6B,SAAT,CAA/B;AACA,cAAIoF,2BAA2B,GAAGrF,cAAc,GAAGA,cAAc,CAACsF,yBAAlB,GAA8C,MAA9F;AACA,cAAIC,SAAS,GAAGvB,8BAA8B,CAAC5F,OAAD,CAA9C;AACA,cAAIoH,4BAA4B,GAAGnH,OAAO,CAACC,GAAR,CAAYkH,4BAA/C;;AACA,cAAID,SAAS,IAAIC,4BAAjB,EAA+C;AAC7C;AACA;AACApH,YAAAA,OAAO,CAACwC,WAAR,CAAoB6E,iBAApB,CAAsC,oBAAtC;AACD;;AACD,kBAAQJ,2BAAR;AACE,iBAAK,UAAL;AACE,kBAAIE,SAAS,IAAIC,4BAAjB,EAA+C;AAC7C;AACA;AACAzF,gBAAAA,wBAAwB,CAAC3B,OAAD,CAAxB;AACAA,gBAAAA,OAAO,CAACsH,gBAAR,CAAyB,6BAAzB,EAAwD,cAAxD,EAAwE3C,yBAAxE;AACD;;AACDd,cAAAA,IAAI;AACJ;;AACF,iBAAK,UAAL;AACE,kBAAIsD,SAAS,KAAK,KAAlB,EAAyB;AACvB;AACA;AACAnH,gBAAAA,OAAO,CAACmE,QAAR,CAAiBC,KAAjB,GAAyBvE,IAAI,CAACuE,KAAL,CAAW,IAAIgB,KAAJ,EAAX,EAAwB;AAC/CP,kBAAAA,IAAI,EAAE,wBADyC;AAE/CQ,kBAAAA,OAAO,EAAE,wCAAwCpF,OAAO,CAACC,GAAR,CAAYqH,SAApD,GAAgE,GAAhE,GAAsEvH,OAAO,CAAC6B,SAA9E,GACC;AAHqC,iBAAxB,CAAzB;AAKAgC,gBAAAA,IAAI;AACJ;AACD;;AACD7D,cAAAA,OAAO,CAACsH,gBAAR,CAAyB,6BAAzB,EAAwD,cAAxD,EAAwE3C,yBAAxE;AACAf,cAAAA,wBAAwB,CAAC5D,OAAD,EAAU6D,IAAV,CAAxB;AACA;;AACF,iBAAK,MAAL;AACA;AACEA,cAAAA,IAAI;AACJ;AA5BJ;AA8BD;;AAEDpE,QAAAA,MAAM,CAACF,OAAP,GAAiB;AACfwH,UAAAA,gBAAgB,EAAEA,gBADH;AAEfnD,UAAAA,wBAAwB,EAAEA,wBAFX;AAGfjC,UAAAA,wBAAwB,EAAEA,wBAHX;AAIfD,UAAAA,yBAAyB,EAAEA,yBAJZ;AAKf3B,UAAAA,WAAW,EAAEA,WALE;AAMfyH,UAAAA,wBAAwB,EAAE7C;AANX,SAAjB,CArX0F,CA+X3F;;AAEA,2BAAA8C,WAAW,GAAGhI,MAAM,CAACF,OAArB;;AACAmI,QAAAA,iBAAiB,GAAGjI,MAAM,CAACF,OAAP,CAAewH,gBAAnC;AACAY,QAAAA,yBAAyB,GAAGlI,MAAM,CAACF,OAAP,CAAeqE,wBAA3C;AACAgE,QAAAA,yBAAyB,GAAGnI,MAAM,CAACF,OAAP,CAAeoC,wBAA3C;AACAkG,QAAAA,0BAA0B,GAAGpI,MAAM,CAACF,OAAP,CAAemC,yBAA5C;AACAoG,QAAAA,YAAY,GAAGrI,MAAM,CAACF,OAAP,CAAeQ,WAA9B;AACAgI,QAAAA,yBAAyB,GAAGtI,MAAM,CAACF,OAAP,CAAeiI,wBAA3C;AAEC,OAzYD,EAyYG,OAAO;AACR,kBAAUtI,IADF;AAER,kBAAUE;AAFF,OAAP,CAzYH","sourcesContent":["import _cjsLoader from 'cce:/internal/ml/cjs-loader.mjs';\nimport { __cjsMetaURL as _req} from './core';\nimport { __cjsMetaURL as _req0} from './util';\nlet _cjsExports;\nlet _discoverEndpoint;\nlet _requiredDiscoverEndpoint;\nlet _optionalDiscoverEndpoint;\nlet _marshallCustomIdentifiers;\nlet _getCacheKey;\nlet _invalidateCachedEndpoint;\nconst __cjsMetaURL = import.meta.url;\n_cjsLoader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {\n// #region ORIGINAL CODE\n\n\n var AWS = require('./core');\n var util = require('./util');\n var endpointDiscoveryEnabledEnvs = ['AWS_ENABLE_ENDPOINT_DISCOVERY', 'AWS_ENDPOINT_DISCOVERY_ENABLED'];\n\n /**\n  * Generate key (except resources and operation part) to index the endpoints in the cache\n  * If input shape has endpointdiscoveryid trait then use\n  *   accessKey + operation + resources + region + service as cache key\n  * If input shape doesn't have endpointdiscoveryid trait then use\n  *   accessKey + region + service as cache key\n  * @return [map<String,String>] object with keys to index endpoints.\n  * @api private\n  */\n function getCacheKey(request) {\n   var service = request.service;\n   var api = service.api || {};\n   var operations = api.operations;\n   var identifiers = {};\n   if (service.config.region) {\n     identifiers.region = service.config.region;\n   }\n   if (api.serviceId) {\n     identifiers.serviceId = api.serviceId;\n   }\n   if (service.config.credentials.accessKeyId) {\n     identifiers.accessKeyId = service.config.credentials.accessKeyId;\n   }\n   return identifiers;\n }\n\n /**\n  * Recursive helper for marshallCustomIdentifiers().\n  * Looks for required string input members that have 'endpointdiscoveryid' trait.\n  * @api private\n  */\n function marshallCustomIdentifiersHelper(result, params, shape) {\n   if (!shape || params === undefined || params === null) return;\n   if (shape.type === 'structure' && shape.required && shape.required.length > 0) {\n     util.arrayEach(shape.required, function(name) {\n       var memberShape = shape.members[name];\n       if (memberShape.endpointDiscoveryId === true) {\n         var locationName = memberShape.isLocationName ? memberShape.name : name;\n         result[locationName] = String(params[name]);\n       } else {\n         marshallCustomIdentifiersHelper(result, params[name], memberShape);\n       }\n     });\n   }\n }\n\n /**\n  * Get custom identifiers for cache key.\n  * Identifies custom identifiers by checking each shape's `endpointDiscoveryId` trait.\n  * @param [object] request object\n  * @param [object] input shape of the given operation's api\n  * @api private\n  */\n function marshallCustomIdentifiers(request, shape) {\n   var identifiers = {};\n   marshallCustomIdentifiersHelper(identifiers, request.params, shape);\n   return identifiers;\n }\n\n /**\n  * Call endpoint discovery operation when it's optional.\n  * When endpoint is available in cache then use the cached endpoints. If endpoints\n  * are unavailable then use regional endpoints and call endpoint discovery operation\n  * asynchronously. This is turned off by default.\n  * @param [object] request object\n  * @api private\n  */\n function optionalDiscoverEndpoint(request) {\n   var service = request.service;\n   var api = service.api;\n   var operationModel = api.operations ? api.operations[request.operation] : undefined;\n   var inputShape = operationModel ? operationModel.input : undefined;\n\n   var identifiers = marshallCustomIdentifiers(request, inputShape);\n   var cacheKey = getCacheKey(request);\n   if (Object.keys(identifiers).length > 0) {\n     cacheKey = util.update(cacheKey, identifiers);\n     if (operationModel) cacheKey.operation = operationModel.name;\n   }\n   var endpoints = AWS.endpointCache.get(cacheKey);\n   if (endpoints && endpoints.length === 1 && endpoints[0].Address === '') {\n     //endpoint operation is being made but response not yet received\n     //or endpoint operation just failed in 1 minute\n     return;\n   } else if (endpoints && endpoints.length > 0) {\n     //found endpoint record from cache\n     request.httpRequest.updateEndpoint(endpoints[0].Address);\n   } else {\n     //endpoint record not in cache or outdated. make discovery operation\n     var endpointRequest = service.makeRequest(api.endpointOperation, {\n       Operation: operationModel.name,\n       Identifiers: identifiers,\n     });\n     addApiVersionHeader(endpointRequest);\n     endpointRequest.removeListener('validate', AWS.EventListeners.Core.VALIDATE_PARAMETERS);\n     endpointRequest.removeListener('retry', AWS.EventListeners.Core.RETRY_CHECK);\n     //put in a placeholder for endpoints already requested, prevent\n     //too much in-flight calls\n     AWS.endpointCache.put(cacheKey, [{\n       Address: '',\n       CachePeriodInMinutes: 1\n     }]);\n     endpointRequest.send(function(err, data) {\n       if (data && data.Endpoints) {\n         AWS.endpointCache.put(cacheKey, data.Endpoints);\n       } else if (err) {\n         AWS.endpointCache.put(cacheKey, [{\n           Address: '',\n           CachePeriodInMinutes: 1 //not to make more endpoint operation in next 1 minute\n         }]);\n       }\n     });\n   }\n }\n\n var requestQueue = {};\n\n /**\n  * Call endpoint discovery operation when it's required.\n  * When endpoint is available in cache then use cached ones. If endpoints are\n  * unavailable then SDK should call endpoint operation then use returned new\n  * endpoint for the api call. SDK will automatically attempt to do endpoint\n  * discovery. This is turned off by default\n  * @param [object] request object\n  * @api private\n  */\n function requiredDiscoverEndpoint(request, done) {\n   var service = request.service;\n   var api = service.api;\n   var operationModel = api.operations ? api.operations[request.operation] : undefined;\n   var inputShape = operationModel ? operationModel.input : undefined;\n\n   var identifiers = marshallCustomIdentifiers(request, inputShape);\n   var cacheKey = getCacheKey(request);\n   if (Object.keys(identifiers).length > 0) {\n     cacheKey = util.update(cacheKey, identifiers);\n     if (operationModel) cacheKey.operation = operationModel.name;\n   }\n   var cacheKeyStr = AWS.EndpointCache.getKeyString(cacheKey);\n   var endpoints = AWS.endpointCache.get(cacheKeyStr); //endpoint cache also accepts string keys\n   if (endpoints && endpoints.length === 1 && endpoints[0].Address === '') {\n     //endpoint operation is being made but response not yet received\n     //push request object to a pending queue\n     if (!requestQueue[cacheKeyStr]) requestQueue[cacheKeyStr] = [];\n     requestQueue[cacheKeyStr].push({request: request, callback: done});\n     return;\n   } else if (endpoints && endpoints.length > 0) {\n     request.httpRequest.updateEndpoint(endpoints[0].Address);\n     done();\n   } else {\n     var endpointRequest = service.makeRequest(api.endpointOperation, {\n       Operation: operationModel.name,\n       Identifiers: identifiers,\n     });\n     endpointRequest.removeListener('validate', AWS.EventListeners.Core.VALIDATE_PARAMETERS);\n     addApiVersionHeader(endpointRequest);\n\n     //put in a placeholder for endpoints already requested, prevent\n     //too much in-flight calls\n     AWS.endpointCache.put(cacheKeyStr, [{\n       Address: '',\n       CachePeriodInMinutes: 60 //long-live cache\n     }]);\n     endpointRequest.send(function(err, data) {\n       if (err) {\n         request.response.error = util.error(err, { retryable: false });\n         AWS.endpointCache.remove(cacheKey);\n\n         //fail all the pending requests in batch\n         if (requestQueue[cacheKeyStr]) {\n           var pendingRequests = requestQueue[cacheKeyStr];\n           util.arrayEach(pendingRequests, function(requestContext) {\n             requestContext.request.response.error = util.error(err, { retryable: false });\n             requestContext.callback();\n           });\n           delete requestQueue[cacheKeyStr];\n         }\n       } else if (data) {\n         AWS.endpointCache.put(cacheKeyStr, data.Endpoints);\n         request.httpRequest.updateEndpoint(data.Endpoints[0].Address);\n\n         //update the endpoint for all the pending requests in batch\n         if (requestQueue[cacheKeyStr]) {\n           var pendingRequests = requestQueue[cacheKeyStr];\n           util.arrayEach(pendingRequests, function(requestContext) {\n             requestContext.request.httpRequest.updateEndpoint(data.Endpoints[0].Address);\n             requestContext.callback();\n           });\n           delete requestQueue[cacheKeyStr];\n         }\n       }\n       done();\n     });\n   }\n }\n\n /**\n  * add api version header to endpoint operation\n  * @api private\n  */\n function addApiVersionHeader(endpointRequest) {\n   var api = endpointRequest.service.api;\n   var apiVersion = api.apiVersion;\n   if (apiVersion && !endpointRequest.httpRequest.headers['x-amz-api-version']) {\n     endpointRequest.httpRequest.headers['x-amz-api-version'] = apiVersion;\n   }\n }\n\n /**\n  * If api call gets invalid endpoint exception, SDK should attempt to remove the invalid\n  * endpoint from cache.\n  * @api private\n  */\n function invalidateCachedEndpoints(response) {\n   var error = response.error;\n   var httpResponse = response.httpResponse;\n   if (error &&\n     (error.code === 'InvalidEndpointException' || httpResponse.statusCode === 421)\n   ) {\n     var request = response.request;\n     var operations = request.service.api.operations || {};\n     var inputShape = operations[request.operation] ? operations[request.operation].input : undefined;\n     var identifiers = marshallCustomIdentifiers(request, inputShape);\n     var cacheKey = getCacheKey(request);\n     if (Object.keys(identifiers).length > 0) {\n       cacheKey = util.update(cacheKey, identifiers);\n       if (operations[request.operation]) cacheKey.operation = operations[request.operation].name;\n     }\n     AWS.endpointCache.remove(cacheKey);\n   }\n }\n\n /**\n  * If endpoint is explicitly configured, SDK should not do endpoint discovery in anytime.\n  * @param [object] client Service client object.\n  * @api private\n  */\n function hasCustomEndpoint(client) {\n   //if set endpoint is set for specific client, enable endpoint discovery will raise an error.\n   if (client._originalConfig && client._originalConfig.endpoint && client._originalConfig.endpointDiscoveryEnabled === true) {\n     throw util.error(new Error(), {\n       code: 'ConfigurationException',\n       message: 'Custom endpoint is supplied; endpointDiscoveryEnabled must not be true.'\n     });\n   };\n   var svcConfig = AWS.config[client.serviceIdentifier] || {};\n   return Boolean(AWS.config.endpoint || svcConfig.endpoint || (client._originalConfig && client._originalConfig.endpoint));\n }\n\n /**\n  * @api private\n  */\n function isFalsy(value) {\n   return ['false', '0'].indexOf(value) >= 0;\n }\n\n /**\n  * If endpoint discovery should perform for this request when no operation requires endpoint\n  * discovery for the given service.\n  * SDK performs config resolution in order like below:\n  * 1. If set in client configuration.\n  * 2. If set in env AWS_ENABLE_ENDPOINT_DISCOVERY.\n  * 3. If set in shared ini config file with key 'endpoint_discovery_enabled'.\n  * @param [object] request request object.\n  * @returns [boolean|undefined] if endpoint discovery config is not set in any source, this\n  *  function returns undefined\n  * @api private\n  */\n function resolveEndpointDiscoveryConfig(request) {\n   var service = request.service || {};\n   if (service.config.endpointDiscoveryEnabled !== undefined) {\n     return service.config.endpointDiscoveryEnabled;\n   }\n\n   //shared ini file is only available in Node\n   //not to check env in browser\n   if (util.isBrowser()) return undefined;\n\n   // If any of recognized endpoint discovery config env is set\n   for (var i = 0; i < endpointDiscoveryEnabledEnvs.length; i++) {\n     var env = endpointDiscoveryEnabledEnvs[i];\n     if (Object.prototype.hasOwnProperty.call(process.env, env)) {\n       if (process.env[env] === '' || process.env[env] === undefined) {\n         throw util.error(new Error(), {\n           code: 'ConfigurationException',\n           message: 'environmental variable ' + env + ' cannot be set to nothing'\n         });\n       }\n       return !isFalsy(process.env[env]);\n     }\n   }\n\n   var configFile = {};\n   try {\n     configFile = AWS.util.iniLoader ? AWS.util.iniLoader.loadFrom({\n       isConfig: true,\n       filename: process.env[AWS.util.sharedConfigFileEnv]\n     }) : {};\n   } catch (e) {}\n   var sharedFileConfig = configFile[\n     process.env.AWS_PROFILE || AWS.util.defaultProfile\n   ] || {};\n   if (Object.prototype.hasOwnProperty.call(sharedFileConfig, 'endpoint_discovery_enabled')) {\n     if (sharedFileConfig.endpoint_discovery_enabled === undefined) {\n       throw util.error(new Error(), {\n         code: 'ConfigurationException',\n         message: 'config file entry \\'endpoint_discovery_enabled\\' cannot be set to nothing'\n       });\n     }\n     return !isFalsy(sharedFileConfig.endpoint_discovery_enabled);\n   }\n   return undefined;\n }\n\n /**\n  * attach endpoint discovery logic to request object\n  * @param [object] request\n  * @api private\n  */\n function discoverEndpoint(request, done) {\n   var service = request.service || {};\n   if (hasCustomEndpoint(service) || request.isPresigned()) return done();\n\n   var operations = service.api.operations || {};\n   var operationModel = operations[request.operation];\n   var isEndpointDiscoveryRequired = operationModel ? operationModel.endpointDiscoveryRequired : 'NULL';\n   var isEnabled = resolveEndpointDiscoveryConfig(request);\n   var hasRequiredEndpointDiscovery = service.api.hasRequiredEndpointDiscovery;\n   if (isEnabled || hasRequiredEndpointDiscovery) {\n     // Once a customer enables endpoint discovery, the SDK should start appending\n     // the string endpoint-discovery to the user-agent on all requests.\n     request.httpRequest.appendToUserAgent('endpoint-discovery');\n   }\n   switch (isEndpointDiscoveryRequired) {\n     case 'OPTIONAL':\n       if (isEnabled || hasRequiredEndpointDiscovery) {\n         // For a given service; if at least one operation requires endpoint discovery then the SDK must enable endpoint discovery\n         // by default for all operations of that service, including operations where endpoint discovery is optional.\n         optionalDiscoverEndpoint(request);\n         request.addNamedListener('INVALIDATE_CACHED_ENDPOINTS', 'extractError', invalidateCachedEndpoints);\n       }\n       done();\n       break;\n     case 'REQUIRED':\n       if (isEnabled === false) {\n         // For a given operation; if endpoint discovery is required and it has been disabled on the SDK client,\n         // then the SDK must return a clear and actionable exception.\n         request.response.error = util.error(new Error(), {\n           code: 'ConfigurationException',\n           message: 'Endpoint Discovery is disabled but ' + service.api.className + '.' + request.operation +\n                     '() requires it. Please check your configurations.'\n         });\n         done();\n         break;\n       }\n       request.addNamedListener('INVALIDATE_CACHED_ENDPOINTS', 'extractError', invalidateCachedEndpoints);\n       requiredDiscoverEndpoint(request, done);\n       break;\n     case 'NULL':\n     default:\n       done();\n       break;\n   }\n }\n\n module.exports = {\n   discoverEndpoint: discoverEndpoint,\n   requiredDiscoverEndpoint: requiredDiscoverEndpoint,\n   optionalDiscoverEndpoint: optionalDiscoverEndpoint,\n   marshallCustomIdentifiers: marshallCustomIdentifiers,\n   getCacheKey: getCacheKey,\n   invalidateCachedEndpoint: invalidateCachedEndpoints,\n };\n\n\n// #endregion ORIGINAL CODE\n\n_cjsExports = module.exports;\n_discoverEndpoint = module.exports.discoverEndpoint;\n_requiredDiscoverEndpoint = module.exports.requiredDiscoverEndpoint;\n_optionalDiscoverEndpoint = module.exports.optionalDiscoverEndpoint;\n_marshallCustomIdentifiers = module.exports.marshallCustomIdentifiers;\n_getCacheKey = module.exports.getCacheKey;\n_invalidateCachedEndpoint = module.exports.invalidateCachedEndpoint;\n\n}, () => ({\n  './core': _req,\n  './util': _req0,\n}));\nexport { _cjsExports as default };\nexport { __cjsMetaURL }\n"]}