{"version":3,"sources":["file:///Users/feiwang/AITown/AITownCocos/assets/src/town/TownModel.ts"],"names":["TownModel","director","_","EventType","BaseModel","showMsg2","mduManger","modelMgr","observer","socket","GlobalConfig","RedManager","network","StaticConfigModel","ModuleID","Log","TAG","constructor","playAniComplete","taskmaodan","chatIsediting","hasToySpine","firstIn","currentTapIndex","goumaitishi","userinfo","frameId","uid","done","level","redVipLevel","gold","avatarUrl","redVipExpire","_NPCsSeverData","playerItems","tasklist","qiandaoResp","init","on","SOCKET_ONMESSAGE","onMessage","getServerCatsData","id","data","da","index","length","element","chgServerCatsData","cat","curCats","key","Object","prototype","hasOwnProperty","call","push","getserItemCountById","goodsId","count","getserItemById","updateTasklist","taskId","status","instance","setkeyState","getTaskserById","taskid","checkcatReq","json","CheckCatsRequest","sendWebSocketBinary","refreshItemDate","itemUpdateResponse","command","code","requestId","changecatInfoReq","catId","name","userName","career","changeCatInfoRequest","changecatReq","catid","ChangeCatsRequest","checkplayerItems","checkPlayerItemsRequest","chatReq","str","chatlistReq","pageNum","tasklistReq","taskListRequest","taskgetReq","taskgetRequest","shareReq","shareRequest","qiandaoReq","qiandaoRequest","yindaoReq","guideid","yindaoRequest","guide","zhaohuReq","zhaohuRequest","getShopList","shopListParameter","shopListRequest","playWithCat","touchCat","touchWithCat","TouchCatRequest","getCurCatId","repData","closeModu","TOWN","load","loadScene","error","scene","log","post","SOCKET_GETALL_NPCS","SOCKET_NPC_MOVE","SOCKET_NPC_ACTION","SOCKET_ONLINE_NPCS","SOCKET_OFFLINE_NPCS","SOCKET_ITEM_STATE_CHANGE","setCurCatId","Number","SOCKET_CHANGE_CATS","SOCKET_CHATLIST","SOCKET_TASKLIST","lasttask","clone","obserdata","last","cur","SOCKET_TASK_CHANGE","task","taskIdList","taskconf","configModel","getConfigById","TaskCfg","dropconfig","DropsCfg","taskReward","catids","catIds","showmsg","SOCKET_TASK_GET","SOCKET_SHARE","SOCKET_QIANDAO","SOCKET_ITEMUPDATE","SOCKET_ZHAOHU","SOCKET_MOVE","SEND_BUY_SHOP_ITEM_SUCCESS_INFO","UPDATE_CAT_CV","WORK_DEFAULT","WORK_STATE_INFO"],"mappings":"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","sourcesContent":["import * as _ from \"lodash-es\";\nimport { EventType } from \"../EventType\";\nimport BaseModel from \"../core/base/BaseModel\";\nimport { showMsg2 } from \"../core/message/MessageManager\";\nimport { mduManger, modelMgr, observer, socket } from \"../game/App\";\nimport { NPCServerD, itemServerD, taskcell } from \"../game/config/DataStruct\";\nimport { GlobalConfig } from \"../game/config/GlobalConfig\";\nimport RedManager from \"../manager/RedManager\";\nimport { network } from \"../../src/model/RequestData\";\nimport StaticConfigModel from \"../../src/model/StaticConfig/StaticConfigModel\";\nimport { ModuleID } from \"../game/config/ModuleID\";\nimport { director } from \"cc\";\nimport { GuideIndex } from \"../../src/model/StaticTextConfig\";\nimport Log from '../../../assets/src/utils/LogUtils'\n\nconst TAG = 'TownModel'\nexport default class TownModel extends BaseModel {\n\n    playAniComplete: boolean = true\n    taskmaodan: number;\n    chatIsediting: boolean = false\n    hasToySpine: boolean = false;\n    firstIn: boolean = false ;\n    constructor() {\n        super();\n    }\n    init() {\n        observer.on(EventType.SOCKET_ONMESSAGE, this.onMessage, this);\n    }\n    /**\n     * 获取cats server data\n     * @param id \n     * @returns \n     */\n    getServerCatsData(id: number): NPCServerD {\n        if (this._NPCsSeverData?.data) {\n            let da: any[] = this._NPCsSeverData.data;\n            for (let index = 0; index < da.length; index++) {\n                const element = da[index];\n                if (element.id == id) {\n                    return element;\n                }\n            }\n        }\n        return null;\n    }\n    /**\n     * 添加新猫咪\n     */\n    chgServerCatsData(cat: NPCServerD) {\n\n        if (this._NPCsSeverData?.data) {\n            let curCats = this.getServerCatsData(cat.id);\n            if (curCats) {\n                for (const key in curCats) {\n                    if (Object.prototype.hasOwnProperty.call(curCats, key)) {\n                        curCats[key] = cat[key];\n                    }\n                }\n            } else {\n                this._NPCsSeverData?.data.push(cat);\n            }\n        }\n    }\n    /**\n     * tab 当前页提示\n     */\n    currentTapIndex: any = {\n        \"mainbottom\": 2,\n        \"gedantab\": 0,\n        \"jishi\": 0,\n        \"jishi_goumai\": 0,\n        \"jishi_chushou\": 0,\n        \"renwuab\": 0,\n        \"pre_renwutab\": 0,\n        \"pre_tujiantab\": 0,\n        \"pre_tujianrwdtab\": 0,\n        \"qingdantab\": 0,\n        \"tujianrdtab\": 0,\n        \"pre_Tujianrand\": 0,\n        \"pre_emailtab\": 0,\n        \"pre_dongtaitab\": 0,\n        \"tujian_pets\": 0,\n        \"shop\": 0,\n\n    };\n    goumaitishi: number;\n    /**\n     * frameId:头像框\n     * uid:用户uid,\n     * done:登录奖励是否领取\n     * level:等级\n     * redVipLevel: 会员等级\n     * done: 是否已领取登录奖励\n     * gold: 云贝数量\n     * avatarUrl 用户头像 \n     * redVipExpire:用户会员到期时间\n     */\n    userinfo: {\n        frameId: string,\n        uid: number,\n        done: boolean,\n        level: number,\n        redVipLevel: number,\n        gold: number,\n        avatarUrl: string,\n        redVipExpire: number,\n    } = {\n            frameId: \"dff\",\n            uid: 121,\n            done: false,\n            level: 11,\n            redVipLevel: 1,\n            gold: 10,\n            avatarUrl: \"\",\n            redVipExpire: 11,\n        };\n\n    /**\n     * 根据道具id获取道具数量\n     * @param id \n     * @returns \n     */\n    public getserItemCountById(id: number) {\n        let da = this.playerItems?.data;\n        if (da && da.length > 0) {\n            for (let index = 0; index < da.length; index++) {\n                const element = da[index];\n                if (element.goodsId == id) {\n                    return element.count;\n                }\n            }\n        } else {\n            return 0;\n        }\n        return 0;\n    }\n    /**\n        * 根据道具id获取道具\n        * @param id \n        * @returns \n        */\n    public getserItemById(id: number): itemServerD {\n        let da = this.playerItems?.data;\n        if (da && da.length > 0) {\n            for (let index = 0; index < da.length; index++) {\n                const element = da[index];\n                if (element.goodsId == id) {\n                    return element;\n                }\n            }\n        } else {\n            return null;\n        }\n        return null;\n    }\n    private updateTasklist(da: taskcell) {\n        if (this?.tasklist?.data) {\n            for (let index = 0; index < this?.tasklist?.data.length; index++) {\n                let element = this?.tasklist?.data[index];\n                if (element.taskId == da.taskId) {\n                    element.status = da.status;\n                }\n            }\n            RedManager.instance.setkeyState(\"renwutabred\", this.tasklist);\n        }\n    }\n\n    public getTaskserById(taskid: number): taskcell {\n        if (this?.tasklist?.data) {\n            for (let index = 0; index < this?.tasklist?.data.length; index++) {\n                let element = this?.tasklist?.data[index];\n                if (element.taskId == taskid) {\n                    return element;\n                }\n            }\n        }\n        return null;\n    }\n\n    //======================================\n    public checkcatReq() {\n        let json = new network.CheckCatsRequest();\n        socket.sendWebSocketBinary(json);\n    }\n\n    refreshItemDate(){\n        let json = new network.itemUpdateResponse();\n        json.command = 10009\n        json.code = 1\n        json.requestId = 1719819694942\n        socket.sendWebSocketBinary(json);\n    }\n\n    public changecatInfoReq(catId: number, name: string, userName: string, career) {\n        let json = new network.changeCatInfoRequest();\n        json.data.catId = catId;\n        json.data.name = name;\n        json.data.userName = userName;\n        json.data.career = career\n        socket.sendWebSocketBinary(json);\n    }\n    public changecatReq(catid: number) {\n        let json = new network.ChangeCatsRequest();\n        json.data.catId = catid;\n        socket.sendWebSocketBinary(json);\n    }\n    public checkplayerItems() {\n        let json = new network.checkPlayerItemsRequest();\n        socket.sendWebSocketBinary(json);\n    }\n    public chatReq(catid: number, str: string) {\n        // let json = new network.chatRequest();\n        // json.data.catId = catid;\n        // json.data.context = str;\n        // socket.sendWebSocketBinary(json);\n    }\n    public chatlistReq(catid: number, pageNum: number) {\n        // let json = new network.chatListRequest();\n        // json.data.catId = catid;\n        // json.data.pageNum = pageNum;\n        // socket.sendWebSocketBinary(json);\n    }\n    public tasklistReq() {\n        let json = new network.taskListRequest();\n        socket.sendWebSocketBinary(json);\n    }\n\n    public taskgetReq(taskid: number) {\n        let json = new network.taskgetRequest();\n        json.data.taskId = taskid;\n        socket.sendWebSocketBinary(json);\n    }\n    public shareReq() {\n        let json = new network.shareRequest();\n        socket.sendWebSocketBinary(json);\n    }\n    public qiandaoReq() {\n        let json = new network.qiandaoRequest();\n        socket.sendWebSocketBinary(json);\n    }\n\n    public yindaoReq(guideid: number) {\n        let json = new network.yindaoRequest();\n        json.data.guide = guideid;\n        socket.sendWebSocketBinary(json);\n\n\n    }\n    public zhaohuReq() {\n        let json = new network.zhaohuRequest();\n        socket.sendWebSocketBinary(json);\n    }\n\n    public getShopList(){\n        let shopListParameter = new network.shopListRequest\n        socket.sendWebSocketBinary(shopListParameter)\n    }\n\n    public playWithCat(catId: number, goodsId: number, count: number){\n        // let playWithCat = new network.PlayWithCatRequest\n        // playWithCat.data.catId = catId\n        // playWithCat.data.count = count\n        // playWithCat.data.goodsId = goodsId\n        // socket.sendWebSocketBinary(playWithCat)\n    }\n\n    public touchCat(){\n        let touchWithCat = new network.TouchCatRequest\n        touchWithCat.data.catId = GlobalConfig.instance.getCurCatId()\n        socket.sendWebSocketBinary(touchWithCat)\n    }\n\n    private _NPCsSeverData: network.CheckCatsResponse;\n    public playerItems: network.checkPlayerItemsResponse;\n    public tasklist: network.taskListResponse;\n    public qiandaoResp: network.qiandaoResponse;\n    public onMessage(da: any) {\n        let repData: network.InetwarkResponseData = da.data;\n        if (repData.command == 99998) {\n            mduManger.closeModu(ModuleID.TOWN);\n            let load = director.loadScene(\"login\", (error: Error, scene: any) => {\n                Log.log(TAG,error, scene);\n            });\n            if (load) {\n                //showMsg2(modelMgr.configModel.getStrById(99998));\n            }\n            return;\n        }\n        if (repData.command == 10002) {//查询NPC信息\n            this._NPCsSeverData = da.data;\n            observer.post(EventType.SOCKET_GETALL_NPCS, this._NPCsSeverData);\n        } else if (repData.command == 10006) {//修改npc信息\n            // let catinfo = this.getServerCatsData(da.data.data.cat.id);\n            // for (const key in catinfo) {\n            //     if (Object.prototype.hasOwnProperty.call(catinfo, key)) {\n            //         catinfo[key] = da.data.data.cat[key];\n            //         catinfo.career = da.data.data.cat?.career\n            //     }\n            // }\n            observer.post(EventType.SOCKET_NPC_MOVE, da.data.data);\n        }\n        else if (repData.command == 10007) {//npc action\n            observer.post(EventType.SOCKET_NPC_ACTION, da.data);\n        } \n        else if (repData.command == 10004) {//上线信息推送\n            //const cati = da.data.data[0];\n            //this.chgServerCatsData(cati);\n            observer.post(EventType.SOCKET_ONLINE_NPCS, da.data.data);\n\n        } else if (repData.command == 10005) {//下线选角\n            // GlobalConfig.instance.curSelCat = da.data;\n            //GlobalConfig.instance.setCurCatId(da.data.data.cat.id);\n\n            observer.post(EventType.SOCKET_OFFLINE_NPCS, da.data.data);\n        } else if (repData.command == 10011) {//npc farm行为\n            this.playerItems = da.data;\n            observer.post(EventType.SOCKET_ITEM_STATE_CHANGE, da.data.data);\n\n        } else if (repData.command == 10019) {//切换猫咪\n            GlobalConfig.instance.setCurCatId(Number(da.data.data.catId));\n            observer.post(EventType.SOCKET_CHANGE_CATS);\n        } else if (repData.command == 10016) {\n        } else if (repData.command == 10017) {\n            observer.post(EventType.SOCKET_CHATLIST, da.data);\n            //GlobalConfig.instance.currentChatTimes = da.data.data.chats.filter(obj => obj.to === GlobalConfig.instance.getCurCatId()).length\n        } else if (repData.command == 10012) {\n            this.tasklist = da.data;\n            RedManager.instance.setkeyState(\"renwutabred\", this.tasklist);\n            observer.post(EventType.SOCKET_TASKLIST, da.data);\n        } else if (repData.command == 10010) {//任务状态改变\n            let lasttask: taskcell = _.clone(this.getTaskserById(da.data.data[0].taskId));\n            this.updateTasklist(da.data.data[0]);\n            let obserdata = { last: lasttask, cur: da.data.data[0] };\n            observer.post(EventType.SOCKET_TASK_CHANGE, obserdata);\n        } else if (repData.command == 10013) {//任务领取\n            let task = this.getTaskserById(da.data.data.taskIdList[0]);\n            task.status = 3;\n            // this.updateTasklist();\n            RedManager.instance.setkeyState(\"renwutabred\", this.tasklist);\n            let taskconf = modelMgr.configModel.getConfigById(StaticConfigModel.TaskCfg, task.taskId);\n            let dropconfig = modelMgr.configModel.getConfigById(StaticConfigModel.DropsCfg, taskconf.taskReward);\n            if (task.taskId == 10003 || task.taskId == 10005 || task.taskId == 30001) {\n                let catids = da.data.data.catIds;\n                if (catids && catids[0]) {\n                    this.taskmaodan = catids[0];\n                    observer.post(\"showcategg\", catids[0]);\n                } else {//猫蛋转金币是10个金币；\n                    showMsg2(`Congratulations on receiving 10 Cat Coins.`)\n                }\n            } else {\n                showMsg2(dropconfig.showmsg);\n            }\n            // if (da.data.goodsDataList && da.data.goodsDataList.length) {\n            //     for (let index = 0; index < da.data.goodsDataList.length; index++) {\n            //         const element: itemServerD = da.data.goodsDataList[index];\n            //         let goods = this.getserItemById(element.goodsId);\n            //         if (goods) {\n            //             goods = { ...element };\n            //         }\n            //     }\n            // }\n            //猫蛋特殊处理\n\n            observer.post(EventType.SOCKET_TASK_GET, da.data);\n        } else if (repData.command == 10015) {//分享\n            observer.post(EventType.SOCKET_SHARE, da.data);\n        } else if (repData.command == 10014) {//签到\n            this.qiandaoResp = da.data;\n            observer.post(EventType.SOCKET_QIANDAO, da.data);\n        } else if (repData.command == 10009) {//道具更新\n            observer.post(EventType.SOCKET_ITEMUPDATE, da.data.data);\n        } else if (repData.command == 10022) {//打招呼\n            // const guideInfo = GlobalConfig.instance.LoginData.data.player.guide\n            // if(GlobalConfig.instance.LoginData.data.player.chatNum >= 3 && !guideInfo?.find?.(element => element === GuideIndex.START_GUIDE_STATE5.end)){\n            //     //触发第五阶段引导\n            //     observer.post(EventType.UPDATE_GUIDE_INFO_MAIN_VIEW, GuideIndex.START_GUIDE_STATE5)\n            //     observer.post(EventType.SHOW_CHAT_LOG_BUTTON)\n            // }\n            observer.post(EventType.SOCKET_ZHAOHU, da.data);\n        }\n        else if(repData.command == 10024){ //商店列表\n            //observer.post(EventType.SOCKET_SHOP_ITEM_LIST, da.data)\n        }\n        else if(repData.command == 10008){ //商店列表\n            observer.post(EventType.SOCKET_MOVE, da.data)\n        }\n        else if(repData.command == 10025){ //商店列表\n            observer.post(EventType.SEND_BUY_SHOP_ITEM_SUCCESS_INFO, da.data)\n            this.checkplayerItems()\n        }\n\n        else if(repData.command == 10027){ //使用逗猫玩具\n            //observer.post(EventType.SEND_BUY_SHOP_ITEM_SUCCESS_INFO, da.data)\n            //this.checkplayerItems()\n            Log.log(TAG, da.data)\n        }\n\n        else if(repData.command == 10026){ //抚摸猫\n            //observer.post(EventType.SEND_BUY_SHOP_ITEM_SUCCESS_INFO, da.data)\n            //this.checkplayerItems()\n            Log.log(TAG,'play with cat', da.data)\n            observer.post(EventType.UPDATE_CAT_CV, da.data)\n        }\n\n        else if(repData.command == 10028){ //创建打工活动\n            Log.log(TAG,'create work active', da.data)\n            if(da.data.code !== 0){\n                observer.post(EventType.WORK_DEFAULT)\n            }\n            //WorkCatModel.currentWorkId = da?.data?.data?.workId\n        }\n\n        else if(repData.command == 10029){ //领取打工奖励\n            Log.log(TAG,'work reward', da.data)\n        }\n\n        else if(repData.command == 10030){ //打工数据推送\n            Log.log(TAG,'work result', da.data)\n            observer.post(EventType.WORK_STATE_INFO, da.data)\n        }\n\n    }\n\n}"]}