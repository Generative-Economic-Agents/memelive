{"version":3,"sources":["file:///Users/feiwang/workSpace/AITown/cutepet/assets/src/model/StaticConfig/StaticConfigModel.ts"],"names":["StaticConfigModel","resources","assetManager","JsonAsset","error","log","_","BaseModel","GlobalConfig","Log","TAG","_commonconfig","_commonConfigArr","Cat","TaskCfg","DropsCfg","ItemCfg","SysParameter","ConstCfg","_commonConfigJson","Object","commonConfigJson","getCatDataById","catid","arr","index","length","element","id","getDropConfigById","dropid","getConfigById","configname","loadconfig","name","callback","loadRemote","err","res","message","json","loadconfiglocal","load","loadResDir","loadDir","assets","i","asset","keyBy","instance","hasJsonsLoad","getItemByid","item","items","objtoArr","obj","values","getseriesConfigById","series","getGrpsByName","grps","getconfigByGrpAId","getStrById","strobj","en_str"],"mappings":"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","sourcesContent":["import { resources, assetManager, JsonAsset, error, log } from \"cc\";\nimport * as _ from \"lodash-es\";\nimport BaseModel from \"../../core/base/BaseModel\";\nimport ItemCData from \"./ItemCData\";\nimport { GlobalConfig } from \"../../game/config/GlobalConfig\";\nimport { catCfgD } from \"../../game/config/DataStruct\";\nimport Log from '../../../../assets/src/utils/LogUtils'\n\nconst TAG = 'StaticConfigModel'\nexport default class StaticConfigModel extends BaseModel {\n    // private _commonconfig = \"http://192.168.95.67:8000/config.json\";\n    // private _commonconfig = \"https://web-static.baochuangames.com/nos/image/plantflowergames/config.json\";\n    private _commonconfig = \"https://d1.music.126.net/dmusic/obj/w5zCg8OAw6HDjzjDgMK_/24055495632/2cdc/6e09/89e9/e9f5817449174b3672862dc3bd1dfb7d.json?download=config.json\";\n\n    private _commonConfigArr: any = {\n        Cat: [],\n        TaskCfg: [],\n        DropsCfg: [],\n        ItemCfg: [],\n        SysParameter: [],\n        ConstCfg:[]\n    };\n\n    /**\n     * id:key\n     */\n    private _commonConfigJson:any = {\n        Cat: Object,\n        TaskCfg: Object,\n        DropsCfg: Object,\n        ItemCfg: Object,\n        SysParameter: Object,\n        ConstCfg:Object\n    };\n    \n    public  static readonly  Cat = \"Cat\";\n    public  static readonly  TaskCfg = \"TaskCfg\";\n    public  static readonly  DropsCfg = \"DropsCfg\";\n    public  static readonly  ItemCfg = \"ItemCfg\";\n    public  static readonly  ConstCfg = \"ConstCfg\";\n    public  static readonly  SysParameter = \"SysParameter\";\n    public get commonConfigJson() {\n        return this._commonConfigArr;\n    }\n    public getCatDataById(catid:number):catCfgD{\n        let arr: any[] = this.commonConfigJson.Cat;\n        for (let index = 0; index < arr.length; index++) {\n            const element = arr[index];\n            if(element.id==catid){\n                return element;\n            }\n        }\n        return null;\n    }\n\n    public getDropConfigById(dropid:number){\n        let arr: any[] = this.commonConfigJson.DropsCfg;\n        for (let index = 0; index < arr.length; index++) {\n            const element = arr[index];\n            if(element.id==dropid){\n                return element;\n            }\n        }\n        return null;\n    }\n\n    public getConfigById(configname:string ,id:number){\n        let arr: any[] = this.commonConfigJson[configname];\n        for (let index = 0; index < arr.length; index++) {\n            const element = arr[index];\n            if(element.id==id){\n                return element;\n            }\n        }\n        return null;\n    }\n    /**\n     * 远程加载\n     * @param name \n     * @param callback \n     */\n    public loadconfig(name: string = null, callback: Function) {\n        if (!name) {\n            name = this._commonconfig\n        }\n        assetManager.loadRemote<JsonAsset>(name, (err: any, res: JsonAsset) => {\n            if (err) {\n                error(err.message || err);\n                return;\n            }\n            // 获取到 Json 数据\n            this._commonConfigArr = res.json!;\n            if (callback) {\n                callback();\n            }\n        })\n        // resources.load('gameGiftJson', (err: any, res: JsonAsset) => {\n        //     if (err) {\n        //         error(err.message || err);\n        //         return;\n        //     }\n        //     // 获取到 Json 数据\n        //     const jsonData: object = res.json!;\n\n        // })\n    }\n    /**\n     *  用于管理所有在 assets/resources 下的资源。\n     * @param name \n     * @param callback \n     */\n    public loadconfiglocal(name: string = null, callback: Function) {\n        if (!name) {\n            name = this._commonconfig\n        }\n        resources.load<JsonAsset>(name, (err: any, res: JsonAsset) => {\n            if (err) {\n                error(err.message || err);\n                return;\n            }\n            // 获取到 Json 数据\n            this._commonConfigArr = res.json!;\n            if (callback) {\n                callback();\n            }\n        })\n        // resources.load('gameGiftJson', (err: any, res: JsonAsset) => {\n        //     if (err) {\n        //         error(err.message || err);\n        //         return;\n        //     }\n        //     // 获取到 Json 数据\n        //     const jsonData: object = res.json!;\n\n        // })\n    }\n    /**\n     * 加载指定目录里的json配置\n     */\n    public loadResDir() {\n        resources.loadDir('jsons', JsonAsset, (err, assets) => {\n            if (err) {\n                error(err.message || err);\n                return;\n            }\n\n            for (let i = 0; i < assets.length; ++i) {\n                const asset = assets[i];\n                this._commonConfigArr[asset.name] = asset.json;\n                this._commonConfigJson[asset.name] = _.keyBy(asset.json,\"id\");\n                log(asset.name + ' loaded', asset);\n                // 处理加载的 JSON 文件\n            }\n            GlobalConfig.instance.hasJsonsLoad = true;\n        });\n    }\n\n    public getItemByid(id: number): ItemCData {\n        let item = this._commonConfigArr.items[id + \"\"];\n        if (!item) {\n            Log.log(\"没有找到道具itemid:\" + id);\n        }\n        return item;\n    }\n\n    /**\n     * \n     * @param obj \n     * @returns \n     */\n    public objtoArr(obj: object): any[] {\n        let arr = _.values(obj);\n        return arr;\n    }\n\n    /**\n     * 获取系列\n     * @param id \n     * @returns \n     */\n    public getseriesConfigById(id: number) {\n        let item = this._commonConfigArr.series[id + \"\"];\n        if (!item) {\n            Log.log(\"没有找到系列:\" + id);\n            item = {};\n        }\n        return item;\n    }\n\n    public getGrpsByName(name: string) {\n        let grps = this._commonConfigArr[name];\n        if (!grps) {\n            Log.log(\"没有找到组:\" + name);\n            grps = [];\n        }\n        return grps;\n    }\n\n    /**\n     * \n     * @param name \n     * @param id \n     * @returns \n     */\n    public getconfigByGrpAId(name: string, id: number) {//id==key\n        let grps = this._commonConfigJson[name];\n        if(!grps){\n            Log.log(\"没有找到组\",name);\n            return;\n        }\n        let item = this._commonConfigJson[name][id]\n        if (!item) {\n            Log.log(\"没有找到系列:\" + id);\n            item = {};\n        }\n        return item;\n    }\n    public getStrById(id:number):string{\n      let strobj =  this._commonConfigJson[StaticConfigModel.ConstCfg][id] ;\n      if(strobj&&strobj.en_str){\n          return strobj.en_str;\n      }else{\n        return \"未获取到配置：\"+id;\n      }\n    }\n}\n\n\n//item\n// {\n//     \"id\": 110011,\n//     \"season\": 1,\n//     \"type\": 1,\n//     \"name\": \"普通种子\",\n//     \"icon\": \"https://web-static.baochuangames.com/nos/image/plantflowergames/zzbg.png\",\n//     \"description\": \"可以种出普通级的花朵\"\n// }"]}