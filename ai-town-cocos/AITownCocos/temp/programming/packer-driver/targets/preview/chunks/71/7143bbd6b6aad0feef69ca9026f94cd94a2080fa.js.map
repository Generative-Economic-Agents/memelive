{"version":3,"sources":["file:///Users/feiwang/cutepet/node_modules/http-signature/lib/parser.js"],"names":["_cjsLoader","_req","__cjsMetaURL","_req0","_req1","url","define","exports","require","module","__filename","__dirname","assert","util","utils","HASH_ALGOS","PK_ALGOS","HttpSignatureError","InvalidAlgorithmError","validateAlgorithm","State","New","Params","ParamsState","Name","Quote","Value","Comma","ExpiredRequestError","message","call","inherits","InvalidHeaderError","InvalidParamsError","MissingHeaderError","StrictParsingError","parseRequest","request","options","object","headers","undefined","arrayOfString","optionalFinite","clockSkew","authzHeaderName","authorizationHeaderName","i","state","substate","tmpName","tmpValue","parsed","scheme","params","signingString","authz","length","c","charAt","Number","code","charCodeAt","Error","split","keyId","algorithm","signature","toLowerCase","e","h","strict","method","httpVersion","value","date","Date","now","skew","Math","abs","getTime","forEach","hdr","indexOf","algorithms","toUpperCase","_cjsExports","_parseRequest"],"mappings":"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","sourcesContent":["import _cjsLoader from 'cce:/internal/ml/cjs-loader.mjs';\nimport { __cjsMetaURL as _req} from 'assert-plus';\nimport { __cjsMetaURL as _req0} from 'util';\nimport { __cjsMetaURL as _req1} from './utils';\nlet _cjsExports;\nlet _parseRequest;\nconst __cjsMetaURL = import.meta.url;\n_cjsLoader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {\n// #region ORIGINAL CODE\n\n\n // Copyright 2012 Joyent, Inc.  All rights reserved.\n\n var assert = require('assert-plus');\n var util = require('util');\n var utils = require('./utils');\n\n\n\n ///--- Globals\n\n var HASH_ALGOS = utils.HASH_ALGOS;\n var PK_ALGOS = utils.PK_ALGOS;\n var HttpSignatureError = utils.HttpSignatureError;\n var InvalidAlgorithmError = utils.InvalidAlgorithmError;\n var validateAlgorithm = utils.validateAlgorithm;\n\n var State = {\n   New: 0,\n   Params: 1\n };\n\n var ParamsState = {\n   Name: 0,\n   Quote: 1,\n   Value: 2,\n   Comma: 3\n };\n\n\n ///--- Specific Errors\n\n\n function ExpiredRequestError(message) {\n   HttpSignatureError.call(this, message, ExpiredRequestError);\n }\n util.inherits(ExpiredRequestError, HttpSignatureError);\n\n\n function InvalidHeaderError(message) {\n   HttpSignatureError.call(this, message, InvalidHeaderError);\n }\n util.inherits(InvalidHeaderError, HttpSignatureError);\n\n\n function InvalidParamsError(message) {\n   HttpSignatureError.call(this, message, InvalidParamsError);\n }\n util.inherits(InvalidParamsError, HttpSignatureError);\n\n\n function MissingHeaderError(message) {\n   HttpSignatureError.call(this, message, MissingHeaderError);\n }\n util.inherits(MissingHeaderError, HttpSignatureError);\n\n function StrictParsingError(message) {\n   HttpSignatureError.call(this, message, StrictParsingError);\n }\n util.inherits(StrictParsingError, HttpSignatureError);\n\n ///--- Exported API\n\n module.exports = {\n\n   /**\n    * Parses the 'Authorization' header out of an http.ServerRequest object.\n    *\n    * Note that this API will fully validate the Authorization header, and throw\n    * on any error.  It will not however check the signature, or the keyId format\n    * as those are specific to your environment.  You can use the options object\n    * to pass in extra constraints.\n    *\n    * As a response object you can expect this:\n    *\n    *     {\n    *       \"scheme\": \"Signature\",\n    *       \"params\": {\n    *         \"keyId\": \"foo\",\n    *         \"algorithm\": \"rsa-sha256\",\n    *         \"headers\": [\n    *           \"date\" or \"x-date\",\n    *           \"digest\"\n    *         ],\n    *         \"signature\": \"base64\"\n    *       },\n    *       \"signingString\": \"ready to be passed to crypto.verify()\"\n    *     }\n    *\n    * @param {Object} request an http.ServerRequest.\n    * @param {Object} options an optional options object with:\n    *                   - clockSkew: allowed clock skew in seconds (default 300).\n    *                   - headers: required header names (def: date or x-date)\n    *                   - algorithms: algorithms to support (default: all).\n    *                   - strict: should enforce latest spec parsing\n    *                             (default: false).\n    * @return {Object} parsed out object (see above).\n    * @throws {TypeError} on invalid input.\n    * @throws {InvalidHeaderError} on an invalid Authorization header error.\n    * @throws {InvalidParamsError} if the params in the scheme are invalid.\n    * @throws {MissingHeaderError} if the params indicate a header not present,\n    *                              either in the request headers from the params,\n    *                              or not in the params from a required header\n    *                              in options.\n    * @throws {StrictParsingError} if old attributes are used in strict parsing\n    *                              mode.\n    * @throws {ExpiredRequestError} if the value of date or x-date exceeds skew.\n    */\n   parseRequest: function parseRequest(request, options) {\n     assert.object(request, 'request');\n     assert.object(request.headers, 'request.headers');\n     if (options === undefined) {\n       options = {};\n     }\n     if (options.headers === undefined) {\n       options.headers = [request.headers['x-date'] ? 'x-date' : 'date'];\n     }\n     assert.object(options, 'options');\n     assert.arrayOfString(options.headers, 'options.headers');\n     assert.optionalFinite(options.clockSkew, 'options.clockSkew');\n\n     var authzHeaderName = options.authorizationHeaderName || 'authorization';\n\n     if (!request.headers[authzHeaderName]) {\n       throw new MissingHeaderError('no ' + authzHeaderName + ' header ' +\n                                    'present in the request');\n     }\n\n     options.clockSkew = options.clockSkew || 300;\n\n\n     var i = 0;\n     var state = State.New;\n     var substate = ParamsState.Name;\n     var tmpName = '';\n     var tmpValue = '';\n\n     var parsed = {\n       scheme: '',\n       params: {},\n       signingString: ''\n     };\n\n     var authz = request.headers[authzHeaderName];\n     for (i = 0; i < authz.length; i++) {\n       var c = authz.charAt(i);\n\n       switch (Number(state)) {\n\n       case State.New:\n         if (c !== ' ') parsed.scheme += c;\n         else state = State.Params;\n         break;\n\n       case State.Params:\n         switch (Number(substate)) {\n\n         case ParamsState.Name:\n           var code = c.charCodeAt(0);\n           // restricted name of A-Z / a-z\n           if ((code >= 0x41 && code <= 0x5a) || // A-Z\n               (code >= 0x61 && code <= 0x7a)) { // a-z\n             tmpName += c;\n           } else if (c === '=') {\n             if (tmpName.length === 0)\n               throw new InvalidHeaderError('bad param format');\n             substate = ParamsState.Quote;\n           } else {\n             throw new InvalidHeaderError('bad param format');\n           }\n           break;\n\n         case ParamsState.Quote:\n           if (c === '\"') {\n             tmpValue = '';\n             substate = ParamsState.Value;\n           } else {\n             throw new InvalidHeaderError('bad param format');\n           }\n           break;\n\n         case ParamsState.Value:\n           if (c === '\"') {\n             parsed.params[tmpName] = tmpValue;\n             substate = ParamsState.Comma;\n           } else {\n             tmpValue += c;\n           }\n           break;\n\n         case ParamsState.Comma:\n           if (c === ',') {\n             tmpName = '';\n             substate = ParamsState.Name;\n           } else {\n             throw new InvalidHeaderError('bad param format');\n           }\n           break;\n\n         default:\n           throw new Error('Invalid substate');\n         }\n         break;\n\n       default:\n         throw new Error('Invalid substate');\n       }\n\n     }\n\n     if (!parsed.params.headers || parsed.params.headers === '') {\n       if (request.headers['x-date']) {\n         parsed.params.headers = ['x-date'];\n       } else {\n         parsed.params.headers = ['date'];\n       }\n     } else {\n       parsed.params.headers = parsed.params.headers.split(' ');\n     }\n\n     // Minimally validate the parsed object\n     if (!parsed.scheme || parsed.scheme !== 'Signature')\n       throw new InvalidHeaderError('scheme was not \"Signature\"');\n\n     if (!parsed.params.keyId)\n       throw new InvalidHeaderError('keyId was not specified');\n\n     if (!parsed.params.algorithm)\n       throw new InvalidHeaderError('algorithm was not specified');\n\n     if (!parsed.params.signature)\n       throw new InvalidHeaderError('signature was not specified');\n\n     // Check the algorithm against the official list\n     parsed.params.algorithm = parsed.params.algorithm.toLowerCase();\n     try {\n       validateAlgorithm(parsed.params.algorithm);\n     } catch (e) {\n       if (e instanceof InvalidAlgorithmError)\n         throw (new InvalidParamsError(parsed.params.algorithm + ' is not ' +\n           'supported'));\n       else\n         throw (e);\n     }\n\n     // Build the signingString\n     for (i = 0; i < parsed.params.headers.length; i++) {\n       var h = parsed.params.headers[i].toLowerCase();\n       parsed.params.headers[i] = h;\n\n       if (h === 'request-line') {\n         if (!options.strict) {\n           /*\n            * We allow headers from the older spec drafts if strict parsing isn't\n            * specified in options.\n            */\n           parsed.signingString +=\n             request.method + ' ' + request.url + ' HTTP/' + request.httpVersion;\n         } else {\n           /* Strict parsing doesn't allow older draft headers. */\n           throw (new StrictParsingError('request-line is not a valid header ' +\n             'with strict parsing enabled.'));\n         }\n       } else if (h === '(request-target)') {\n         parsed.signingString +=\n           '(request-target): ' + request.method.toLowerCase() + ' ' +\n           request.url;\n       } else {\n         var value = request.headers[h];\n         if (value === undefined)\n           throw new MissingHeaderError(h + ' was not in the request');\n         parsed.signingString += h + ': ' + value;\n       }\n\n       if ((i + 1) < parsed.params.headers.length)\n         parsed.signingString += '\\n';\n     }\n\n     // Check against the constraints\n     var date;\n     if (request.headers.date || request.headers['x-date']) {\n         if (request.headers['x-date']) {\n           date = new Date(request.headers['x-date']);\n         } else {\n           date = new Date(request.headers.date);\n         }\n       var now = new Date();\n       var skew = Math.abs(now.getTime() - date.getTime());\n\n       if (skew > options.clockSkew * 1000) {\n         throw new ExpiredRequestError('clock skew of ' +\n                                       (skew / 1000) +\n                                       's was greater than ' +\n                                       options.clockSkew + 's');\n       }\n     }\n\n     options.headers.forEach(function (hdr) {\n       // Remember that we already checked any headers in the params\n       // were in the request, so if this passes we're good.\n       if (parsed.params.headers.indexOf(hdr.toLowerCase()) < 0)\n         throw new MissingHeaderError(hdr + ' was not a signed header');\n     });\n\n     if (options.algorithms) {\n       if (options.algorithms.indexOf(parsed.params.algorithm) === -1)\n         throw new InvalidParamsError(parsed.params.algorithm +\n                                      ' is not a supported algorithm');\n     }\n\n     parsed.algorithm = parsed.params.algorithm.toUpperCase();\n     parsed.keyId = parsed.params.keyId;\n     return parsed;\n   }\n\n };\n\n\n// #endregion ORIGINAL CODE\n\n_cjsExports = module.exports;\n_parseRequest = module.exports.parseRequest;\n\n}, () => ({\n  'assert-plus': _req,\n  'util': _req0,\n  './utils': _req1,\n}));\nexport { _cjsExports as default };\nexport { __cjsMetaURL }\n"]}