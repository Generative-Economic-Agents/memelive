{"version":3,"sources":["file:///Users/feiwang/AITown/AITownCocos/assets/src/town/touch.ts"],"names":["_decorator","Component","Label","Node","ScrollView","Vec2","GlobalConfig","WebUtils","ccclass","property","npcICON","NpcHomeName","NpcViewName","touch","npcIndex","preOffset","curOffset","start","node","on","EventType","TOUCH_START","event","scroll","scrollNode","getComponent","TOUCH_END","startPos","getStartLocation","prePos","getPreviousLocation","Math","abs","y","x","scrollToOffset","getScrollOffset","canvas","scale","active","setScale","getResouceImg","watchType","npcIcon","npcHomeName","string","camera","setPosition","front","scrollEvent","data","instance","currentNpcIndex","scrollUp","scrollDown","scrollLeft","scrollRight","update","deltaTime"],"mappings":"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","sourcesContent":["import {\n  _decorator,\n  Component,\n  EventTouch,\n  Label,\n  Node,\n  ScrollView,\n  Sprite,\n  SystemEvent,\n  Vec2,\n  Vec3,\n  view,\n} from \"cc\";\nimport { GlobalConfig } from \"../game/config/GlobalConfig\";\nimport WebUtils from \"../utils/WebUtils\";\nimport { hight } from \"./TownView\";\nconst { ccclass, property } = _decorator;\n\nexport const npcICON = {\n    0: \"home/topInfoColum/Farmer\",\n    1: \"home/topInfoColum/Grocer\",\n    2: \"home/topInfoColum/Baker\",\n    3: \"home/topInfoColum/FLOKI\",\n    4: \"home/topInfoColum/Herdman\",\n    5: \"home/PePe\"\n  };\n\nexport const NpcHomeName = {\n  0: \"Farmer Home\",\n  1: \"Grocer Home\",\n  2: \"Baker Home\",\n  3: \"FLOKI Home\",\n  4: \"Herdman Home\",\n  5: \"PePe Home\"\n};\n\nexport const NpcViewName = {\n  0: \"Farmer View\",\n  1: \"Grocer View\",\n  2: \"Baker View\",\n  3: \"FLOKI View\",\n  4: \"Herdman View\",\n  5: \"PePe View\"\n};\n\n\n@ccclass(\"touch\")\nexport class touch extends Component {\n  @property(Node)\n  scrollNode: Node;\n\n  @property(Node)\n  canvas: Node;\n\n  @property(Node)\n  watchType: Node;\n\n  @property(Node)\n  npcIcon: Node;\n\n  @property(Label)\n  npcHomeName: Label;\n\n  @property(Node)\n  camera: Node;\n\n  @property(Node)\n  front: Node;\n\n  npcIndex: number = 0;\n  preOffset: number;\n  curOffset: number;\n  start() {\n    this.node.on(Node.EventType.TOUCH_START, (event) => {\n      const scroll = this.scrollNode.getComponent(ScrollView);\n    });\n\n    this.node.on(Node.EventType.TOUCH_END, (event: EventTouch) => {\n      const startPos = event.touch.getStartLocation();\n      const prePos = event.touch.getPreviousLocation();\n      if (Math.abs(startPos.y - prePos.y) > Math.abs(startPos.x - prePos.x)) {\n        if (startPos.y > prePos.y) {\n          const scroll = this.scrollNode.getComponent(ScrollView);\n          scroll.scrollToOffset(\n            new Vec2(\n              scroll.getScrollOffset().x,\n              scroll.getScrollOffset().y - 930\n            ),\n            1,\n            true\n          );\n        }\n        if (startPos.y < prePos.y) {\n          const scroll = this.scrollNode.getComponent(ScrollView);\n          scroll.scrollToOffset(\n            new Vec2(\n              scroll.getScrollOffset().x,\n              scroll.getScrollOffset().y + 930\n            ),\n            1,\n            true\n          );\n        }\n      } else {\n        if (startPos.x > prePos.x) {\n          if (this.canvas.scale.x === 2) {\n            this.canvas.active =false\n            this.canvas.setScale(1, 1);\n            WebUtils.getResouceImg(\"home/topInfoColum/view\", this.watchType);\n            WebUtils.getResouceImg(npcICON[this.npcIndex], this.npcIcon);\n            this.npcHomeName.string = NpcHomeName[this.npcIndex];\n            this.camera.setPosition(0, 0)\n            // this.front.setScale(1, 1)\n            this.front.setPosition(0, 0)\n            this.canvas.active = true\n          }\n        }\n        if (startPos.x < prePos.x) {\n          if (this.canvas.scale.x === 1) {\n            this.canvas.active =false\n            this.canvas.setScale(2, 2);\n            WebUtils.getResouceImg(\"home/topInfoColum/eye\", this.watchType);\n            WebUtils.getResouceImg(npcICON[this.npcIndex], this.npcIcon);\n            this.npcHomeName.string = NpcViewName[this.npcIndex];\n            this.canvas.active = true\n\n            // const gameView = view.getVisibleSize();\n            // this.camera.setPosition(GlobalConfig.instance.curViewNpcX - gameView.width / 2, this.scrollNode.getPosition().y - (hight - GlobalConfig.instance.curViewNpcY))\n          }\n        }\n      }\n    });\n  }\n\n  scrollEvent(event, data) {\n    if (data === 12) {\n      const scroll = this.scrollNode.getComponent(ScrollView);\n      this.preOffset = scroll.getScrollOffset().y;\n    }\n\n    if (data === 9) {\n      const scroll = this.scrollNode.getComponent(ScrollView);\n      this.curOffset = scroll.getScrollOffset().y;\n      if (Math.abs(this.preOffset - this.curOffset) > 500) {\n        if (this.preOffset < this.curOffset) {\n          GlobalConfig.instance.currentNpcIndex =\n            GlobalConfig.instance.currentNpcIndex + 1;\n          this.npcIndex = GlobalConfig.instance.currentNpcIndex;\n        } else {\n          GlobalConfig.instance.currentNpcIndex =\n            GlobalConfig.instance.currentNpcIndex - 1;\n          this.npcIndex = GlobalConfig.instance.currentNpcIndex;\n        }\n        if (this.canvas.scale.x === 1) {\n            this.npcHomeName.string = NpcHomeName[this.npcIndex];\n        } else {\n            this.npcHomeName.string = NpcViewName[this.npcIndex];\n            // const gameView = view.getVisibleSize();\n            // this.camera.setPosition(GlobalConfig.instance.curViewNpcX - gameView.width / 2, this.scrollNode.getPosition().y - (hight - GlobalConfig.instance.curViewNpcY))\n        }\n      }\n      WebUtils.getResouceImg(npcICON[this.npcIndex], this.npcIcon);\n    }\n  }\n\n  scrollUp() {}\n\n  scrollDown() {}\n\n  scrollLeft() {}\n\n  scrollRight() {}\n\n  update(deltaTime: number) {}\n}\n"]}