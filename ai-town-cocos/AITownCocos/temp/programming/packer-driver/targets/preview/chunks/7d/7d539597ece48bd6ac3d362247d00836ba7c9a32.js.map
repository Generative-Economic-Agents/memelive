{"version":3,"sources":["file:///Users/feiwang/workSpace/AITown/cutepet/assets/src/module/main/tujian/PetsItem.ts"],"names":["_decorator","Component","Label","Node","Sprite","WebUtils","modelMgr","observer","socket","uiMgr","GlobalConfig","showMsg2","network","EventType","AudioManager","ccclass","property","PetsItem","_da","_servda","_clickNum","start","node","on","updateData","SOCKET_CHANGE_CATS","updateSerData","update","deltaTime","onDestroy","off","configModel","getStrById","removeParent","da","CurCatId","instance","getCurCatId","Number","id","Sprite_select","active","mainModel","getServerCatsData","Label_name","string","name","mbti","getCatDataById","toLowerCase","getResouceImg","itempic","clickHandler","evt","playSound","catRootNode","scale","x","position","json","ChangeCatsRequest","data","catId","sendWebSocketBinary","setCurCatId","getCatTestHandler","SelectCatRequst"],"mappings":"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","sourcesContent":["import { _decorator, Component, Label, Node, Sprite } from 'cc';\nimport WebUtils from '../../../utils/WebUtils';\nimport { modelMgr, observer, socket, uiMgr } from '../../../game/App';\nimport { GlobalConfig } from '../../../game/config/GlobalConfig';\nimport { showMsg2 } from '../../../core/message/MessageManager';\nimport { network } from '../../../model/RequestData';\nimport { EventType } from '../../../EventType';\nimport { catServerD } from '../../../game/config/DataStruct';\nimport { AudioManager } from '../../../manager/AudioManager';\nconst { ccclass, property } = _decorator;\n\n@ccclass('PetsItem')\nexport class PetsItem extends Component {\n\n    @property(Node)\n    public itempic: Node = null;\n\n\n    @property(Label)\n    public Label_name: Label = null;\n    @property(Sprite)\n    public sprite_name: Label = null;\n    @property(Sprite)\n    public Sprite_select: Label = null;\n    public _da;\n    start() {\n        this.node.on(\"update_data\", this.updateData, this);\n        observer.on(EventType.SOCKET_CHANGE_CATS, this.updateSerData, this);\n    }\n\n    update(deltaTime: number) {\n\n    }\n    protected onDestroy(): void {\n        this.node.off(\"update_data\", this.updateData, this);\n        observer.off(EventType.SOCKET_CHANGE_CATS, this.updateSerData, this);\n    }\n    private _servda: catServerD;\n    private updateSerData() {\n        showMsg2(modelMgr.configModel.getStrById(10007));\n\n        //this.updateData(this._da);\n        uiMgr.removeParent(\"prefabs/pre_tujian\");\n    }\n    /**\n    * 视图更新\n    * @param da \n    */\n    public updateData(da) {\n        this._da = da;\n        if (this._da) {\n            let CurCatId = GlobalConfig.instance.getCurCatId();\n            if (CurCatId == Number(this._da.id)) {\n                this.Sprite_select.node.active = true;\n            } else {\n                this.Sprite_select.node.active = false;\n            }\n            this._servda = modelMgr.mainModel.getServerCatsData(this._da.id);\n            this.Label_name.string = this._da.name;\n            this.node.active = true;\n\n            if (!this._servda) {\n                // console.warn(\"没有图片:\", this._da);\n                //显示未获得图片\n            } else {\n                let mbti = modelMgr.configModel.getCatDataById(this._da.id).mbti;\n                mbti = mbti.toLowerCase();\n\n                WebUtils.getResouceImg(`tujian/${mbti}_tj`, this.itempic);\n            }\n        }\n        \n    }\n\n    /**\n     * 切换猫咪\n     * @param evt \n     * @param da \n     * @returns \n     */\n    public clickHandler(evt, da) {\n        AudioManager.instance.playSound(\"new_NormanBtn\");\n        if(GlobalConfig.instance.catRootNode.scale.x > 0){\n            if(GlobalConfig.instance.catRootNode.position.x < -450 || GlobalConfig.instance.catRootNode.position.x > 40){\n                showMsg2('Wait for your cat to return!');\n                return\n            }\n        }else{\n            if(GlobalConfig.instance.catRootNode.position.x < -40 || GlobalConfig.instance.catRootNode.position.x > 450){\n                showMsg2('Wait for your cat to return!');\n                return\n            }\n        }\n        if (this._da) {\n            let CurCatId = GlobalConfig.instance.getCurCatId();\n            if (CurCatId == Number(this._da.id)) {\n                // showMsg2(\"当前猫咪已选择\");\n                showMsg2(modelMgr.configModel.getStrById(10006));\n\n                return;\n            } else if (this._servda) {\n                let json = new network.ChangeCatsRequest();\n                json.data.catId = this._da.id;\n                socket.sendWebSocketBinary(json);\n                GlobalConfig.instance.setCurCatId(this._da.id);\n                // this.updateData(this._da);\n            } else {\n                showMsg2(modelMgr.configModel.getStrById(10008));//还未获得此猫咪\n            }\n        }\n    }\n\n    private _clickNum: number = 0;\n    /**\n     * 获取猫咪-debug\n     */\n    public getCatTestHandler() {\n        this._clickNum++;\n        if (this._da && this._clickNum % 9 == 0) {\n            let json = new network.SelectCatRequst();\n            json.data.catId = this._da.id;\n            socket.sendWebSocketBinary(json);\n            GlobalConfig.instance.setCurCatId(this._da.id);\n            // this.updateData(this._da);\n        }\n    }\n\n}\n\n\n"]}