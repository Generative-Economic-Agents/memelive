{"version":3,"sources":["file:///Users/feiwang/workSpace/AITown/cutepet/assets/src/module/main/ShopPurchaseComponent.ts"],"names":["_decorator","Component","Label","Node","Slider","Sprite","socket","network","WebUtils","AudioManager","showMsgWithMask","ToysInfo","Log","ccclass","property","TAG","MAX_SHOP_SLIDER_COUNT","MIN_SHOP_SLIDER_COUNT","step_percent","ShopPurchaseComponent","current_sliderProgress","_data","start","currentCount","string","String","sliderValue","setItemData","data","itemName","item","eName","itemDescription","itemDesc","itemTotalPrice","originalPprice","getResouceImg","storeId","id","itempic","log","updateSliderValue","event","customData","instance","playSound","value","Number","slider","progress","parseFloat","setSliderBySliderValue","useSlider","useSliderChange","sliderShowBar","setScale","Math","round","closePurchasePage","pageNode","active","getComponent","spriteFrame","buySelectItem","json","BuyShopRequest","shopId","count","currentCoin","sendWebSocketBinary","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, Component, halfToFloat, js, Label, math, Node, Slider, Sprite } from 'cc';\nimport { modelMgr, observer, socket, uiMgr } from '../../game/App';\nimport { EventType } from '../../EventType';\nimport { network } from '../../model/RequestData';\nimport { CatEnjoyToolsData, ShopMangerTips } from './shop/CatEnjoyToolsDataType';\nimport WebUtils from '../../utils/WebUtils';\nimport { showMsg2 } from '../../core/message/MessageManager';\nimport { AudioManager } from '../../manager/AudioManager';\nimport { SpriteAtlasAnimation } from './SpriteAtlasAnimation';\nimport { NumberCounter } from '../../utils/NumberCounter';\nimport { showMsgWithMask } from '../../core/message/MaskToastManager';\nimport { ToysInfo } from '../../model/StaticTextConfig';\nimport Log from '../../../../assets/src/utils/LogUtils'\nconst { ccclass, property } = _decorator;\n\nconst TAG = 'ShopPurchaseComponent'\nconst MAX_SHOP_SLIDER_COUNT = 9\nconst MIN_SHOP_SLIDER_COUNT = 0\nconst step_percent = 0.111111111\n\n@ccclass('ShopPurchaseComponent')\nexport class ShopPurchaseComponent extends Component {\n    @property(Slider)\n    slider: Slider | null = null; // 精灵组件\n    @property(Node)\n    pageNode: Node | null = null; // 精灵组件\n    @property(Node)\n    sliderShowBar: Node | null = null\n\n    @property(Label)\n    public itemName: Label = null;\n\n    @property(Label)\n    public itemDescription: Label = null;\n\n    @property(Label)\n    public itemTotalPrice: Label = null;\n\n    @property(Label)\n    public currentCount: Label = null;\n\n    @property(Node)\n    public itempic: Node = null;\n\n    @property(Label)\n    public currentCoin: Label = null;\n\n    current_sliderProgress: number = 0 //滑动条默认值为1\n    private _data: CatEnjoyToolsData;\n    start() {\n        this.currentCount.string = String(this.sliderValue)\n        // observer.on(EventType.SEND_BUY_SHOP_ITEM_SUCCESS_INFO, (data)=>{\n        //     console.log(TAG, data)\n        //     this.closePurchasePage()\n        // }, this);\n    }\n\n    setItemData(data: CatEnjoyToolsData){\n        this._data = data\n        this.itemName.string = ToysInfo[data.item[0]].eName\n        this.itemDescription.string = data.itemDesc\n        this.itemTotalPrice.string = String(data.originalPprice * this.sliderValue)\n        WebUtils.getResouceImg(`shopGoodsPic/${data.storeId}_shopItem_${data.id}`, this.itempic);\n        Log.log(TAG, 'setData', data)\n    }\n\n    updateSliderValue(event, customData: string){\n        AudioManager.instance.playSound(\"new_NormanBtn\");\n        const value = this.current_sliderProgress + Number(customData)\n        if(value > MAX_SHOP_SLIDER_COUNT || value < MIN_SHOP_SLIDER_COUNT){\n            return\n        }else{\n            this.slider.progress = parseFloat(String(value)) * step_percent\n            this.current_sliderProgress = value\n            // this.sliderShowBar.setScale(this.slider.progress, 1)\n            // this.currentCount.string = String(this.sliderValue)\n            \n            this.setSliderBySliderValue()\n            \n        }\n    }\n\n    useSlider(event, customData){\n        Log.log(TAG, this.slider.progress)\n    }\n\n    useSliderChange(slider: Slider){\n        this.sliderShowBar.setScale(this.slider.progress, 1)\n    }\n\n    get sliderValue(){\n        return this.current_sliderProgress + 1\n    }\n\n    setSliderBySliderValue(event : Slider = null){\n        if(event){\n            this.current_sliderProgress = Math.round(event.progress * MAX_SHOP_SLIDER_COUNT)\n        }\n        this.sliderShowBar.setScale(this.slider.progress, 1)\n        this.currentCount.string = String(this.sliderValue)\n        this.itemTotalPrice.string = String(this._data.originalPprice * this.sliderValue)\n    }\n\n    closePurchasePage(){\n        AudioManager.instance.playSound(\"new_NormanBtn\");\n        this.pageNode.active = false\n        this.current_sliderProgress = 0\n        this.slider.progress = 0\n        this.itempic.getComponent(Sprite).spriteFrame = null;\n        this.setSliderBySliderValue()\n        //this.setCatManger(false)\n    }\n\n    buySelectItem(){\n        AudioManager.instance.playSound(\"new_NormanBtn\");\n        let json = new network.BuyShopRequest();\n        json.data.shopId = this._data.id;\n        json.data.count = this.sliderValue;\n        if(Number(this.currentCoin.string) < Number(this.itemTotalPrice.string)){\n            showMsgWithMask(\"Insufficient Coins\");\n            return\n        }\n        socket.sendWebSocketBinary(json);\n        Log.log(TAG, json)\n    }\n\n    update(deltaTime: number) {\n\n    }\n}\n\n"]}