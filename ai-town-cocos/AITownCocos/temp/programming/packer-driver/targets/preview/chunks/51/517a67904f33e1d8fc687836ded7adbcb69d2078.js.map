{"version":3,"sources":["file:///Users/feiwang/cutepet/node_modules/request/lib/hawk.js"],"names":["_cjsLoader","_req","__cjsMetaURL","url","define","exports","require","module","__filename","__dirname","crypto","randomString","size","bits","buffer","randomBytes","Math","ceil","string","toString","replace","slice","calculatePayloadHash","payload","algorithm","contentType","hash","createHash","update","split","trim","toLowerCase","digest","calculateMac","credentials","opts","normalized","ts","nonce","method","toUpperCase","resource","host","port","ext","app","dlg","hmac","createHmac","key","header","uri","timestamp","floor","Date","now","localtimeOffsetMsec","id","indexOf","artifacts","pathname","search","hostname","protocol","mac","hasExt","undefined","_cjsExports","_calculateMac","_header"],"mappings":"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","sourcesContent":["import _cjsLoader from 'cce:/internal/ml/cjs-loader.mjs';\nimport { __cjsMetaURL as _req} from 'crypto';\nlet _cjsExports;\nlet _calculateMac;\nlet _header;\nconst __cjsMetaURL = import.meta.url;\n_cjsLoader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {\n// #region ORIGINAL CODE\n\n\n 'use strict'\n\n var crypto = require('crypto')\n\n function randomString (size) {\n   var bits = (size + 1) * 6\n   var buffer = crypto.randomBytes(Math.ceil(bits / 8))\n   var string = buffer.toString('base64').replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=/g, '')\n   return string.slice(0, size)\n }\n\n function calculatePayloadHash (payload, algorithm, contentType) {\n   var hash = crypto.createHash(algorithm)\n   hash.update('hawk.1.payload\\n')\n   hash.update((contentType ? contentType.split(';')[0].trim().toLowerCase() : '') + '\\n')\n   hash.update(payload || '')\n   hash.update('\\n')\n   return hash.digest('base64')\n }\n\n exports.calculateMac = function (credentials, opts) {\n   var normalized = 'hawk.1.header\\n' +\n     opts.ts + '\\n' +\n     opts.nonce + '\\n' +\n     (opts.method || '').toUpperCase() + '\\n' +\n     opts.resource + '\\n' +\n     opts.host.toLowerCase() + '\\n' +\n     opts.port + '\\n' +\n     (opts.hash || '') + '\\n'\n\n   if (opts.ext) {\n     normalized = normalized + opts.ext.replace('\\\\', '\\\\\\\\').replace('\\n', '\\\\n')\n   }\n\n   normalized = normalized + '\\n'\n\n   if (opts.app) {\n     normalized = normalized + opts.app + '\\n' + (opts.dlg || '') + '\\n'\n   }\n\n   var hmac = crypto.createHmac(credentials.algorithm, credentials.key).update(normalized)\n   var digest = hmac.digest('base64')\n   return digest\n }\n\n exports.header = function (uri, method, opts) {\n   var timestamp = opts.timestamp || Math.floor((Date.now() + (opts.localtimeOffsetMsec || 0)) / 1000)\n   var credentials = opts.credentials\n   if (!credentials || !credentials.id || !credentials.key || !credentials.algorithm) {\n     return ''\n   }\n\n   if (['sha1', 'sha256'].indexOf(credentials.algorithm) === -1) {\n     return ''\n   }\n\n   var artifacts = {\n     ts: timestamp,\n     nonce: opts.nonce || randomString(6),\n     method: method,\n     resource: uri.pathname + (uri.search || ''),\n     host: uri.hostname,\n     port: uri.port || (uri.protocol === 'http:' ? 80 : 443),\n     hash: opts.hash,\n     ext: opts.ext,\n     app: opts.app,\n     dlg: opts.dlg\n   }\n\n   if (!artifacts.hash && (opts.payload || opts.payload === '')) {\n     artifacts.hash = calculatePayloadHash(opts.payload, credentials.algorithm, opts.contentType)\n   }\n\n   var mac = exports.calculateMac(credentials, artifacts)\n\n   var hasExt = artifacts.ext !== null && artifacts.ext !== undefined && artifacts.ext !== ''\n   var header = 'Hawk id=\"' + credentials.id +\n     '\", ts=\"' + artifacts.ts +\n     '\", nonce=\"' + artifacts.nonce +\n     (artifacts.hash ? '\", hash=\"' + artifacts.hash : '') +\n     (hasExt ? '\", ext=\"' + artifacts.ext.replace(/\\\\/g, '\\\\\\\\').replace(/\"/g, '\\\\\"') : '') +\n     '\", mac=\"' + mac + '\"'\n\n   if (artifacts.app) {\n     header = header + ', app=\"' + artifacts.app + (artifacts.dlg ? '\", dlg=\"' + artifacts.dlg : '') + '\"'\n   }\n\n   return header\n }\n\n\n// #endregion ORIGINAL CODE\n\n_cjsExports = module.exports;\n_calculateMac = module.exports.calculateMac;\n_header = module.exports.header;\n\n}, () => ({\n  'crypto': _req,\n}));\nexport { _cjsExports as default };\nexport { __cjsMetaURL }\n"]}