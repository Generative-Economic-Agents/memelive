{"version":3,"sources":["file:///Users/feiwang/cutepet/node_modules/request/lib/har.js"],"names":["_cjsLoader","_req","__cjsMetaURL","_req0","_req1","_req2","url","define","exports","require","module","__filename","__dirname","fs","qs","validate","extend","Har","request","prototype","reducer","obj","pair","name","undefined","value","arr","prep","data","queryObj","headersObj","postData","jsonObj","paramsObj","queryString","length","reduce","headers","reduceRight","header","cookies","map","cookie","join","some","type","mimeType","indexOf","params","text","stringify","JSON","parse","e","debug","options","har","log","entries","uri","baseUrl","httpVersion","bodySize","headersSize","size","req","method","Object","keys","test","form","body","json","formData","forEach","param","attachment","fileName","contentType","createReadStream","filename","_cjsExports","_Har"],"mappings":"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","sourcesContent":["import _cjsLoader from 'cce:/internal/ml/cjs-loader.mjs';\nimport { __cjsMetaURL as _req} from 'fs';\nimport { __cjsMetaURL as _req0} from 'querystring';\nimport { __cjsMetaURL as _req1} from 'har-validator';\nimport { __cjsMetaURL as _req2} from 'extend';\nlet _cjsExports;\nlet _Har;\nconst __cjsMetaURL = import.meta.url;\n_cjsLoader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {\n// #region ORIGINAL CODE\n\n\n 'use strict'\n\n var fs = require('fs')\n var qs = require('querystring')\n var validate = require('har-validator')\n var extend = require('extend')\n\n function Har (request) {\n   this.request = request\n }\n\n Har.prototype.reducer = function (obj, pair) {\n   // new property ?\n   if (obj[pair.name] === undefined) {\n     obj[pair.name] = pair.value\n     return obj\n   }\n\n   // existing? convert to array\n   var arr = [\n     obj[pair.name],\n     pair.value\n   ]\n\n   obj[pair.name] = arr\n\n   return obj\n }\n\n Har.prototype.prep = function (data) {\n   // construct utility properties\n   data.queryObj = {}\n   data.headersObj = {}\n   data.postData.jsonObj = false\n   data.postData.paramsObj = false\n\n   // construct query objects\n   if (data.queryString && data.queryString.length) {\n     data.queryObj = data.queryString.reduce(this.reducer, {})\n   }\n\n   // construct headers objects\n   if (data.headers && data.headers.length) {\n     // loweCase header keys\n     data.headersObj = data.headers.reduceRight(function (headers, header) {\n       headers[header.name] = header.value\n       return headers\n     }, {})\n   }\n\n   // construct Cookie header\n   if (data.cookies && data.cookies.length) {\n     var cookies = data.cookies.map(function (cookie) {\n       return cookie.name + '=' + cookie.value\n     })\n\n     if (cookies.length) {\n       data.headersObj.cookie = cookies.join('; ')\n     }\n   }\n\n   // prep body\n   function some (arr) {\n     return arr.some(function (type) {\n       return data.postData.mimeType.indexOf(type) === 0\n     })\n   }\n\n   if (some([\n     'multipart/mixed',\n     'multipart/related',\n     'multipart/form-data',\n     'multipart/alternative'])) {\n     // reset values\n     data.postData.mimeType = 'multipart/form-data'\n   } else if (some([\n     'application/x-www-form-urlencoded'])) {\n     if (!data.postData.params) {\n       data.postData.text = ''\n     } else {\n       data.postData.paramsObj = data.postData.params.reduce(this.reducer, {})\n\n       // always overwrite\n       data.postData.text = qs.stringify(data.postData.paramsObj)\n     }\n   } else if (some([\n     'text/json',\n     'text/x-json',\n     'application/json',\n     'application/x-json'])) {\n     data.postData.mimeType = 'application/json'\n\n     if (data.postData.text) {\n       try {\n         data.postData.jsonObj = JSON.parse(data.postData.text)\n       } catch (e) {\n         this.request.debug(e)\n\n         // force back to text/plain\n         data.postData.mimeType = 'text/plain'\n       }\n     }\n   }\n\n   return data\n }\n\n Har.prototype.options = function (options) {\n   // skip if no har property defined\n   if (!options.har) {\n     return options\n   }\n\n   var har = {}\n   extend(har, options.har)\n\n   // only process the first entry\n   if (har.log && har.log.entries) {\n     har = har.log.entries[0]\n   }\n\n   // add optional properties to make validation successful\n   har.url = har.url || options.url || options.uri || options.baseUrl || '/'\n   har.httpVersion = har.httpVersion || 'HTTP/1.1'\n   har.queryString = har.queryString || []\n   har.headers = har.headers || []\n   har.cookies = har.cookies || []\n   har.postData = har.postData || {}\n   har.postData.mimeType = har.postData.mimeType || 'application/octet-stream'\n\n   har.bodySize = 0\n   har.headersSize = 0\n   har.postData.size = 0\n\n   if (!validate.request(har)) {\n     return options\n   }\n\n   // clean up and get some utility properties\n   var req = this.prep(har)\n\n   // construct new options\n   if (req.url) {\n     options.url = req.url\n   }\n\n   if (req.method) {\n     options.method = req.method\n   }\n\n   if (Object.keys(req.queryObj).length) {\n     options.qs = req.queryObj\n   }\n\n   if (Object.keys(req.headersObj).length) {\n     options.headers = req.headersObj\n   }\n\n   function test (type) {\n     return req.postData.mimeType.indexOf(type) === 0\n   }\n   if (test('application/x-www-form-urlencoded')) {\n     options.form = req.postData.paramsObj\n   } else if (test('application/json')) {\n     if (req.postData.jsonObj) {\n       options.body = req.postData.jsonObj\n       options.json = true\n     }\n   } else if (test('multipart/form-data')) {\n     options.formData = {}\n\n     req.postData.params.forEach(function (param) {\n       var attachment = {}\n\n       if (!param.fileName && !param.contentType) {\n         options.formData[param.name] = param.value\n         return\n       }\n\n       // attempt to read from disk!\n       if (param.fileName && !param.value) {\n         attachment.value = fs.createReadStream(param.fileName)\n       } else if (param.value) {\n         attachment.value = param.value\n       }\n\n       if (param.fileName) {\n         attachment.options = {\n           filename: param.fileName,\n           contentType: param.contentType ? param.contentType : null\n         }\n       }\n\n       options.formData[param.name] = attachment\n     })\n   } else {\n     if (req.postData.text) {\n       options.body = req.postData.text\n     }\n   }\n\n   return options\n }\n\n exports.Har = Har\n\n\n// #endregion ORIGINAL CODE\n\n_cjsExports = module.exports;\n_Har = module.exports.Har;\n\n}, () => ({\n  'fs': _req,\n  'querystring': _req0,\n  'har-validator': _req1,\n  'extend': _req2,\n}));\nexport { _cjsExports as default };\nexport { __cjsMetaURL }\n"]}