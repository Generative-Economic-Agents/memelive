{"version":3,"sources":["file:///Users/feiwang/workSpace/AITown/cutepet/assets/src/module/main/PlayWithCat.ts/ToyItem.ts"],"names":["_decorator","Component","Label","Node","WebUtils","modelMgr","observer","GlobalConfig","showMsg2","EventType","ActionType","TouchCatTips","ToysInfo","showMsgWithMask","Log","ccclass","property","TAG","ToyItem","_da","_servda","start","node","on","updateData","update","deltaTime","onDestroy","setScale","off","updateSerData","configModel","getStrById","da","Label_name","string","goodsId","eName","item_num","String","count","getResouceImg","picUrl","itempic","toyClickShowUseBtn","instance","catRootNode","scale","x","position","mainModel","getserItemCountById","playAniComplete","rootNode","active","playWithCat","getCurCatId","log","hasToySpine","checkplayerItems","actionData","type","TOY_PLAY","text","duringTime","toyId","post","SEND_CAT_ACTION","bubble"],"mappings":"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","sourcesContent":["import { _decorator, Button, Component, Label, Node, Sprite } from 'cc';\nimport WebUtils from '../../../utils/WebUtils';\nimport { modelMgr, observer, socket } from '../../../game/App';\nimport { GlobalConfig } from '../../../game/config/GlobalConfig';\nimport { showMsg2 } from '../../../core/message/MessageManager';\nimport { network } from '../../../model/RequestData';\nimport { EventType } from '../../../EventType';\nimport { CatActionInfo, catServerD } from '../../../game/config/DataStruct';\nimport { ActionType, TouchCatTips, ToysInfo } from '../../../model/StaticTextConfig';\nimport { ToyDataType } from '../shop/CatEnjoyToolsDataType';\nimport { ToyComponent } from './ToyComponent';\nimport { showMsgWithMask } from '../../../core/message/MaskToastManager';\nimport Log from '../../../../../assets/src/utils/LogUtils'\nconst { ccclass, property } = _decorator;\n\nconst TAG = 'ToyItem'\n\n@ccclass('ToyItem')\nexport class ToyItem extends Component {\n\n    @property(Node)\n    public itempic: Node = null;\n\n    @property(Label)\n    public Label_name: Label = null;\n\n    @property(Node)\n    public Top_node: Node = null;\n\n    @property(Label)\n    public item_num: Label = null;\n\n    @property(Node)\n    public use_btn: Node = null;\n\n    @property(Node)\n    public bubble: Node = null;\n\n    @property(Node)\n    public rootNode: Node = null;\n    public _da;\n    start() {\n        this.node.on(\"update_data\", this.updateData, this);\n        //observer.on(EventType.SOCKET_CHANGE_CATS, this.updateSerData, this);\n    }\n\n    update(deltaTime: number) {\n\n    }\n    protected onDestroy(): void {\n        this.node.setScale(0, 0)\n        this.node.off(\"update_data\", this.updateData, this);\n        //observer.off(EventType.SOCKET_CHANGE_CATS, this.updateSerData, this);\n    }\n    private _servda: catServerD;\n    private updateSerData() {\n        showMsg2(modelMgr.configModel.getStrById(10007));\n\n        this.updateData(this._da);\n    }\n    /**\n    * 视图更新\n    * @param da \n    */\n    public updateData(da: ToyDataType) {\n        if(da){\n            this._da = da;\n            this.Label_name.string = ToysInfo[da.goodsId].eName\n            this.item_num.string = String(da.count)\n            WebUtils.getResouceImg(ToysInfo[da.goodsId].picUrl, this.itempic);\n            this.node.setScale(1, 1)\n        }\n    }\n\n    /**\n     * 显示使用逗猫玩具\n     * @param evt \n     * @param da \n     * @returns \n     */\n\n    public toyClickShowUseBtn() {\n        // this.Top_node.getComponent(ToyComponent).currentGoodId = this._da.goodsId\n        // this.use_btn.active = true\n        // this.use_btn.setParent(this.node)\n        if(GlobalConfig.instance.catRootNode.scale.x > 0){\n            if(GlobalConfig.instance.catRootNode.position.x < -450 || GlobalConfig.instance.catRootNode.position.x > 40){\n                showMsg2('Wait for your cat to return!');\n                return\n            }\n        }else{\n            if(GlobalConfig.instance.catRootNode.position.x < -40 || GlobalConfig.instance.catRootNode.position.x > 450){\n                showMsg2('Wait for your cat to return!');\n                return\n            }\n        }\n        if (modelMgr.mainModel.getserItemCountById(10101002) <= 0) {\n            showMsgWithMask(\"Insufficient Ap!\");\n            return;\n        }\n\n        if(!modelMgr.mainModel.playAniComplete){\n            showMsgWithMask(\"Cat has Action now!\");\n            return\n        }\n        this.rootNode.active = false\n        modelMgr.mainModel.playWithCat(GlobalConfig.instance.getCurCatId(), this._da.goodsId, 1)\n        Log.log(TAG, 'use Toy' ,this._da.goodsId)\n        this.rootNode\n        modelMgr.mainModel.hasToySpine = true\n        modelMgr.mainModel.checkplayerItems()\n        Log.log(TAG, 'cat node happy' )\n        const actionData : CatActionInfo = {\n            type: ActionType.TOY_PLAY,\n            text: TouchCatTips[1],\n            duringTime: 7,\n            toyId: this._da.goodsId\n        }\n        observer.post(EventType.SEND_CAT_ACTION, actionData)\n        this.bubble.active = false\n    }\n\n}\n\n\n"]}