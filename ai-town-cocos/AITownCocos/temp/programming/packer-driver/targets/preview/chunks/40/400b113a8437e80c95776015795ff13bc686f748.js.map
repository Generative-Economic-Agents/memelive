{"version":3,"sources":["file:///Users/feiwang/cutepet/node_modules/aws-sdk/lib/signers/presign.js"],"names":["_cjsLoader","_req","__cjsMetaURL","url","define","exports","require","module","__filename","__dirname","AWS","inherit","util","expiresHeader","signedUrlBuilder","request","expires","httpRequest","headers","signerClass","service","getSignerClass","Signers","V4","message","error","Error","code","retryable","S3","now","getSkewCorrectedDate","date","getDate","parseInt","unixTimestamp","toString","signedUrlSigner","endpoint","parsedUrl","urlParse","path","queryParams","search","queryStringParse","substr","auth","split","pop","join","each","key","value","indexOf","toLowerCase","shift","rest","signature","match","pathname","queryParamsToString","Presign","sign","expireTime","callback","on","removeListener","EventListeners","Core","SET_CONTENT_LENGTH","COMPUTE_SHA256","emit","build","response","urlFormat","_cjsExports"],"mappings":"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","sourcesContent":["import _cjsLoader from 'cce:/internal/ml/cjs-loader.mjs';\nimport { __cjsMetaURL as _req} from '../core';\nlet _cjsExports;\nconst __cjsMetaURL = import.meta.url;\n_cjsLoader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {\n// #region ORIGINAL CODE\n\n\n var AWS = require('../core');\n var inherit = AWS.util.inherit;\n\n /**\n  * @api private\n  */\n var expiresHeader = 'presigned-expires';\n\n /**\n  * @api private\n  */\n function signedUrlBuilder(request) {\n   var expires = request.httpRequest.headers[expiresHeader];\n   var signerClass = request.service.getSignerClass(request);\n\n   delete request.httpRequest.headers['User-Agent'];\n   delete request.httpRequest.headers['X-Amz-User-Agent'];\n\n   if (signerClass === AWS.Signers.V4) {\n     if (expires > 604800) { // one week expiry is invalid\n       var message = 'Presigning does not support expiry time greater ' +\n                     'than a week with SigV4 signing.';\n       throw AWS.util.error(new Error(), {\n         code: 'InvalidExpiryTime', message: message, retryable: false\n       });\n     }\n     request.httpRequest.headers[expiresHeader] = expires;\n   } else if (signerClass === AWS.Signers.S3) {\n     var now = request.service ? request.service.getSkewCorrectedDate() : AWS.util.date.getDate();\n     request.httpRequest.headers[expiresHeader] = parseInt(\n       AWS.util.date.unixTimestamp(now) + expires, 10).toString();\n   } else {\n     throw AWS.util.error(new Error(), {\n       message: 'Presigning only supports S3 or SigV4 signing.',\n       code: 'UnsupportedSigner', retryable: false\n     });\n   }\n }\n\n /**\n  * @api private\n  */\n function signedUrlSigner(request) {\n   var endpoint = request.httpRequest.endpoint;\n   var parsedUrl = AWS.util.urlParse(request.httpRequest.path);\n   var queryParams = {};\n\n   if (parsedUrl.search) {\n     queryParams = AWS.util.queryStringParse(parsedUrl.search.substr(1));\n   }\n\n   var auth = request.httpRequest.headers['Authorization'].split(' ');\n   if (auth[0] === 'AWS') {\n     auth = auth[1].split(':');\n     queryParams['Signature'] = auth.pop();\n     queryParams['AWSAccessKeyId'] = auth.join(':');\n\n     AWS.util.each(request.httpRequest.headers, function (key, value) {\n       if (key === expiresHeader) key = 'Expires';\n       if (key.indexOf('x-amz-meta-') === 0) {\n         // Delete existing, potentially not normalized key\n         delete queryParams[key];\n         key = key.toLowerCase();\n       }\n       queryParams[key] = value;\n     });\n     delete request.httpRequest.headers[expiresHeader];\n     delete queryParams['Authorization'];\n     delete queryParams['Host'];\n   } else if (auth[0] === 'AWS4-HMAC-SHA256') { // SigV4 signing\n     auth.shift();\n     var rest = auth.join(' ');\n     var signature = rest.match(/Signature=(.*?)(?:,|\\s|\\r?\\n|$)/)[1];\n     queryParams['X-Amz-Signature'] = signature;\n     delete queryParams['Expires'];\n   }\n\n   // build URL\n   endpoint.pathname = parsedUrl.pathname;\n   endpoint.search = AWS.util.queryParamsToString(queryParams);\n }\n\n /**\n  * @api private\n  */\n AWS.Signers.Presign = inherit({\n   /**\n    * @api private\n    */\n   sign: function sign(request, expireTime, callback) {\n     request.httpRequest.headers[expiresHeader] = expireTime || 3600;\n     request.on('build', signedUrlBuilder);\n     request.on('sign', signedUrlSigner);\n     request.removeListener('afterBuild',\n       AWS.EventListeners.Core.SET_CONTENT_LENGTH);\n     request.removeListener('afterBuild',\n       AWS.EventListeners.Core.COMPUTE_SHA256);\n\n     request.emit('beforePresign', [request]);\n\n     if (callback) {\n       request.build(function() {\n         if (this.response.error) callback(this.response.error);\n         else {\n           callback(null, AWS.util.urlFormat(request.httpRequest.endpoint));\n         }\n       });\n     } else {\n       request.build();\n       if (request.response.error) throw request.response.error;\n       return AWS.util.urlFormat(request.httpRequest.endpoint);\n     }\n   }\n });\n\n /**\n  * @api private\n  */\n module.exports = AWS.Signers.Presign;\n\n\n// #endregion ORIGINAL CODE\n\n_cjsExports = module.exports;\n\n\n}, () => ({\n  '../core': _req,\n}));\nexport { _cjsExports as default };\nexport { __cjsMetaURL }\n"]}