{"version":3,"sources":["file:///Users/feiwang/AITown/AITownCocos/assets/src/manager/TiaozhuanManager.ts"],"names":["TiaozhuanMananger","director","EventType","BoswerUtils","getIslogin","ModuleID","mduManger","observer","Log","TAG","constructor","_from","_hasInit","_gameUrl","initGroupRes","visit","h5utils","log","getQueryVariable","getTentrance","storage","getLocalStorage","KEY_OTPAGETYPE","urlparam","getParam","ons","on","LOGIN_COMPELETED","afterLogin","from","defaultRequest","Promise","resolve","reject","then","res","isLogin","catch","err","checkEntrance","goto","TYPE_LOCALSTORGE","TYPE_URL","defalutstart","openModu","TOWN","type","key","s","openmodule","TYPE_GAME","post","loadScene","toString","openSchema","url","goBack","onWebviewAppear","callback","window","indexOf","push","onWebviewDisappear","cb","hideloading","tizhuanMgr"],"mappings":"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","sourcesContent":["import { EventType } from \"../EventType\";\nimport BoswerUtils from \"../utils/BoswerUtils\";\nimport { getIslogin } from \"./RequestManager\";\nimport { director } from 'cc';\nimport { ModuleID } from \"../game/config/ModuleID\";\nimport { mduManger, observer } from \"../game/App\";\nimport Log from '../../../assets/src/utils/LogUtils'\n\nconst TAG = 'TiaozhuanMananger'\n/**\n * 游戏内外页面跳转\n * 本地存储跳转\n * href 链接跳转\n * webappear执行\n */\nexport default class TiaozhuanMananger {\n  private _from: string = \"\";\n  private _hasInit: [] = [];\n  private _gameUrl: { [name: string]: any[] }[];\n  public static TYPE_LOCALSTORGE: string = \"localstroge\";\n  public static TYPE_URL: string = \"fromurl\";\n  public static TYPE_GAME: string = \"games\";\n  public initGroupRes: Array<any>;\n  public visit: any;\n  private h5utils;\n  constructor() {\n    this._gameUrl = [];\n    this.initGroupRes = [];\n    //添加预加载资源逻辑\n\n    Log.log(TAG,BoswerUtils.getQueryVariable(\"token\"), \"token\");\n    this.visit = BoswerUtils.getQueryVariable(\"token\");\n  }\n\n  public static KEY_OTPAGETYPE: string = \"cocos_game\";\n  /**\n   *获取存储到本地的页面名称\n   1.临时存储\n   2.url链接跳转\n   */\n  public static getTentrance(): string {\n    let storage = BoswerUtils.getLocalStorage(\n      TiaozhuanMananger.KEY_OTPAGETYPE,\n      \"string\"\n    );\n    if (storage) {\n      return storage;\n    }\n    let urlparam = BoswerUtils.getParam()[TiaozhuanMananger.KEY_OTPAGETYPE];\n    if (urlparam) {\n      return urlparam;\n    }\n    return \"\";\n  }\n\n  public ons() {\n    observer.on(EventType.LOGIN_COMPELETED, this.afterLogin, this);\n  }\n  public get from() {\n    return this._from;\n  }\n\n  /**\n   * 通用协议及显示处理\n   */\n  public defaultRequest(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      getIslogin().then((res) => {\n        res[\"data\"];\n        Log.log(TAG,\"defaultRequest:isLogin::\", res[\"data\"].isLogin);\n        resolve();\n      }).catch((err) => {\n\n      });\n\n      //判断是否登录\n    });\n  }\n\n  /**\n   * 入口::\n   * 获取来源\n   * 优先级：localstorage-->url-->game\n   * BoswerUtils.KEY_OTPAGETYPE:游戏入口类型key\n   */\n  public checkEntrance() {\n    let storage = BoswerUtils.getLocalStorage(\n      TiaozhuanMananger.KEY_OTPAGETYPE,\n      \"string\"\n    );\n    if (storage) {\n      this.goto(TiaozhuanMananger.TYPE_LOCALSTORGE, TiaozhuanMananger.KEY_OTPAGETYPE);\n      return;\n    }\n    let urlparam = BoswerUtils.getParam()[TiaozhuanMananger.KEY_OTPAGETYPE];\n    if (urlparam) {\n      this.goto(TiaozhuanMananger.TYPE_URL, TiaozhuanMananger.KEY_OTPAGETYPE);\n      return;\n    }\n    this.defalutstart();\n  }\n  /**\n   * 默认打开模块\n   */\n  public defalutstart() {\n    Log.log(TAG,\"in defalut start.\")\n    //验证登录,成功后,打开默认界面\n    // this.afterLogin();\n    // mainModule.openModu();\n    mduManger.openModu(ModuleID.TOWN);\n  }\n  /**\n   * \n   * @param type 跳转来源\n   * @param key 跳转页面\n   */\n  public goto(type: string, key: string) {\n    let s = this;\n    switch (type) {\n      case TiaozhuanMananger.TYPE_LOCALSTORGE:\n        let storage = BoswerUtils.getLocalStorage(key, \"string\");\n        this.openmodule(storage);\n        break;\n      case TiaozhuanMananger.TYPE_URL:\n        let urlparam = BoswerUtils.getParam()[key];\n        this.openmodule(urlparam);\n        break;\n      case TiaozhuanMananger.TYPE_GAME:\n        //跳转到其他游戏页面,暂停本游戏\n        // Laya.stage.on(Laya.Event.VISIBILITY_CHANGE, s, s._visibilityChange);\n        break;\n    }\n  }\n\n  /**\n   * 根据key 打开指定页面\n   * @param storage\n   */\n  public openmodule(storage: string) {\n    switch (storage) {\n      case \"sign\": //范例\n        observer.post(\"opensign\");\n        break;\n      case \"decorate\": //范例2\n        director.loadScene(\"decorate\");\n        break;\n    }\n  }\n  /**\n   *登录执行后返回操作\n   */\n  afterLogin(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      getIslogin().then((res) => {\n        //判断是否登录\n        try {\n\n          resolve();\n        } catch (err) {\n          reject();\n          if (err) Log.log(TAG,err.toString());\n        }\n\n      });\n    })\n\n  }\n\n\n  //====================================\n  /**\n   * 跳转\n   * @param data \n   */\n  async openSchema(url) {\n\n  }\n  /**\n   * 返回\n   * @param data \n   */\n  async goBack() {\n\n  }\n  /**\n   * webview 激活\n   */\n\n  public onWebviewAppear(callback) {\n    if (typeof callback === 'function') {\n      if (window[\"onWebAppearanceQuee\"].indexOf(callback) != -1) {\n        return;\n      }\n      window[\"onWebAppearanceQuee\"].push(callback);\n    }\n  }\n  /**\n   * webview 隐藏\n   * @param cb \n   */\n  public onWebviewDisappear(cb) {\n    window[\"onWebviewAppear\"] = cb;\n  }\n\n  /**\n   * 隐藏app loading\n   */\n  public hideloading() {\n\n  }\n\n}\nexport const tizhuanMgr: TiaozhuanMananger = new TiaozhuanMananger();"]}